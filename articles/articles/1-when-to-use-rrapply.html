<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Efficient list recursion with rrapply • rrapply</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../../bootstrap-toc.css">
<script src="../../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><link href="../../extra.css" rel="stylesheet">
<meta property="og:title" content="Efficient list recursion with rrapply">
<meta property="og:description" content="rrapply">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../../index.html">rrapply</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.2.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/articles/1-when-to-use-rrapply.html">Efficient list recursion with rrapply</a>
    </li>
    <li>
      <a href="../../articles/articles/2-efficient-melting-unnesting.html">Efficient list melting and unnesting with rrapply</a>
    </li>
    <li>
      <a href="../../articles/articles/3-calls-and-expressions.html">Recursive apply for call and expression objects</a>
    </li>
  </ul>
</li>
<li>
  <a href="../../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/JorisChau/rrapply/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="1-when-to-use-rrapply_files/accessible-code-block-0.0.1/empty-anchor.js"></script><link href="1-when-to-use-rrapply_files/anchor-sections-1.0/anchor-sections.css" rel="stylesheet">
<script src="1-when-to-use-rrapply_files/anchor-sections-1.0/anchor-sections.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Efficient list recursion with rrapply</h1>
                        <h4 class="author">Joris Chau</h4>
            
            <h4 class="date">Latest date: 2021-01-25</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/JorisChau/rrapply/blob/master/vignettes/articles/1-when-to-use-rrapply.Rmd"><code>vignettes/articles/1-when-to-use-rrapply.Rmd</code></a></small>
      <div class="hidden name"><code>1-when-to-use-rrapply.Rmd</code></div>

    </div>

    
    
<div id="list-recursion-in-r" class="section level1">
<h1 class="hasAnchor">
<a href="#list-recursion-in-r" class="anchor"></a>List recursion in R</h1>
<p>The nested list below outlines the genealogy of several famous mathematicians. Each list element contains an additional <code>"given"</code> attribute with the mathematician’s given name. The numeric values at the leaf elements are the total number of descendants according to the <a href="https://www.genealogy.math.ndsu.nodak.edu/">Mathematics Genealogy Project</a> as of June 2020. If no descendants are available there is a missing value present at the leaf node.</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="no">students</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(
  <span class="kw">Bernoulli</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/structure.html">structure</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(
    <span class="kw">Bernoulli</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/structure.html">structure</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(
      <span class="kw">Bernoulli</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/structure.html">structure</a></span>(<span class="fl">1</span>, <span class="kw">given</span> <span class="kw">=</span> <span class="st">"Daniel"</span>),
      <span class="kw">Euler</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/structure.html">structure</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(
        <span class="kw">Euler</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/structure.html">structure</a></span>(<span class="fl">NA</span>, <span class="kw">given</span> <span class="kw">=</span> <span class="st">"Johann"</span>),
        <span class="kw">Lagrange</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/structure.html">structure</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(
          <span class="kw">Fourier</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/structure.html">structure</a></span>(<span class="fl">68679</span>, <span class="kw">given</span> <span class="kw">=</span> <span class="st">"Jean-Baptiste"</span>),
          <span class="kw">Plana</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/structure.html">structure</a></span>(<span class="fl">NA</span>, <span class="kw">given</span> <span class="kw">=</span> <span class="st">"Giovanni"</span>),
          <span class="kw">Poisson</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/structure.html">structure</a></span>(<span class="fl">113435</span>, <span class="kw">given</span> <span class="kw">=</span> <span class="st">"Simeon"</span>)
        ), <span class="kw">given</span> <span class="kw">=</span> <span class="st">"Joseph"</span>)
      ), <span class="kw">given</span> <span class="kw">=</span> <span class="st">"Leonhard"</span>)
    ), <span class="kw">given</span> <span class="kw">=</span> <span class="st">"Johann"</span>),
    <span class="kw">Bernoulli</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/structure.html">structure</a></span>(<span class="fl">NA</span>, <span class="kw">given</span> <span class="kw">=</span> <span class="st">"Nikolaus"</span>)
  ), <span class="kw">given</span> <span class="kw">=</span> <span class="st">"Jacob"</span>)
)

<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="no">students</span>, <span class="kw">give.attr</span> <span class="kw">=</span> <span class="fl">FALSE</span>)
<span class="co">#&gt; List of 1</span>
<span class="co">#&gt;  $ Bernoulli:List of 2</span>
<span class="co">#&gt;   ..$ Bernoulli:List of 2</span>
<span class="co">#&gt;   .. ..$ Bernoulli: num 1</span>
<span class="co">#&gt;   .. ..$ Euler    :List of 2</span>
<span class="co">#&gt;   .. .. ..$ Euler   : logi NA</span>
<span class="co">#&gt;   .. .. ..$ Lagrange:List of 3</span>
<span class="co">#&gt;   .. .. .. ..$ Fourier: num 68679</span>
<span class="co">#&gt;   .. .. .. ..$ Plana  : logi NA</span>
<span class="co">#&gt;   .. .. .. ..$ Poisson: num 113435</span>
<span class="co">#&gt;   ..$ Bernoulli: logi NA</span></pre></body></html></div>
<p>Consider the following exercise in list recursion:</p>
<div class="bs-callout bs-callout-primary">
<p>Filter all descendants of ‘Leonhard Euler’ while keeping the original list structure and replace all missing values by zero.</p>
</div>
<p>Here is a possible (not so efficient) solution using recursion with the <code><a href="https://rdrr.io/r/base/Recall.html">Recall()</a></code> function:</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="no">prune_replace_Euler</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">x</span>) {
  <span class="no">i</span> <span class="kw">&lt;-</span> <span class="fl">1</span>
  <span class="kw">while</span>(<span class="no">i</span> <span class="kw">&lt;=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">x</span>)) {
    <span class="kw">if</span>(<span class="fu"><a href="https://rdrr.io/r/base/identical.html">identical</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="no">x</span>)[<span class="no">i</span>], <span class="st">"Euler"</span>) <span class="kw">&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/identical.html">identical</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/attr.html">attr</a></span>(<span class="no">x</span><span class="kw">[[</span><span class="no">i</span>]], <span class="st">"given"</span>), <span class="st">"Leonhard"</span>)) {
      <span class="no">x</span><span class="kw">[[</span><span class="no">i</span>]] <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rapply.html">rapply</a></span>(<span class="no">x</span><span class="kw">[[</span><span class="no">i</span>]], <span class="kw">f</span> <span class="kw">=</span> <span class="kw">function</span>(<span class="no">x</span>) <span class="fu"><a href="https://rdrr.io/r/base/replace.html">replace</a></span>(<span class="no">x</span>, <span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="no">x</span>), <span class="fl">0</span>), <span class="kw">how</span> <span class="kw">=</span> <span class="st">"replace"</span>)
      <span class="no">i</span> <span class="kw">&lt;-</span> <span class="no">i</span> + <span class="fl">1</span>
    } <span class="kw">else</span> {
      <span class="kw">if</span>(<span class="fu"><a href="https://rdrr.io/r/base/list.html">is.list</a></span>(<span class="no">x</span><span class="kw">[[</span><span class="no">i</span>]])) {
        <span class="no">val</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Recall.html">Recall</a></span>(<span class="no">x</span><span class="kw">[[</span><span class="no">i</span>]])
        <span class="no">x</span><span class="kw">[[</span><span class="no">i</span>]] <span class="kw">&lt;-</span> <span class="no">val</span>
        <span class="no">i</span> <span class="kw">&lt;-</span> <span class="no">i</span> + !<span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span>(<span class="no">val</span>)
      } <span class="kw">else</span> {
        <span class="no">x</span><span class="kw">[[</span><span class="no">i</span>]] <span class="kw">&lt;-</span> <span class="kw">NULL</span>
      }
      <span class="kw">if</span>(<span class="fu"><a href="https://rdrr.io/r/base/all.html">all</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span>(<span class="no">x</span>, <span class="no">is.null</span>))) {
        <span class="no">x</span> <span class="kw">&lt;-</span> <span class="kw">NULL</span>
      }
    }
  }
  <span class="fu"><a href="https://rdrr.io/r/base/function.html">return</a></span>(<span class="no">x</span>)
}

<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="fu">prune_replace_Euler</span>(<span class="no">students</span>), <span class="kw">give.attr</span> <span class="kw">=</span> <span class="fl">FALSE</span>)
<span class="co">#&gt; List of 1</span>
<span class="co">#&gt;  $ Bernoulli:List of 1</span>
<span class="co">#&gt;   ..$ Bernoulli:List of 1</span>
<span class="co">#&gt;   .. ..$ Euler:List of 2</span>
<span class="co">#&gt;   .. .. ..$ Euler   : num 0</span>
<span class="co">#&gt;   .. .. ..$ Lagrange:List of 3</span>
<span class="co">#&gt;   .. .. .. ..$ Fourier: num 68679</span>
<span class="co">#&gt;   .. .. .. ..$ Plana  : num 0</span>
<span class="co">#&gt;   .. .. .. ..$ Poisson: num 113435</span></pre></body></html></div>
<p>This works, but is hardly the kind of code we would like to write for such a seemingly simple data exploration question. Moreover, this code is not very easy to follow or reason about, which makes it time-consuming to update or modify for future tasks.</p>
<p>Another approach would be to unnest the list in a more manageable (e.g. rectangular) format or use specialized packages such as <a href="https://igraph.org/r/">igraph</a> or <a href="https://CRAN.R-project.org/package=data.tree">data.tree</a> to make pruning or modifying node entries more straightforward. Note that attention must be paid to correctly include the node attributes in the transformed object as the node names themselves are not unique in the given example. This is a sensible approach for more extensive data analysis, but ideally we would like to keep the list in its original format for simple data exploration to reduce the number of processing steps and minimize the possibility of introducing mistakes in the code.</p>
<p>The recursive function above makes use of <code><a href="https://rdrr.io/r/base/rapply.html">rapply()</a></code>, a member of the base-R <strong>apply</strong>-family of functions, that allows to apply a function recursively to the elements of a nested list and decide how the returned result is structured. If you are not familiar with the <code><a href="https://rdrr.io/r/base/rapply.html">rapply()</a></code> function it might be useful to first read the function documentation <code><a href="https://rdrr.io/r/base/rapply.html">help("rapply")</a></code> or check out the first section of the <code>rrapply</code>-package vignette (<code><a href="https://rdrr.io/r/utils/browseVignettes.html">browseVignettes(package = "rrapply")</a></code>).</p>
<p>Although quite useful, the <code><a href="https://rdrr.io/r/base/rapply.html">rapply()</a></code>-function is not always sufficiently flexible in practice, e.g. for pruning elements of a nested list (as demonstrated above). The <code><a href="../../reference/rrapply.html">rrapply()</a></code> function is an attempt to enhance and update base <code><a href="https://rdrr.io/r/base/rapply.html">rapply()</a></code> to make it more generally applicable in the context of list recursion. The <code><a href="../../reference/rrapply.html">rrapply()</a></code> function builds on the native implementation of base <code><a href="https://rdrr.io/r/base/rapply.html">rapply()</a></code> in R’s C-interface and for this reason requires no other external dependencies.</p>
</div>
<div id="when-to-use-rrapply" class="section level1">
<h1 class="hasAnchor">
<a href="#when-to-use-rrapply" class="anchor"></a>When to use <code>rrapply()</code>
</h1>
<p>For illustration purposes, we will use the datasets <code>renewable_energy_by_country</code> and <code>pokedex</code> included in the <code>rrapply</code>-package. <code>renewable_energy_by_country</code> is a nested list containing the shares of renewable energy as a percentage in the total energy consumption per country in 2016. The data is publicly available at the United Nations Open SDG Data Hub <a href="https://unstats-undesa.opendata.arcgis.com/datasets/indicator-7-2-1-renewable-energy-share-in-the-total-final-energy-consumption-percent-3">UNSD-SDG07</a>. The 249 countries and areas are structured based on their geographical location according to the United Nations M49 standard <a href="https://unstats.un.org/unsd/methodology/m49/">UNSD-M49</a> The numeric values listed for each country are percentages, if no data is available the value of the country is <code>NA</code>. <code>pokedex</code> is a nested list containing various property values for each of the 151 original Pokémon.</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">rrapply</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="st">"renewable_energy_by_country"</span>)</pre></body></html></div>
<p>For convenience, we subset only the values for countries and areas in Oceania from <code>renewable_energy_by_country</code>,</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="no">renewable_oceania</span> <span class="kw">&lt;-</span> <span class="no">renewable_energy_by_country</span><span class="kw">[[</span><span class="st">"World"</span>]][<span class="st">"Oceania"</span>]
<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="no">renewable_oceania</span>, <span class="kw">list.len</span> <span class="kw">=</span> <span class="fl">3</span>, <span class="kw">give.attr</span> <span class="kw">=</span> <span class="fl">FALSE</span>)
<span class="co">#&gt; List of 1</span>
<span class="co">#&gt;  $ Oceania:List of 4</span>
<span class="co">#&gt;   ..$ Australia and New Zealand:List of 6</span>
<span class="co">#&gt;   .. ..$ Australia                        : num 9.32</span>
<span class="co">#&gt;   .. ..$ Christmas Island                 : logi NA</span>
<span class="co">#&gt;   .. ..$ Cocos (Keeling) Islands          : logi NA</span>
<span class="co">#&gt;   .. .. [list output truncated]</span>
<span class="co">#&gt;   ..$ Melanesia                :List of 5</span>
<span class="co">#&gt;   .. ..$ Fiji            : num 24.4</span>
<span class="co">#&gt;   .. ..$ New Caledonia   : num 4.03</span>
<span class="co">#&gt;   .. ..$ Papua New Guinea: num 50.3</span>
<span class="co">#&gt;   .. .. [list output truncated]</span>
<span class="co">#&gt;   ..$ Micronesia               :List of 8</span>
<span class="co">#&gt;   .. ..$ Guam                                : num 3.03</span>
<span class="co">#&gt;   .. ..$ Kiribati                            : num 45.4</span>
<span class="co">#&gt;   .. ..$ Marshall Islands                    : num 11.8</span>
<span class="co">#&gt;   .. .. [list output truncated]</span>
<span class="co">#&gt;   .. [list output truncated]</span></pre></body></html></div>
<div id="list-pruning-and-unnesting" class="section level2">
<h2 class="hasAnchor">
<a href="#list-pruning-and-unnesting" class="anchor"></a>List pruning and unnesting</h2>
<p>With base <code><a href="https://rdrr.io/r/base/rapply.html">rapply()</a></code>, there is no convenient way to prune or filter elements from the input list. The <code><a href="../../reference/rrapply.html">rrapply()</a></code> function adds an option <code>how = "prune"</code> to prune all list elements not subject to application of the function <code>f</code> from a nested list. The original list structure is retained, similar to the non-pruned versions <code>how = "replace"</code> and <code>how = "list"</code>. Using <code>how = "prune"</code>, we can for instance drop all <code>NA</code> elements from the list while preserving the original list structure:</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="co">## Drop all logical NA's while preserving list structure </span>
<span class="no">na_drop_oceania</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../../reference/rrapply.html">rrapply</a></span>(
  <span class="no">renewable_oceania</span>,
  <span class="kw">f</span> <span class="kw">=</span> <span class="no">identity</span>,
  <span class="kw">classes</span> <span class="kw">=</span> <span class="st">"numeric"</span>,
  <span class="kw">how</span> <span class="kw">=</span> <span class="st">"prune"</span>
)
<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="no">na_drop_oceania</span>, <span class="kw">list.len</span> <span class="kw">=</span> <span class="fl">3</span>, <span class="kw">give.attr</span> <span class="kw">=</span> <span class="fl">FALSE</span>)
<span class="co">#&gt; List of 1</span>
<span class="co">#&gt;  $ Oceania:List of 4</span>
<span class="co">#&gt;   ..$ Australia and New Zealand:List of 2</span>
<span class="co">#&gt;   .. ..$ Australia  : num 9.32</span>
<span class="co">#&gt;   .. ..$ New Zealand: num 32.8</span>
<span class="co">#&gt;   ..$ Melanesia                :List of 5</span>
<span class="co">#&gt;   .. ..$ Fiji            : num 24.4</span>
<span class="co">#&gt;   .. ..$ New Caledonia   : num 4.03</span>
<span class="co">#&gt;   .. ..$ Papua New Guinea: num 50.3</span>
<span class="co">#&gt;   .. .. [list output truncated]</span>
<span class="co">#&gt;   ..$ Micronesia               :List of 7</span>
<span class="co">#&gt;   .. ..$ Guam                            : num 3.03</span>
<span class="co">#&gt;   .. ..$ Kiribati                        : num 45.4</span>
<span class="co">#&gt;   .. ..$ Marshall Islands                : num 11.8</span>
<span class="co">#&gt;   .. .. [list output truncated]</span>
<span class="co">#&gt;   .. [list output truncated]</span></pre></body></html></div>
<p>Instead, set <code>how = "flatten"</code> to return a flattened unnested version of the pruned list. This is more efficient than first returning the pruned list with <code>how = "prune"</code> and unlisting or flattening the list in a subsequent step.</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="co">## Drop all logical NA's and return unnested list</span>
<span class="no">na_drop_oceania2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../../reference/rrapply.html">rrapply</a></span>(
  <span class="no">renewable_oceania</span>,
  <span class="kw">f</span> <span class="kw">=</span> <span class="no">identity</span>,
  <span class="kw">classes</span> <span class="kw">=</span> <span class="st">"numeric"</span>,
  <span class="kw">how</span> <span class="kw">=</span> <span class="st">"flatten"</span>
)
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">na_drop_oceania2</span>, <span class="kw">n</span> <span class="kw">=</span> <span class="fl">10</span>)
<span class="co">#&gt;        Australia      New Zealand             Fiji    New Caledonia </span>
<span class="co">#&gt;             9.32            32.76            24.36             4.03 </span>
<span class="co">#&gt; Papua New Guinea  Solomon Islands          Vanuatu             Guam </span>
<span class="co">#&gt;            50.34            65.73            33.67             3.03 </span>
<span class="co">#&gt;         Kiribati Marshall Islands </span>
<span class="co">#&gt;            45.43            11.75</span></pre></body></html></div>
<p>Or, use <code>how = "melt"</code> to return a melted data.frame of the pruned list similar in format to <code><a href="https://rdrr.io/pkg/reshape2/man/melt.html">reshape2::melt()</a></code> applied to a nested list. The rows of the melted data.frame contain the node paths of the elements in the pruned list. The <code>"value"</code> column contains the values of the terminal nodes analogous to the flattened list returned by <code>how = "flatten"</code>.</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="co">## Drop all logical NA's and return melted data.frame</span>
<span class="no">na_drop_oceania3</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../../reference/rrapply.html">rrapply</a></span>(
  <span class="no">renewable_oceania</span>,
  <span class="kw">f</span> <span class="kw">=</span> <span class="no">identity</span>,
  <span class="kw">classes</span> <span class="kw">=</span> <span class="st">"numeric"</span>,
  <span class="kw">how</span> <span class="kw">=</span> <span class="st">"melt"</span>
)
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">na_drop_oceania3</span>)
<span class="co">#&gt;        L1                        L2               L3 value</span>
<span class="co">#&gt; 1 Oceania Australia and New Zealand        Australia  9.32</span>
<span class="co">#&gt; 2 Oceania Australia and New Zealand      New Zealand 32.76</span>
<span class="co">#&gt; 3 Oceania                 Melanesia             Fiji 24.36</span>
<span class="co">#&gt; 4 Oceania                 Melanesia    New Caledonia  4.03</span>
<span class="co">#&gt; 5 Oceania                 Melanesia Papua New Guinea 50.34</span>
<span class="co">#&gt; 6 Oceania                 Melanesia  Solomon Islands 65.73</span></pre></body></html></div>
<p>If no names are present in a sublist of the input list, <code>how = "melt"</code> replaces the names in the melted data.frame by list element indices <code>"1"</code>, <code>"2"</code>, etc.:</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="co">## Remove all names at L2 </span>
<span class="co">## (skip this for now, these arguments are explained in the following sections)</span>
<span class="no">oceania_unnamed</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../../reference/rrapply.html">rrapply</a></span>(
  <span class="no">renewable_oceania</span>,
  <span class="kw">classes</span> <span class="kw">=</span> <span class="st">"list"</span>,
  <span class="kw">condition</span> <span class="kw">=</span> <span class="kw">function</span>(<span class="no">x</span>, <span class="no">.xname</span>) <span class="no">.xname</span> <span class="kw">==</span> <span class="st">"Oceania"</span>,
  <span class="kw">f</span> <span class="kw">=</span> <span class="no">unname</span>
)

<span class="co">## Drop all logical NA's and return melted data.frame</span>
<span class="no">na_drop_oceania4</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../../reference/rrapply.html">rrapply</a></span>(
  <span class="no">oceania_unnamed</span>,
  <span class="kw">f</span> <span class="kw">=</span> <span class="no">identity</span>,
  <span class="kw">classes</span> <span class="kw">=</span> <span class="st">"numeric"</span>,
  <span class="kw">how</span> <span class="kw">=</span> <span class="st">"melt"</span>
)
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">na_drop_oceania4</span>)
<span class="co">#&gt;        L1 L2               L3 value</span>
<span class="co">#&gt; 1 Oceania  1        Australia  9.32</span>
<span class="co">#&gt; 2 Oceania  1      New Zealand 32.76</span>
<span class="co">#&gt; 3 Oceania  2             Fiji 24.36</span>
<span class="co">#&gt; 4 Oceania  2    New Caledonia  4.03</span>
<span class="co">#&gt; 5 Oceania  2 Papua New Guinea 50.34</span>
<span class="co">#&gt; 6 Oceania  2  Solomon Islands 65.73</span></pre></body></html></div>
<p>Nested lists containing repeated observations, such as <code>pokedex</code>, can be unnested with <code>how = "bind"</code>, which expands and binds the repeated observations (i.e. sublists) as individual rows in a wide data.frame. This is similar in format to repeated application of <code><a href="https://tidyr.tidyverse.org/reference/hoist.html">tidyr::unnest_wider()</a></code> to a nested data.frame.</p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="co">## Nested list of Pokemon properties in Pokemon GO</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="st">"pokedex"</span>)

<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="no">pokedex</span>, <span class="kw">list.len</span> <span class="kw">=</span> <span class="fl">3</span>)
<span class="co">#&gt; List of 1</span>
<span class="co">#&gt;  $ pokemon:List of 151</span>
<span class="co">#&gt;   ..$ :List of 16</span>
<span class="co">#&gt;   .. ..$ id            : int 1</span>
<span class="co">#&gt;   .. ..$ num           : chr "001"</span>
<span class="co">#&gt;   .. ..$ name          : chr "Bulbasaur"</span>
<span class="co">#&gt;   .. .. [list output truncated]</span>
<span class="co">#&gt;   ..$ :List of 17</span>
<span class="co">#&gt;   .. ..$ id            : int 2</span>
<span class="co">#&gt;   .. ..$ num           : chr "002"</span>
<span class="co">#&gt;   .. ..$ name          : chr "Ivysaur"</span>
<span class="co">#&gt;   .. .. [list output truncated]</span>
<span class="co">#&gt;   ..$ :List of 15</span>
<span class="co">#&gt;   .. ..$ id            : int 3</span>
<span class="co">#&gt;   .. ..$ num           : chr "003"</span>
<span class="co">#&gt;   .. ..$ name          : chr "Venusaur"</span>
<span class="co">#&gt;   .. .. [list output truncated]</span>
<span class="co">#&gt;   .. [list output truncated]</span>

<span class="co">## Unnest list as a wide data.frame</span>
<span class="no">pokedex_wide</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../../reference/rrapply.html">rrapply</a></span>(<span class="no">pokedex</span>, <span class="kw">how</span> <span class="kw">=</span> <span class="st">"bind"</span>)

<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">pokedex_wide</span>[, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>:<span class="fl">3</span>, <span class="fl">5</span>:<span class="fl">10</span>)], <span class="kw">n</span> <span class="kw">=</span> <span class="fl">5</span>)
<span class="co">#&gt;   pokemon.id pokemon.num pokemon.name  pokemon.type pokemon.height</span>
<span class="co">#&gt; 1          1         001    Bulbasaur Grass, Poison         0.71 m</span>
<span class="co">#&gt; 2          2         002      Ivysaur Grass, Poison         0.99 m</span>
<span class="co">#&gt; 3          3         003     Venusaur Grass, Poison         2.01 m</span>
<span class="co">#&gt; 4          4         004   Charmander          Fire         0.61 m</span>
<span class="co">#&gt; 5          5         005   Charmeleon          Fire         1.09 m</span>
<span class="co">#&gt;   pokemon.weight    pokemon.candy pokemon.candy_count pokemon.egg</span>
<span class="co">#&gt; 1         6.9 kg  Bulbasaur Candy                  25        2 km</span>
<span class="co">#&gt; 2        13.0 kg  Bulbasaur Candy                 100 Not in Eggs</span>
<span class="co">#&gt; 3       100.0 kg  Bulbasaur Candy                  NA Not in Eggs</span>
<span class="co">#&gt; 4         8.5 kg Charmander Candy                  25        2 km</span>
<span class="co">#&gt; 5        19.0 kg Charmander Candy                 100 Not in Eggs</span></pre></body></html></div>
</div>
<div id="condition-function" class="section level2">
<h2 class="hasAnchor">
<a href="#condition-function" class="anchor"></a>Condition function</h2>
<p>Base <code><a href="https://rdrr.io/r/base/rapply.html">rapply()</a></code> allows to apply a function <code>f</code> to list elements of certain types or classes via the <code>classes</code> argument. <code><a href="../../reference/rrapply.html">rrapply()</a></code> generalizes this concept via the <code>condition</code> argument, which accepts any principal argument function to use as a condition or predicate to apply <code>f</code> to a subset of list elements. Conceptually, the <code>f</code> function is applied to all leaf elements for which the <code>condition</code> function exactly evaluates to <code>TRUE</code> similar to <code><a href="https://rdrr.io/r/base/Logic.html">isTRUE()</a></code>. If the <code>condition</code> argument is missing, <code>f</code> is applied to all leaf elements. In combination with <code>how = "prune"</code>, the <code>condition</code> function provides additional flexibility in selecting and filtering elements from a nested list. Using the <code>condition</code> argument, we can update the above function call to drop all <code>NA</code>’s from the list to better reflect our purpose:</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="co">## drop all NA elements using condition function</span>
<span class="no">na_drop_oceania3</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../../reference/rrapply.html">rrapply</a></span>(
  <span class="no">renewable_oceania</span>,
  <span class="kw">condition</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/funprog.html">Negate</a></span>(<span class="no">is.na</span>),
  <span class="kw">f</span> <span class="kw">=</span> <span class="no">identity</span>,
  <span class="kw">how</span> <span class="kw">=</span> <span class="st">"prune"</span>
)
<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="no">na_drop_oceania3</span>, <span class="kw">list.len</span> <span class="kw">=</span> <span class="fl">3</span>, <span class="kw">give.attr</span> <span class="kw">=</span> <span class="fl">FALSE</span>)
<span class="co">#&gt; List of 1</span>
<span class="co">#&gt;  $ Oceania:List of 4</span>
<span class="co">#&gt;   ..$ Australia and New Zealand:List of 2</span>
<span class="co">#&gt;   .. ..$ Australia  : num 9.32</span>
<span class="co">#&gt;   .. ..$ New Zealand: num 32.8</span>
<span class="co">#&gt;   ..$ Melanesia                :List of 5</span>
<span class="co">#&gt;   .. ..$ Fiji            : num 24.4</span>
<span class="co">#&gt;   .. ..$ New Caledonia   : num 4.03</span>
<span class="co">#&gt;   .. ..$ Papua New Guinea: num 50.3</span>
<span class="co">#&gt;   .. .. [list output truncated]</span>
<span class="co">#&gt;   ..$ Micronesia               :List of 7</span>
<span class="co">#&gt;   .. ..$ Guam                            : num 3.03</span>
<span class="co">#&gt;   .. ..$ Kiribati                        : num 45.4</span>
<span class="co">#&gt;   .. ..$ Marshall Islands                : num 11.8</span>
<span class="co">#&gt;   .. .. [list output truncated]</span>
<span class="co">#&gt;   .. [list output truncated]</span></pre></body></html></div>
<p>More interesting is to consider a <code>condition</code> that cannot also be defined using the <code>classes</code> argument. For instance, we can filter all countries with values that satisfy a certain numeric condition:</p>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="co">## filter all countries with values above 85%</span>
<span class="no">renewable_energy_above_85</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../../reference/rrapply.html">rrapply</a></span>(
  <span class="no">renewable_energy_by_country</span>,
  <span class="kw">condition</span> <span class="kw">=</span> <span class="kw">function</span>(<span class="no">x</span>) <span class="no">x</span> <span class="kw">&gt;</span> <span class="fl">85</span>,
  <span class="kw">how</span> <span class="kw">=</span> <span class="st">"prune"</span>
)
<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="no">renewable_energy_above_85</span>, <span class="kw">give.attr</span> <span class="kw">=</span> <span class="fl">FALSE</span>)
<span class="co">#&gt; List of 1</span>
<span class="co">#&gt;  $ World:List of 1</span>
<span class="co">#&gt;   ..$ Africa:List of 1</span>
<span class="co">#&gt;   .. ..$ Sub-Saharan Africa:List of 3</span>
<span class="co">#&gt;   .. .. ..$ Eastern Africa:List of 7</span>
<span class="co">#&gt;   .. .. .. ..$ Burundi                    : num 89.2</span>
<span class="co">#&gt;   .. .. .. ..$ Ethiopia                   : num 91.9</span>
<span class="co">#&gt;   .. .. .. ..$ Rwanda                     : num 86</span>
<span class="co">#&gt;   .. .. .. ..$ Somalia                    : num 94.7</span>
<span class="co">#&gt;   .. .. .. ..$ Uganda                     : num 88.6</span>
<span class="co">#&gt;   .. .. .. ..$ United Republic of Tanzania: num 86.1</span>
<span class="co">#&gt;   .. .. .. ..$ Zambia                     : num 88.5</span>
<span class="co">#&gt;   .. .. ..$ Middle Africa :List of 2</span>
<span class="co">#&gt;   .. .. .. ..$ Chad                            : num 85.3</span>
<span class="co">#&gt;   .. .. .. ..$ Democratic Republic of the Congo: num 97</span>
<span class="co">#&gt;   .. .. ..$ Western Africa:List of 1</span>
<span class="co">#&gt;   .. .. .. ..$ Guinea-Bissau: num 86.5</span>

<span class="co">## or by passing arguments to condition via ...</span>
<span class="no">renewable_energy_equal_0</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../../reference/rrapply.html">rrapply</a></span>(
  <span class="no">renewable_energy_by_country</span>,
  <span class="kw">condition</span> <span class="kw">=</span> <span class="st">"=="</span>,
  <span class="kw">e2</span> <span class="kw">=</span> <span class="fl">0</span>,
  <span class="kw">how</span> <span class="kw">=</span> <span class="st">"prune"</span>
)
<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="no">renewable_energy_equal_0</span>, <span class="kw">give.attr</span> <span class="kw">=</span> <span class="fl">FALSE</span>)
<span class="co">#&gt; List of 1</span>
<span class="co">#&gt;  $ World:List of 4</span>
<span class="co">#&gt;   ..$ Americas:List of 1</span>
<span class="co">#&gt;   .. ..$ Latin America and the Caribbean:List of 1</span>
<span class="co">#&gt;   .. .. ..$ Caribbean:List of 1</span>
<span class="co">#&gt;   .. .. .. ..$ Antigua and Barbuda: num 0</span>
<span class="co">#&gt;   ..$ Asia    :List of 1</span>
<span class="co">#&gt;   .. ..$ Western Asia:List of 4</span>
<span class="co">#&gt;   .. .. ..$ Bahrain: num 0</span>
<span class="co">#&gt;   .. .. ..$ Kuwait : num 0</span>
<span class="co">#&gt;   .. .. ..$ Oman   : num 0</span>
<span class="co">#&gt;   .. .. ..$ Qatar  : num 0</span>
<span class="co">#&gt;   ..$ Europe  :List of 2</span>
<span class="co">#&gt;   .. ..$ Northern Europe:List of 1</span>
<span class="co">#&gt;   .. .. ..$ Channel Islands:List of 1</span>
<span class="co">#&gt;   .. .. .. ..$ Guernsey: num 0</span>
<span class="co">#&gt;   .. ..$ Southern Europe:List of 1</span>
<span class="co">#&gt;   .. .. ..$ Gibraltar: num 0</span>
<span class="co">#&gt;   ..$ Oceania :List of 2</span>
<span class="co">#&gt;   .. ..$ Micronesia:List of 1</span>
<span class="co">#&gt;   .. .. ..$ Northern Mariana Islands: num 0</span>
<span class="co">#&gt;   .. ..$ Polynesia :List of 1</span>
<span class="co">#&gt;   .. .. ..$ Wallis and Futuna Islands: num 0</span></pre></body></html></div>
<p><strong>Remark</strong>: Note that the <code>NA</code> elements are not returned, as the <code>condition</code> function does not evaluate to <code>TRUE</code> for <code>NA</code> values. Also, the <code>f</code> argument is allowed to be missing, in which case no function is applied to the leaf elements.</p>
<p>As the <code>condition</code> function is a generalization of the <code>classes</code> argument to have more flexible control of the predicate, it is also possible to use the <code>deflt</code> argument together with <code>how = "list"</code> or <code>how = "unlist"</code> to set a default value to all leaf elements for which the <code>condition</code> does not evaluate to <code>TRUE</code>:</p>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="co">## replace all NA elements by zero</span>
<span class="no">na_zero_oceania_list</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../../reference/rrapply.html">rrapply</a></span>(
  <span class="no">renewable_oceania</span>,
  <span class="kw">condition</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/funprog.html">Negate</a></span>(<span class="no">is.na</span>),
  <span class="kw">deflt</span> <span class="kw">=</span> <span class="fl">0</span>,
  <span class="kw">how</span> <span class="kw">=</span> <span class="st">"list"</span>
)
<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="no">na_zero_oceania_list</span>, <span class="kw">list.len</span> <span class="kw">=</span> <span class="fl">3</span>, <span class="kw">give.attr</span> <span class="kw">=</span> <span class="fl">FALSE</span>)
<span class="co">#&gt; List of 1</span>
<span class="co">#&gt;  $ Oceania:List of 4</span>
<span class="co">#&gt;   ..$ Australia and New Zealand:List of 6</span>
<span class="co">#&gt;   .. ..$ Australia                        : num 9.32</span>
<span class="co">#&gt;   .. ..$ Christmas Island                 : num 0</span>
<span class="co">#&gt;   .. ..$ Cocos (Keeling) Islands          : num 0</span>
<span class="co">#&gt;   .. .. [list output truncated]</span>
<span class="co">#&gt;   ..$ Melanesia                :List of 5</span>
<span class="co">#&gt;   .. ..$ Fiji            : num 24.4</span>
<span class="co">#&gt;   .. ..$ New Caledonia   : num 4.03</span>
<span class="co">#&gt;   .. ..$ Papua New Guinea: num 50.3</span>
<span class="co">#&gt;   .. .. [list output truncated]</span>
<span class="co">#&gt;   ..$ Micronesia               :List of 8</span>
<span class="co">#&gt;   .. ..$ Guam                                : num 3.03</span>
<span class="co">#&gt;   .. ..$ Kiribati                            : num 45.4</span>
<span class="co">#&gt;   .. ..$ Marshall Islands                    : num 11.8</span>
<span class="co">#&gt;   .. .. [list output truncated]</span>
<span class="co">#&gt;   .. [list output truncated]</span></pre></body></html></div>
<p>To be consistent with base <code><a href="https://rdrr.io/r/base/rapply.html">rapply()</a></code>, the <code>deflt</code> argument can still only be used together with <code>how = "list"</code> or <code>how = "unlist"</code>.</p>
<div id="using-the-----argument" class="section level3">
<h3 class="hasAnchor">
<a href="#using-the-----argument" class="anchor"></a>Using the <code>...</code> argument</h3>
<p>The first argument to <code>f</code> always evaluates to the content of the leaf element to which <code>f</code> is applied. Any further arguments (besides the special arguments <code>.xname</code>, <code>.xpos</code>, <code>.xparents</code> and <code>.xsiblings</code> discussed below) that are independent of the node content can be supplied via the <code>...</code> argument. Since <code><a href="../../reference/rrapply.html">rrapply()</a></code> accepts a function in two of its arguments <code>f</code> and <code>condition</code>, any further arguments defined via the <code>...</code> also need to be defined as function arguments in <strong>both</strong> the <code>f</code> and <code>condition</code> function (if existing), even if they are not used in the function itself.</p>
<p>To clarify, consider the following example where we replace all <code>NA</code> elements by a value defined in a separate argument <code>newvalue</code>:</p>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="co">## this is not ok!</span>
<span class="fu"><a href="https://rdrr.io/r/base/conditions.html">tryCatch</a></span>({
  <span class="fu"><a href="../../reference/rrapply.html">rrapply</a></span>(
    <span class="no">renewable_oceania</span>,
    <span class="kw">condition</span> <span class="kw">=</span> <span class="no">is.na</span>,
    <span class="kw">f</span> <span class="kw">=</span> <span class="kw">function</span>(<span class="no">x</span>, <span class="no">newvalue</span>) <span class="no">newvalue</span>,
    <span class="kw">newvalue</span> <span class="kw">=</span> <span class="fl">0</span>,
    <span class="kw">how</span> <span class="kw">=</span> <span class="st">"replace"</span>
  )
}, <span class="kw">error</span> <span class="kw">=</span> <span class="kw">function</span>(<span class="no">error</span>) <span class="no">error</span>$<span class="no">message</span>)
<span class="co">#&gt; [1] "2 arguments passed to 'is.na' which requires 1"</span>

<span class="co">## this is ok</span>
<span class="no">na_zero_oceania_replace3</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../../reference/rrapply.html">rrapply</a></span>(
  <span class="no">renewable_oceania</span>,
  <span class="kw">condition</span> <span class="kw">=</span> <span class="kw">function</span>(<span class="no">x</span>, <span class="no">newvalue</span>) <span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="no">x</span>),
  <span class="kw">f</span> <span class="kw">=</span> <span class="kw">function</span>(<span class="no">x</span>, <span class="no">newvalue</span>) <span class="no">newvalue</span>,
  <span class="kw">newvalue</span> <span class="kw">=</span> <span class="fl">0</span>,
  <span class="kw">how</span> <span class="kw">=</span> <span class="st">"replace"</span>
)
<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="no">na_zero_oceania_replace3</span>, <span class="kw">list.len</span> <span class="kw">=</span> <span class="fl">3</span>, <span class="kw">give.attr</span> <span class="kw">=</span> <span class="fl">FALSE</span>)
<span class="co">#&gt; List of 1</span>
<span class="co">#&gt;  $ Oceania:List of 4</span>
<span class="co">#&gt;   ..$ Australia and New Zealand:List of 6</span>
<span class="co">#&gt;   .. ..$ Australia                        : num 9.32</span>
<span class="co">#&gt;   .. ..$ Christmas Island                 : num 0</span>
<span class="co">#&gt;   .. ..$ Cocos (Keeling) Islands          : num 0</span>
<span class="co">#&gt;   .. .. [list output truncated]</span>
<span class="co">#&gt;   ..$ Melanesia                :List of 5</span>
<span class="co">#&gt;   .. ..$ Fiji            : num 24.4</span>
<span class="co">#&gt;   .. ..$ New Caledonia   : num 4.03</span>
<span class="co">#&gt;   .. ..$ Papua New Guinea: num 50.3</span>
<span class="co">#&gt;   .. .. [list output truncated]</span>
<span class="co">#&gt;   ..$ Micronesia               :List of 8</span>
<span class="co">#&gt;   .. ..$ Guam                                : num 3.03</span>
<span class="co">#&gt;   .. ..$ Kiribati                            : num 45.4</span>
<span class="co">#&gt;   .. ..$ Marshall Islands                    : num 11.8</span>
<span class="co">#&gt;   .. .. [list output truncated]</span>
<span class="co">#&gt;   .. [list output truncated]</span></pre></body></html></div>
</div>
</div>
<div id="special-arguments--xname--xpos--xparents-and--xsiblings" class="section level2">
<h2 class="hasAnchor">
<a href="#special-arguments--xname--xpos--xparents-and--xsiblings" class="anchor"></a>Special arguments <code>.xname</code>, <code>.xpos</code>, <code>.xparents</code> and <code>.xsiblings</code>
</h2>
<p>In base <code><a href="https://rdrr.io/r/base/rapply.html">rapply()</a></code>, the <code>f</code> function only has access to the content of the list element under evaluation through its principal argument, and there is no convenient way to access its name or location in the nested list from inside the <code>f</code> function. This makes <code><a href="https://rdrr.io/r/base/rapply.html">rapply()</a></code> impractical if we want to apply a function <code>f</code> that relies on e.g. the name or position of a node as in the <code>students</code> example above. To overcome this limitation, <code><a href="../../reference/rrapply.html">rrapply()</a></code> allows the use of the special arguments <code>.xname</code>, <code>.xpos</code>, <code>.xparents</code> and <code>.xsiblings</code> inside the <code>f</code> and <code>condition</code> functions (in addition to the principal function argument). <code>.xname</code> evaluates to the name of the list element, <code>.xpos</code> evaluates to the position of the element in the nested list structured as an integer vector, <code>.xparents</code> evaluates to a vector of all parent node names in the path to the current list element, and <code>.xsiblings</code> evaluates to the parent list containing the current list element and all of its direct siblings.</p>
<p>Using the <code>.xname</code> and <code>.xpos</code> arguments, we can transform or filter list elements based on their names or positions in the nested list:</p>
<div class="sourceCode" id="cb14"><html><body><pre class="r"><span class="co">## apply a function using the name of the node</span>
<span class="no">renewable_oceania_text</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../../reference/rrapply.html">rrapply</a></span>(
  <span class="no">renewable_oceania</span>,
  <span class="kw">f</span> <span class="kw">=</span> <span class="kw">function</span>(<span class="no">x</span>, <span class="no">.xname</span>) <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span>(<span class="st">"Renewable energy in %s: %.2f%%"</span>, <span class="no">.xname</span>, <span class="no">x</span>),
  <span class="kw">condition</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/funprog.html">Negate</a></span>(<span class="no">is.na</span>),
  <span class="kw">how</span> <span class="kw">=</span> <span class="st">"flatten"</span>
)
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">renewable_oceania_text</span>, <span class="kw">n</span> <span class="kw">=</span> <span class="fl">5</span>)
<span class="co">#&gt;                                      Australia </span>
<span class="co">#&gt;         "Renewable energy in Australia: 9.32%" </span>
<span class="co">#&gt;                                    New Zealand </span>
<span class="co">#&gt;      "Renewable energy in New Zealand: 32.76%" </span>
<span class="co">#&gt;                                           Fiji </span>
<span class="co">#&gt;             "Renewable energy in Fiji: 24.36%" </span>
<span class="co">#&gt;                                  New Caledonia </span>
<span class="co">#&gt;     "Renewable energy in New Caledonia: 4.03%" </span>
<span class="co">#&gt;                               Papua New Guinea </span>
<span class="co">#&gt; "Renewable energy in Papua New Guinea: 50.34%"</span>

<span class="co">## extract values based on country names</span>
<span class="no">renewable_benelux</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../../reference/rrapply.html">rrapply</a></span>(
  <span class="no">renewable_energy_by_country</span>,
  <span class="kw">condition</span> <span class="kw">=</span> <span class="kw">function</span>(<span class="no">x</span>, <span class="no">.xname</span>) <span class="no">.xname</span> <span class="kw">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Belgium"</span>, <span class="st">"Netherlands"</span>, <span class="st">"Luxembourg"</span>),
  <span class="kw">how</span> <span class="kw">=</span> <span class="st">"prune"</span>
)
<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="no">renewable_benelux</span>, <span class="kw">give.attr</span> <span class="kw">=</span> <span class="fl">FALSE</span>)
<span class="co">#&gt; List of 1</span>
<span class="co">#&gt;  $ World:List of 1</span>
<span class="co">#&gt;   ..$ Europe:List of 1</span>
<span class="co">#&gt;   .. ..$ Western Europe:List of 3</span>
<span class="co">#&gt;   .. .. ..$ Belgium    : num 9.14</span>
<span class="co">#&gt;   .. .. ..$ Luxembourg : num 13.5</span>
<span class="co">#&gt;   .. .. ..$ Netherlands: num 5.78</span></pre></body></html></div>
<p>Knowing that Europe is located under the node <code>renewable_energy_by_country[[c(1, 5)]]</code>, we can filter all European countries with a renewable energy share above 50 percent by using the <code>.xpos</code> argument,</p>
<div class="sourceCode" id="cb15"><html><body><pre class="r"><span class="co">## filter European countries with value above 50%</span>
<span class="no">renewable_europe_above_50</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../../reference/rrapply.html">rrapply</a></span>(
  <span class="no">renewable_energy_by_country</span>,
  <span class="kw">condition</span> <span class="kw">=</span> <span class="kw">function</span>(<span class="no">x</span>, <span class="no">.xpos</span>) <span class="fu"><a href="https://rdrr.io/r/base/identical.html">identical</a></span>(<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">.xpos</span>, <span class="fl">2</span>), <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1L</span>, <span class="fl">5L</span>)) <span class="kw">&amp;</span> <span class="no">x</span> <span class="kw">&gt;</span> <span class="fl">50</span>,
  <span class="kw">how</span> <span class="kw">=</span> <span class="st">"prune"</span>
)
<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="no">renewable_europe_above_50</span>, <span class="kw">give.attr</span> <span class="kw">=</span> <span class="fl">FALSE</span>)
<span class="co">#&gt; List of 1</span>
<span class="co">#&gt;  $ World:List of 1</span>
<span class="co">#&gt;   ..$ Europe:List of 2</span>
<span class="co">#&gt;   .. ..$ Northern Europe:List of 3</span>
<span class="co">#&gt;   .. .. ..$ Iceland: num 78.1</span>
<span class="co">#&gt;   .. .. ..$ Norway : num 59.5</span>
<span class="co">#&gt;   .. .. ..$ Sweden : num 51.4</span>
<span class="co">#&gt;   .. ..$ Western Europe :List of 1</span>
<span class="co">#&gt;   .. .. ..$ Liechtenstein: num 62.9</span></pre></body></html></div>
<p>This can be done more conveniently using the <code>.xparents</code> argument, as this does not require us to look up the location of Europe in the list beforehand,</p>
<div class="sourceCode" id="cb16"><html><body><pre class="r"><span class="co">## filter European countries with value above 50%</span>
<span class="no">renewable_europe_above_50</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../../reference/rrapply.html">rrapply</a></span>(
  <span class="no">renewable_energy_by_country</span>,
  <span class="kw">condition</span> <span class="kw">=</span> <span class="kw">function</span>(<span class="no">x</span>, <span class="no">.xparents</span>) <span class="st">"Europe"</span> <span class="kw">%in%</span> <span class="no">.xparents</span> <span class="kw">&amp;</span> <span class="no">x</span> <span class="kw">&gt;</span> <span class="fl">50</span>,
  <span class="kw">how</span> <span class="kw">=</span> <span class="st">"prune"</span>
)
<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="no">renewable_europe_above_50</span>, <span class="kw">give.attr</span> <span class="kw">=</span> <span class="fl">FALSE</span>)
<span class="co">#&gt; List of 1</span>
<span class="co">#&gt;  $ World:List of 1</span>
<span class="co">#&gt;   ..$ Europe:List of 2</span>
<span class="co">#&gt;   .. ..$ Northern Europe:List of 3</span>
<span class="co">#&gt;   .. .. ..$ Iceland: num 78.1</span>
<span class="co">#&gt;   .. .. ..$ Norway : num 59.5</span>
<span class="co">#&gt;   .. .. ..$ Sweden : num 51.4</span>
<span class="co">#&gt;   .. ..$ Western Europe :List of 1</span>
<span class="co">#&gt;   .. .. ..$ Liechtenstein: num 62.9</span></pre></body></html></div>
<p>Using the <code>.xpos</code> argument, we could look up the location of a particular country in the nested list,</p>
<div class="sourceCode" id="cb17"><html><body><pre class="r"><span class="co">## look up position of Sweden in list</span>
(<span class="no">xpos_sweden</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../../reference/rrapply.html">rrapply</a></span>(
  <span class="no">renewable_energy_by_country</span>,
  <span class="kw">condition</span> <span class="kw">=</span> <span class="kw">function</span>(<span class="no">x</span>, <span class="no">.xname</span>) <span class="fu"><a href="https://rdrr.io/r/base/identical.html">identical</a></span>(<span class="no">.xname</span>, <span class="st">"Sweden"</span>),
  <span class="kw">f</span> <span class="kw">=</span> <span class="kw">function</span>(<span class="no">x</span>, <span class="no">.xpos</span>) <span class="no">.xpos</span>,
  <span class="kw">how</span> <span class="kw">=</span> <span class="st">"flatten"</span>
))
<span class="co">#&gt; $Sweden</span>
<span class="co">#&gt; [1]  1  5  2 14</span>
<span class="no">renewable_energy_by_country</span><span class="kw">[[</span><span class="no">xpos_sweden</span>$<span class="no">Sweden</span>]]
<span class="co">#&gt; [1] 51.35</span>
<span class="co">#&gt; attr(,"M49-code")</span>
<span class="co">#&gt; [1] "752"</span></pre></body></html></div>
<p>Instead, using the <code>.xsiblings</code> argument we could look up the direct neighbors of a particular country in the nested list,</p>
<div class="sourceCode" id="cb18"><html><body><pre class="r"><span class="co">## look up sibling countries of Sweden in list</span>
<span class="no">siblings_sweden</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../../reference/rrapply.html">rrapply</a></span>(
  <span class="no">renewable_energy_by_country</span>,
  <span class="kw">condition</span> <span class="kw">=</span> <span class="kw">function</span>(<span class="no">x</span>, <span class="no">.xsiblings</span>) <span class="st">"Sweden"</span> <span class="kw">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="no">.xsiblings</span>),
  <span class="kw">how</span> <span class="kw">=</span> <span class="st">"flatten"</span>
)
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">siblings_sweden</span>, <span class="kw">n</span> <span class="kw">=</span> <span class="fl">10</span>)
<span class="co">#&gt; Aland Islands       Denmark       Estonia Faroe Islands       Finland </span>
<span class="co">#&gt;            NA         33.06         26.55          4.24         42.03 </span>
<span class="co">#&gt;       Iceland       Ireland   Isle of Man        Latvia     Lithuania </span>
<span class="co">#&gt;         78.07          8.65          4.30         38.48         31.42</span></pre></body></html></div>
<p>We could also use the <code>.xpos</code> argument to determine the maximum depth of the list or the length of the longest sublist as follows,</p>
<div class="sourceCode" id="cb19"><html><body><pre class="r"><span class="co">## maximum list depth</span>
<span class="no">depth_all</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../../reference/rrapply.html">rrapply</a></span>(
  <span class="no">renewable_energy_by_country</span>,
  <span class="kw">f</span> <span class="kw">=</span> <span class="kw">function</span>(<span class="no">x</span>, <span class="no">.xpos</span>) <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">.xpos</span>),
  <span class="kw">how</span> <span class="kw">=</span> <span class="st">"unlist"</span>
)
<span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(<span class="no">depth_all</span>)
<span class="co">#&gt; [1] 5</span>

<span class="co">## longest sublist length</span>
<span class="no">sublist_count</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../../reference/rrapply.html">rrapply</a></span>(
  <span class="no">renewable_energy_by_country</span>,
  <span class="kw">f</span> <span class="kw">=</span> <span class="kw">function</span>(<span class="no">x</span>, <span class="no">.xpos</span>) <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(<span class="no">.xpos</span>),
  <span class="kw">how</span> <span class="kw">=</span> <span class="st">"unlist"</span>
)
<span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(<span class="no">sublist_count</span>)
<span class="co">#&gt; [1] 28</span></pre></body></html></div>
<p>When unnesting nested lists with <code>how = "bind"</code>, the <code>.xname</code>, <code>.xpos</code> or <code>.xparents</code> arguments can be useful to parse only a particular set of data.frame columns:</p>
<div class="sourceCode" id="cb20"><html><body><pre class="r"><span class="co">## parse only Pokemon number, name and type columns </span>
<span class="no">pokedex_small</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../../reference/rrapply.html">rrapply</a></span>(
  <span class="no">pokedex</span>,
  <span class="kw">condition</span> <span class="kw">=</span> <span class="kw">function</span>(<span class="no">x</span>, <span class="no">.xpos</span>, <span class="no">.xname</span>) {
    <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">.xpos</span>) <span class="kw">&lt;</span> <span class="fl">4</span> <span class="kw">&amp;</span> <span class="no">.xname</span> <span class="kw">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"num"</span>, <span class="st">"name"</span>, <span class="st">"type"</span>)
    },
  <span class="kw">how</span> <span class="kw">=</span> <span class="st">"bind"</span>
)

<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">pokedex_small</span>)
<span class="co">#&gt;   pokemon.num pokemon.name  pokemon.type</span>
<span class="co">#&gt; 1         001    Bulbasaur Grass, Poison</span>
<span class="co">#&gt; 2         002      Ivysaur Grass, Poison</span>
<span class="co">#&gt; 3         003     Venusaur Grass, Poison</span>
<span class="co">#&gt; 4         004   Charmander          Fire</span>
<span class="co">#&gt; 5         005   Charmeleon          Fire</span>
<span class="co">#&gt; 6         006    Charizard  Fire, Flying</span></pre></body></html></div>
</div>
<div id="avoid-recursing-into-list-nodes" class="section level2">
<h2 class="hasAnchor">
<a href="#avoid-recursing-into-list-nodes" class="anchor"></a>Avoid recursing into list nodes</h2>
<p>By default, if <code>classes = "ANY"</code> both base <code><a href="https://rdrr.io/r/base/rapply.html">rapply()</a></code> and <code><a href="../../reference/rrapply.html">rrapply()</a></code> recurse into any list-like element. Using <code>classes = "list"</code> in base <code><a href="https://rdrr.io/r/base/rapply.html">rapply()</a></code> has no effect as the function descends into any list node before evaluating the <code>classes</code> argument. In contrast, <code><a href="../../reference/rrapply.html">rrapply()</a></code> does detect <code>classes = "list"</code>, in which case the <code>f</code> function is applied to list elements that satisfy the <code>condition</code> function. If the <code>condition</code> is not satisfied for a list element, <code><a href="../../reference/rrapply.html">rrapply()</a></code> will recurse further into the sublist, apply the <code>f</code> function to the nodes that satisfy <code>condition</code> and so on. The use of <code>classes = "list"</code> tells <code><a href="../../reference/rrapply.html">rrapply()</a></code> to not descend into list objects by default. For this reason this behavior can only be triggered with the <code>classes</code> argument and <em>not</em> through the use of e.g. <code>condition = is.list</code>.</p>
<p>The choice <code>classes = "list"</code> is useful to calculate summary statistics across nodes or to look up the position of intermediate nodes in a nested list. To illustrate, we can return the mean and standard deviation of the renewable energy share in Europe as follows:</p>
<div class="sourceCode" id="cb21"><html><body><pre class="r"><span class="co">## compute mean value of Europe</span>
<span class="fu"><a href="../../reference/rrapply.html">rrapply</a></span>(
  <span class="no">renewable_energy_by_country</span>,
  <span class="kw">classes</span> <span class="kw">=</span> <span class="st">"list"</span>,
  <span class="kw">condition</span> <span class="kw">=</span> <span class="kw">function</span>(<span class="no">x</span>, <span class="no">.xname</span>) <span class="no">.xname</span> <span class="kw">==</span> <span class="st">"Europe"</span>,
  <span class="kw">f</span> <span class="kw">=</span> <span class="kw">function</span>(<span class="no">x</span>) <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(
    <span class="kw">mean</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span>(<span class="no">x</span>), <span class="kw">na.rm</span> <span class="kw">=</span> <span class="fl">TRUE</span>),
    <span class="kw">sd</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span>(<span class="no">x</span>), <span class="kw">na.rm</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
  ),
  <span class="kw">how</span> <span class="kw">=</span> <span class="st">"flatten"</span>
)
<span class="co">#&gt; $Europe</span>
<span class="co">#&gt; $Europe$mean</span>
<span class="co">#&gt; [1] 22.36565</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $Europe$sd</span>
<span class="co">#&gt; [1] 17.12639</span></pre></body></html></div>
<p><strong>Remark</strong>: Note that the principal <code>x</code> argument in the <code>f</code> function now evaluates to a list for the node satisfying the <code>condition</code>. For this reason, we first <code>unlist</code> the sublist before passing it to <code>mean</code> and <code>sd</code>.</p>
<p>We can use the <code>.xpos</code> argument to apply the <code>f</code> function only at specific locations or depths in the nested list. For instance, we could return the mean renewable energy shares for each continent by making use of the fact that the <code>.xpos</code> vector of each continent has length (i.e. depth) 2:</p>
<div class="sourceCode" id="cb22"><html><body><pre class="r"><span class="co">## compute mean value of each continent</span>
<span class="no">renewable_continent_summary</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../../reference/rrapply.html">rrapply</a></span>(
  <span class="no">renewable_energy_by_country</span>,
  <span class="kw">classes</span> <span class="kw">=</span> <span class="st">"list"</span>,
  <span class="kw">condition</span> <span class="kw">=</span> <span class="kw">function</span>(<span class="no">x</span>, <span class="no">.xpos</span>) <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">.xpos</span>) <span class="kw">==</span> <span class="fl">2</span>,
  <span class="kw">f</span> <span class="kw">=</span> <span class="kw">function</span>(<span class="no">x</span>) <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span>(<span class="no">x</span>), <span class="kw">na.rm</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
)

<span class="co">## Antarctica has a missing value</span>
<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="no">renewable_continent_summary</span>, <span class="kw">give.attr</span> <span class="kw">=</span> <span class="fl">FALSE</span>)
<span class="co">#&gt; List of 1</span>
<span class="co">#&gt;  $ World:List of 6</span>
<span class="co">#&gt;   ..$ Africa    : num 54.3</span>
<span class="co">#&gt;   ..$ Americas  : num 18.2</span>
<span class="co">#&gt;   ..$ Antarctica: logi NA</span>
<span class="co">#&gt;   ..$ Asia      : num 17.9</span>
<span class="co">#&gt;   ..$ Europe    : num 22.4</span>
<span class="co">#&gt;   ..$ Oceania   : num 17.8</span></pre></body></html></div>
<p>If <code>classes = "list"</code>, the <code>f</code> function is only applied to the (non-terminal) list nodes. If <code>classes = "ANY"</code>, the <code>f</code> function is only applied to any (terminal) non-list node. To apply <code>f</code> to any terminal <em>and</em> non-terminal node of the nested list, we should combine <code>classes = c("list", "ANY")</code>. This is illustrated by searching both terminal and non-terminal nodes for the country or region with M49-code <code>"155"</code> (Western Europe):</p>
<div class="sourceCode" id="cb23"><html><body><pre class="r"><span class="co">## Filter country or region by M49-code</span>
<span class="fu"><a href="../../reference/rrapply.html">rrapply</a></span>(
  <span class="no">renewable_energy_by_country</span>,
  <span class="kw">classes</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"list"</span>, <span class="st">"ANY"</span>),
  <span class="kw">condition</span> <span class="kw">=</span> <span class="kw">function</span>(<span class="no">x</span>) <span class="fu"><a href="https://rdrr.io/r/base/attr.html">attr</a></span>(<span class="no">x</span>, <span class="st">"M49-code"</span>) <span class="kw">==</span> <span class="st">"155"</span>,
  <span class="kw">f</span> <span class="kw">=</span> <span class="kw">function</span>(<span class="no">x</span>, <span class="no">.xname</span>) <span class="no">.xname</span>,
  <span class="kw">how</span> <span class="kw">=</span> <span class="st">"unlist"</span>
)
<span class="co">#&gt; World.Europe.Western Europe </span>
<span class="co">#&gt;            "Western Europe"</span></pre></body></html></div>
<p>Another illustrating example is to preprocess certain list nodes before unnesting the nested list. Here, we extract the Pokémon evolutions in <code>pokedex</code> with and without pre-processing of the Pokémon evolution list nodes:</p>
<div class="sourceCode" id="cb24"><html><body><pre class="r"><span class="co">## Pokemon evolution columns without pre-processing</span>
<span class="no">pokedex_wide1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../../reference/rrapply.html">rrapply</a></span>(
  <span class="no">pokedex</span>,
  <span class="kw">condition</span> <span class="kw">=</span> <span class="kw">function</span>(<span class="no">x</span>, <span class="no">.xparents</span>) <span class="fu"><a href="https://rdrr.io/r/base/any.html">any</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span>(<span class="st">"name|evolution"</span>, <span class="no">.xparents</span>)),
  <span class="kw">how</span> <span class="kw">=</span> <span class="st">"bind"</span>
)

<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">pokedex_wide1</span>, <span class="kw">n</span> <span class="kw">=</span> <span class="fl">3</span>)
<span class="co">#&gt;   pokemon.name pokemon.next_evolution.1.num pokemon.next_evolution.1.name</span>
<span class="co">#&gt; 1    Bulbasaur                          002                       Ivysaur</span>
<span class="co">#&gt; 2      Ivysaur                          003                      Venusaur</span>
<span class="co">#&gt; 3     Venusaur                         &lt;NA&gt;                          &lt;NA&gt;</span>
<span class="co">#&gt;   pokemon.next_evolution.2.num pokemon.next_evolution.2.name</span>
<span class="co">#&gt; 1                          003                      Venusaur</span>
<span class="co">#&gt; 2                         &lt;NA&gt;                          &lt;NA&gt;</span>
<span class="co">#&gt; 3                         &lt;NA&gt;                          &lt;NA&gt;</span>
<span class="co">#&gt;   pokemon.prev_evolution.1.num pokemon.prev_evolution.1.name</span>
<span class="co">#&gt; 1                         &lt;NA&gt;                          &lt;NA&gt;</span>
<span class="co">#&gt; 2                          001                     Bulbasaur</span>
<span class="co">#&gt; 3                          001                     Bulbasaur</span>
<span class="co">#&gt;   pokemon.prev_evolution.2.num pokemon.prev_evolution.2.name</span>
<span class="co">#&gt; 1                         &lt;NA&gt;                          &lt;NA&gt;</span>
<span class="co">#&gt; 2                         &lt;NA&gt;                          &lt;NA&gt;</span>
<span class="co">#&gt; 3                          002                       Ivysaur</span>
<span class="co">#&gt;   pokemon.next_evolution.3.num pokemon.next_evolution.3.name</span>
<span class="co">#&gt; 1                         &lt;NA&gt;                          &lt;NA&gt;</span>
<span class="co">#&gt; 2                         &lt;NA&gt;                          &lt;NA&gt;</span>
<span class="co">#&gt; 3                         &lt;NA&gt;                          &lt;NA&gt;</span>

<span class="co">## Pokemon evolution columns simplified to character vectors </span>
<span class="no">pokedex_wide2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../../reference/rrapply.html">rrapply</a></span>(
  <span class="no">pokedex</span>,
  <span class="kw">classes</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"character"</span>, <span class="st">"list"</span>),
  <span class="kw">condition</span> <span class="kw">=</span> <span class="kw">function</span>(<span class="no">x</span>, <span class="no">.xparents</span>) <span class="fu"><a href="https://rdrr.io/r/base/any.html">any</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span>(<span class="st">"name|evolution"</span>, <span class="no">.xparents</span>)),
  <span class="kw">f</span> <span class="kw">=</span> <span class="kw">function</span>(<span class="no">x</span>) <span class="kw">if</span>(<span class="fu"><a href="https://rdrr.io/r/base/list.html">is.list</a></span>(<span class="no">x</span>)) <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span>(<span class="no">x</span>, <span class="no">`[[`</span>, <span class="st">"name"</span>) <span class="kw">else</span> <span class="no">x</span>,
  <span class="kw">how</span> <span class="kw">=</span> <span class="st">"bind"</span>
)

<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">pokedex_wide2</span>, <span class="kw">n</span> <span class="kw">=</span> <span class="fl">9</span>)
<span class="co">#&gt;   pokemon.name pokemon.next_evolution pokemon.prev_evolution</span>
<span class="co">#&gt; 1    Bulbasaur      Ivysaur, Venusaur                     NA</span>
<span class="co">#&gt; 2      Ivysaur               Venusaur              Bulbasaur</span>
<span class="co">#&gt; 3     Venusaur                     NA     Bulbasaur, Ivysaur</span>
<span class="co">#&gt; 4   Charmander  Charmeleon, Charizard                     NA</span>
<span class="co">#&gt; 5   Charmeleon              Charizard             Charmander</span>
<span class="co">#&gt; 6    Charizard                     NA Charmander, Charmeleon</span>
<span class="co">#&gt; 7     Squirtle   Wartortle, Blastoise                     NA</span>
<span class="co">#&gt; 8    Wartortle              Blastoise               Squirtle</span>
<span class="co">#&gt; 9    Blastoise                     NA    Squirtle, Wartortle</span></pre></body></html></div>
</div>
<div id="recursive-list-node-modification" class="section level2">
<h2 class="hasAnchor">
<a href="#recursive-list-node-modification" class="anchor"></a>Recursive list node modification</h2>
<p>If <code>classes = "list"</code>, <code><a href="../../reference/rrapply.html">rrapply()</a></code> applies the <code>f</code> function to any list element that satisfies the <code>condition</code> function, but will not recurse further into these list elements. This makes it for instance impossible to recursively update the name of each list element in a nested list, as <code><a href="../../reference/rrapply.html">rrapply()</a></code> stops recursing after updating the first list layer. For this purpose, set <code>classes = "list"</code> combined with <code>how = "recurse"</code>, in which case <code><a href="../../reference/rrapply.html">rrapply()</a></code> recurses further into any <em>updated</em> list element after application of the <code>f</code> function (using <code>how = "replace"</code>). In this context, the <code>condition</code> argument is interpreted as a passing criterion: as long as the <code>condition</code> and <code>classes</code> arguments are satisfied, <code><a href="../../reference/rrapply.html">rrapply()</a></code> will try to recurse further into any list-like element.</p>
<p>Using <code>how = "recurse"</code>, we can recursively replace all names in <code>renewable_energy_by_country</code> by their M49-codes:</p>
<div class="sourceCode" id="cb25"><html><body><pre class="r"><span class="co">## replace country names by M-49 codes</span>
<span class="no">renewable_M49</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../../reference/rrapply.html">rrapply</a></span>(
  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="no">renewable_energy_by_country</span>),
  <span class="kw">classes</span> <span class="kw">=</span> <span class="st">"list"</span>,
  <span class="kw">f</span> <span class="kw">=</span> <span class="kw">function</span>(<span class="no">x</span>) {
    <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="no">x</span>) <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">vapply</a></span>(<span class="no">x</span>, <span class="no">attr</span>, <span class="fu"><a href="https://rdrr.io/r/base/character.html">character</a></span>(<span class="fl">1L</span>), <span class="kw">which</span> <span class="kw">=</span> <span class="st">"M49-code"</span>)
    <span class="fu"><a href="https://rdrr.io/r/base/function.html">return</a></span>(<span class="no">x</span>)
  },
  <span class="kw">how</span> <span class="kw">=</span> <span class="st">"recurse"</span>
)

<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="no">renewable_M49</span><span class="kw">[[</span><span class="fl">1</span>]], <span class="kw">max.level</span> <span class="kw">=</span> <span class="fl">3</span>, <span class="kw">list.len</span> <span class="kw">=</span> <span class="fl">3</span>, <span class="kw">give.attr</span> <span class="kw">=</span> <span class="fl">FALSE</span>)
<span class="co">#&gt; List of 1</span>
<span class="co">#&gt;  $ 001:List of 6</span>
<span class="co">#&gt;   ..$ 002:List of 2</span>
<span class="co">#&gt;   .. ..$ 015:List of 7</span>
<span class="co">#&gt;   .. ..$ 202:List of 4</span>
<span class="co">#&gt;   ..$ 019:List of 2</span>
<span class="co">#&gt;   .. ..$ 419:List of 3</span>
<span class="co">#&gt;   .. ..$ 021:List of 5</span>
<span class="co">#&gt;   ..$ 010: logi NA</span>
<span class="co">#&gt;   .. [list output truncated]</span></pre></body></html></div>
<p><strong>Remark</strong>: Here we passed <code><a href="https://rdrr.io/r/base/list.html">list(renewable_energy_by_country)</a></code> to the call of <code><a href="../../reference/rrapply.html">rrapply()</a></code> in order to start application of the <code>f</code> function at the level of the list <code>renewable_energy_by_country</code> itself, instead of starting at its list elements.</p>
</div>
<div id="miscellaneous" class="section level2">
<h2 class="hasAnchor">
<a href="#miscellaneous" class="anchor"></a>Miscellaneous</h2>
<div id="avoid-recursing-into-data-frames" class="section level3">
<h3 class="hasAnchor">
<a href="#avoid-recursing-into-data-frames" class="anchor"></a>Avoid recursing into data.frames</h3>
<p>If <code>classes = "ANY"</code>, <code><a href="../../reference/rrapply.html">rrapply()</a></code> recurses into any list-like object equivalent to base <code><a href="https://rdrr.io/r/base/rapply.html">rapply()</a></code>. Since data.frames are list-like objects, the <code>f</code> function is applied to the individual columns instead of the data.frame object as a whole. To avoid this behavior, set <code>classes = "data.frame"</code>, in which case the <code>f</code> and <code>condition</code> functions are applied directly to the data.frame object itself and not its columns. Note that with base <code><a href="https://rdrr.io/r/base/rapply.html">rapply()</a></code> using <code>classes = "data.frame"</code> has no effect as <code><a href="https://rdrr.io/r/base/rapply.html">rapply()</a></code> descends into the columns of any data.frame object before evaluating the <code>classes</code> argument.</p>
<div class="sourceCode" id="cb26"><html><body><pre class="r"><span class="co">## create a list of data.frames</span>
<span class="no">oceania_df</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(
  <span class="kw">Oceania</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(
    <span class="no">renewable_oceania</span><span class="kw">[[</span><span class="st">"Oceania"</span>]],
    <span class="kw">FUN</span> <span class="kw">=</span> <span class="kw">function</span>(<span class="no">x</span>) <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(
      <span class="kw">Name</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="no">x</span>),
      <span class="kw">value</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span>(<span class="no">x</span>),
      <span class="kw">stringsAsFactors</span> <span class="kw">=</span> <span class="fl">FALSE</span>
    )
  )
)

<span class="co">## this does not work!</span>
<span class="fu"><a href="https://rdrr.io/r/base/conditions.html">tryCatch</a></span>({
  <span class="fu"><a href="../../reference/rrapply.html">rrapply</a></span>(
    <span class="no">oceania_df</span>,
    <span class="kw">f</span> <span class="kw">=</span> <span class="kw">function</span>(<span class="no">x</span>) <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span>(<span class="no">x</span>, !<span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="no">value</span>)), <span class="co">## filter NA-rows of data.frame</span>
    <span class="kw">how</span> <span class="kw">=</span> <span class="st">"replace"</span>
  )
}, <span class="kw">error</span> <span class="kw">=</span> <span class="kw">function</span>(<span class="no">error</span>) <span class="no">error</span>$<span class="no">message</span>)
<span class="co">#&gt; [1] "object 'value' not found"</span>

<span class="co">## this does work</span>
<span class="fu"><a href="../../reference/rrapply.html">rrapply</a></span>(
  <span class="no">oceania_df</span>,
  <span class="kw">classes</span> <span class="kw">=</span> <span class="st">"data.frame"</span>,
  <span class="kw">f</span> <span class="kw">=</span> <span class="kw">function</span>(<span class="no">x</span>) <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span>(<span class="no">x</span>, !<span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="no">value</span>)),
  <span class="kw">how</span> <span class="kw">=</span> <span class="st">"replace"</span>
)
<span class="co">#&gt; $Oceania</span>
<span class="co">#&gt; $Oceania$`Australia and New Zealand`</span>
<span class="co">#&gt;                    Name value</span>
<span class="co">#&gt; Australia     Australia  9.32</span>
<span class="co">#&gt; New Zealand New Zealand 32.76</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $Oceania$Melanesia</span>
<span class="co">#&gt;                              Name value</span>
<span class="co">#&gt; Fiji                         Fiji 24.36</span>
<span class="co">#&gt; New Caledonia       New Caledonia  4.03</span>
<span class="co">#&gt; Papua New Guinea Papua New Guinea 50.34</span>
<span class="co">#&gt; Solomon Islands   Solomon Islands 65.73</span>
<span class="co">#&gt; Vanuatu                   Vanuatu 33.67</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $Oceania$Micronesia</span>
<span class="co">#&gt;                                                              Name value</span>
<span class="co">#&gt; Guam                                                         Guam  3.03</span>
<span class="co">#&gt; Kiribati                                                 Kiribati 45.43</span>
<span class="co">#&gt; Marshall Islands                                 Marshall Islands 11.75</span>
<span class="co">#&gt; Micronesia (Federated States of) Micronesia (Federated States of)  1.64</span>
<span class="co">#&gt; Nauru                                                       Nauru 31.44</span>
<span class="co">#&gt; Northern Mariana Islands                 Northern Mariana Islands  0.00</span>
<span class="co">#&gt; Palau                                                       Palau  0.02</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $Oceania$Polynesia</span>
<span class="co">#&gt;                                                Name value</span>
<span class="co">#&gt; American Samoa                       American Samoa  1.00</span>
<span class="co">#&gt; Cook Islands                           Cook Islands  1.90</span>
<span class="co">#&gt; French Polynesia                   French Polynesia 11.06</span>
<span class="co">#&gt; Niue                                           Niue 22.07</span>
<span class="co">#&gt; Samoa                                         Samoa 27.30</span>
<span class="co">#&gt; Tonga                                         Tonga  1.98</span>
<span class="co">#&gt; Tuvalu                                       Tuvalu 11.76</span>
<span class="co">#&gt; Wallis and Futuna Islands Wallis and Futuna Islands  0.00</span></pre></body></html></div>
<p><strong>Remark</strong>: Note that the same result can also be obtained using <code>classes = "list"</code> and checking that the list element under evaluation is a data.frame:</p>
<div class="sourceCode" id="cb27"><html><body><pre class="r"><span class="fu"><a href="../../reference/rrapply.html">rrapply</a></span>(
  <span class="no">oceania_df</span>,
  <span class="kw">classes</span> <span class="kw">=</span> <span class="st">"list"</span>,
  <span class="kw">condition</span> <span class="kw">=</span> <span class="no">is.data.frame</span>,
  <span class="kw">f</span> <span class="kw">=</span> <span class="kw">function</span>(<span class="no">x</span>) <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span>(<span class="no">x</span>, !<span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="no">value</span>)),
  <span class="kw">how</span> <span class="kw">=</span> <span class="st">"replace"</span>
)</pre></body></html></div>
<div id="list-attributes" class="section level4">
<h4 class="hasAnchor">
<a href="#list-attributes" class="anchor"></a>List attributes</h4>
<p>Base <code><a href="https://rdrr.io/r/base/rapply.html">rapply()</a></code> may produce different results when using <code>how = "replace"</code> or <code>how = "list"</code> when working with list attributes. The former preserves intermediate list attributes whereas the latter does not. To avoid unexpected behavior, <code><a href="../../reference/rrapply.html">rrapply()</a></code> always preserves intermediate list attributes when using <code>how = "replace"</code>, <code>how = "list"</code> or <code>how = "prune"</code>. If <code>how = "flatten"</code>, <code>how = "melt"</code>, <code>how = "bind"</code> or <code>how = "unlist"</code> intermediate list attributes cannot be preserved as the result is no longer a nested list.</p>
<div class="sourceCode" id="cb28"><html><body><pre class="r"><span class="co">## how = "list" now preserves all list attributes</span>
<span class="no">na_drop_oceania_list_attr2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../../reference/rrapply.html">rrapply</a></span>(
  <span class="no">renewable_oceania</span>,
  <span class="kw">f</span> <span class="kw">=</span> <span class="kw">function</span>(<span class="no">x</span>) <span class="fu"><a href="https://rdrr.io/r/base/replace.html">replace</a></span>(<span class="no">x</span>, <span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="no">x</span>), <span class="fl">0</span>),
  <span class="kw">how</span> <span class="kw">=</span> <span class="st">"list"</span>
)

<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="no">na_drop_oceania_list_attr2</span>, <span class="kw">max.level</span> <span class="kw">=</span> <span class="fl">2</span>)
<span class="co">#&gt; List of 1</span>
<span class="co">#&gt;  $ Oceania:List of 4</span>
<span class="co">#&gt;   ..$ Australia and New Zealand:List of 6</span>
<span class="co">#&gt;   .. ..- attr(*, "M49-code")= chr "053"</span>
<span class="co">#&gt;   ..$ Melanesia                :List of 5</span>
<span class="co">#&gt;   .. ..- attr(*, "M49-code")= chr "054"</span>
<span class="co">#&gt;   ..$ Micronesia               :List of 8</span>
<span class="co">#&gt;   .. ..- attr(*, "M49-code")= chr "057"</span>
<span class="co">#&gt;   ..$ Polynesia                :List of 10</span>
<span class="co">#&gt;   .. ..- attr(*, "M49-code")= chr "061"</span>
<span class="co">#&gt;   ..- attr(*, "M49-code")= chr "009"</span>

<span class="co">## how = "prune" also preserves list attributes</span>
<span class="no">na_drop_oceania_attr</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../../reference/rrapply.html">rrapply</a></span>(
  <span class="no">renewable_oceania</span>,
  <span class="kw">condition</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/funprog.html">Negate</a></span>(<span class="no">is.na</span>),
  <span class="kw">how</span> <span class="kw">=</span> <span class="st">"prune"</span>
)
<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="no">na_drop_oceania_attr</span>, <span class="kw">max.level</span> <span class="kw">=</span> <span class="fl">2</span>)
<span class="co">#&gt; List of 1</span>
<span class="co">#&gt;  $ Oceania:List of 4</span>
<span class="co">#&gt;   ..$ Australia and New Zealand:List of 2</span>
<span class="co">#&gt;   .. ..- attr(*, "M49-code")= chr "053"</span>
<span class="co">#&gt;   ..$ Melanesia                :List of 5</span>
<span class="co">#&gt;   .. ..- attr(*, "M49-code")= chr "054"</span>
<span class="co">#&gt;   ..$ Micronesia               :List of 7</span>
<span class="co">#&gt;   .. ..- attr(*, "M49-code")= chr "057"</span>
<span class="co">#&gt;   ..$ Polynesia                :List of 8</span>
<span class="co">#&gt;   .. ..- attr(*, "M49-code")= chr "061"</span>
<span class="co">#&gt;   ..- attr(*, "M49-code")= chr "009"</span></pre></body></html></div>
</div>
</div>
<div id="using-rrapply-on-data-frames" class="section level3">
<h3 class="hasAnchor">
<a href="#using-rrapply-on-data-frames" class="anchor"></a>Using <code>rrapply()</code> on data.frames</h3>
<p>The previous sections explained how to avoid recursing into list-like elements using <code><a href="../../reference/rrapply.html">rrapply()</a></code>. However, it can also be useful to exploit the property that a data.frame is a list-like object and use base <code><a href="https://rdrr.io/r/base/rapply.html">rapply()</a></code> to apply a function <code>f</code> to data.frame columns of certain classes. For instance, it is straightforward to standardize all <code>numeric</code> columns in the <code>iris</code> dataset by their sample mean and standard deviation:</p>
<div class="sourceCode" id="cb29"><html><body><pre class="r"><span class="no">iris_standard</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rapply.html">rapply</a></span>(<span class="no">iris</span>, <span class="kw">f</span> <span class="kw">=</span> <span class="no">scale</span>, <span class="kw">classes</span> <span class="kw">=</span> <span class="st">"numeric"</span>, <span class="kw">how</span> <span class="kw">=</span> <span class="st">"replace"</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">iris_standard</span>)
<span class="co">#&gt;   Sepal.Length Sepal.Width Petal.Length Petal.Width Species</span>
<span class="co">#&gt; 1   -0.8976739  1.01560199    -1.335752   -1.311052  setosa</span>
<span class="co">#&gt; 2   -1.1392005 -0.13153881    -1.335752   -1.311052  setosa</span>
<span class="co">#&gt; 3   -1.3807271  0.32731751    -1.392399   -1.311052  setosa</span>
<span class="co">#&gt; 4   -1.5014904  0.09788935    -1.279104   -1.311052  setosa</span>
<span class="co">#&gt; 5   -1.0184372  1.24503015    -1.335752   -1.311052  setosa</span>
<span class="co">#&gt; 6   -0.5353840  1.93331463    -1.165809   -1.048667  setosa</span></pre></body></html></div>
<p>Using the <code>condition</code> argument in <code><a href="../../reference/rrapply.html">rrapply()</a></code>, we gain additional flexibility in selecting the columns to which <code>f</code> is applied. For instance, we can apply the <code>f</code> function only to the <code>Sepal</code> columns using the <code>.xname</code> argument:</p>
<div class="sourceCode" id="cb30"><html><body><pre class="r"><span class="no">iris_standard_sepal</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../../reference/rrapply.html">rrapply</a></span>(
  <span class="no">iris</span>,
  <span class="kw">condition</span> <span class="kw">=</span> <span class="kw">function</span>(<span class="no">x</span>, <span class="no">.xname</span>) <span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span>(<span class="st">"Sepal"</span>, <span class="no">.xname</span>),
  <span class="kw">f</span> <span class="kw">=</span> <span class="no">scale</span>
)
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">iris_standard_sepal</span>)
<span class="co">#&gt;   Sepal.Length Sepal.Width Petal.Length Petal.Width Species</span>
<span class="co">#&gt; 1   -0.8976739  1.01560199          1.4         0.2  setosa</span>
<span class="co">#&gt; 2   -1.1392005 -0.13153881          1.4         0.2  setosa</span>
<span class="co">#&gt; 3   -1.3807271  0.32731751          1.3         0.2  setosa</span>
<span class="co">#&gt; 4   -1.5014904  0.09788935          1.5         0.2  setosa</span>
<span class="co">#&gt; 5   -1.0184372  1.24503015          1.4         0.2  setosa</span>
<span class="co">#&gt; 6   -0.5353840  1.93331463          1.7         0.4  setosa</span></pre></body></html></div>
<p>Instead of <em>mutating</em> columns, we can also <em>transmute</em> columns (i.e. keeping only the columns to which <code>f</code> is applied) by setting <code>how = "prune"</code>:</p>
<div class="sourceCode" id="cb31"><html><body><pre class="r"><span class="no">iris_standard_transmute</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../../reference/rrapply.html">rrapply</a></span>(
  <span class="no">iris</span>,
  <span class="kw">f</span> <span class="kw">=</span> <span class="no">scale</span>,
  <span class="kw">classes</span> <span class="kw">=</span> <span class="st">"numeric"</span>,
  <span class="kw">how</span> <span class="kw">=</span> <span class="st">"prune"</span>
)
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">iris_standard_transmute</span>)
<span class="co">#&gt;   Sepal.Length Sepal.Width Petal.Length Petal.Width</span>
<span class="co">#&gt; 1   -0.8976739  1.01560199    -1.335752   -1.311052</span>
<span class="co">#&gt; 2   -1.1392005 -0.13153881    -1.335752   -1.311052</span>
<span class="co">#&gt; 3   -1.3807271  0.32731751    -1.392399   -1.311052</span>
<span class="co">#&gt; 4   -1.5014904  0.09788935    -1.279104   -1.311052</span>
<span class="co">#&gt; 5   -1.0184372  1.24503015    -1.335752   -1.311052</span>
<span class="co">#&gt; 6   -0.5353840  1.93331463    -1.165809   -1.048667</span></pre></body></html></div>
<p>In order to <em>summarize</em> a set of selected columns, use <code>how = "flatten"</code> instead of <code>how = "prune"</code>, as the latter preserves list attributes –including data.frame dimensions– which should not be kept.</p>
<div class="sourceCode" id="cb32"><html><body><pre class="r"><span class="co">## summarize columns with how = "flatten"</span>
<span class="no">iris_standard_summarize</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../../reference/rrapply.html">rrapply</a></span>(
  <span class="no">iris</span>,
  <span class="kw">f</span> <span class="kw">=</span> <span class="no">summary</span>,
  <span class="kw">classes</span> <span class="kw">=</span> <span class="st">"numeric"</span>,
  <span class="kw">how</span> <span class="kw">=</span> <span class="st">"flatten"</span>
)
<span class="no">iris_standard_summarize</span>
<span class="co">#&gt; $Sepal.Length</span>
<span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span>
<span class="co">#&gt;   4.300   5.100   5.800   5.843   6.400   7.900 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $Sepal.Width</span>
<span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span>
<span class="co">#&gt;   2.000   2.800   3.000   3.057   3.300   4.400 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $Petal.Length</span>
<span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span>
<span class="co">#&gt;   1.000   1.600   4.350   3.758   5.100   6.900 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $Petal.Width</span>
<span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span>
<span class="co">#&gt;   0.100   0.300   1.300   1.199   1.800   2.500</span></pre></body></html></div>
</div>
</div>
</div>
<div id="conclusion" class="section level1">
<h1 class="hasAnchor">
<a href="#conclusion" class="anchor"></a>Conclusion</h1>
<p>To conclude, let us return to the list recursion exercise in the first section. Using <code><a href="../../reference/rrapply.html">rrapply()</a></code>, we can solve the task in a more readable and less error-prone fashion. A possible approach is to split up the question in two steps as follows:</p>
<div class="sourceCode" id="cb33"><html><body><pre class="r"><span class="co">## look up the position of Euler (Leonhard)</span>
<span class="no">xpos_Euler</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../../reference/rrapply.html">rrapply</a></span>(
  <span class="no">students</span>,
  <span class="kw">classes</span> <span class="kw">=</span> <span class="st">"list"</span>,
  <span class="kw">condition</span> <span class="kw">=</span> <span class="kw">function</span>(<span class="no">x</span>, <span class="no">.xname</span>) <span class="no">.xname</span> <span class="kw">==</span> <span class="st">"Euler"</span> <span class="kw">&amp;&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html">attr</a></span>(<span class="no">x</span>, <span class="st">"given"</span>) <span class="kw">==</span> <span class="st">"Leonhard"</span>,
  <span class="kw">f</span> <span class="kw">=</span> <span class="kw">function</span>(<span class="no">x</span>, <span class="no">.xpos</span>) <span class="no">.xpos</span>,
  <span class="kw">how</span> <span class="kw">=</span> <span class="st">"flatten"</span>
)<span class="kw">[[</span><span class="fl">1</span>]]

<span class="no">xpos_Euler</span>
<span class="co">#&gt; [1] 1 1 2</span>

<span class="co">## filter descendants of Euler (Leonhard) and replace missing values by zero</span>
<span class="no">students_Euler</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../../reference/rrapply.html">rrapply</a></span>(
  <span class="no">students</span>,
  <span class="kw">condition</span> <span class="kw">=</span> <span class="kw">function</span>(<span class="no">x</span>, <span class="no">.xpos</span>) <span class="fu"><a href="https://rdrr.io/r/base/identical.html">identical</a></span>(<span class="no">.xpos</span>[<span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span>(<span class="no">xpos_Euler</span>)], <span class="no">xpos_Euler</span>),
  <span class="kw">f</span> <span class="kw">=</span> <span class="kw">function</span>(<span class="no">x</span>) <span class="fu"><a href="https://rdrr.io/r/base/replace.html">replace</a></span>(<span class="no">x</span>, <span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="no">x</span>), <span class="fl">0</span>),
  <span class="kw">how</span> <span class="kw">=</span> <span class="st">"prune"</span>
)

<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="no">students_Euler</span>, <span class="kw">give.attr</span> <span class="kw">=</span> <span class="fl">FALSE</span>)
<span class="co">#&gt; List of 1</span>
<span class="co">#&gt;  $ Bernoulli:List of 1</span>
<span class="co">#&gt;   ..$ Bernoulli:List of 1</span>
<span class="co">#&gt;   .. ..$ Euler:List of 2</span>
<span class="co">#&gt;   .. .. ..$ Euler   : num 0</span>
<span class="co">#&gt;   .. .. ..$ Lagrange:List of 3</span>
<span class="co">#&gt;   .. .. .. ..$ Fourier: num 68679</span>
<span class="co">#&gt;   .. .. .. ..$ Plana  : num 0</span>
<span class="co">#&gt;   .. .. .. ..$ Poisson: num 113435</span></pre></body></html></div>
<p>Knowing that Johann Euler is a descendant of Leonhard Euler, we can further simplify this into a single function call using the <code>.xparents</code> argument:</p>
<div class="sourceCode" id="cb34"><html><body><pre class="r"><span class="co">## filter descendants of Euler (Leonhard) and replace missing values by zero</span>
<span class="no">students_Euler</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../../reference/rrapply.html">rrapply</a></span>(
  <span class="no">students</span>,
  <span class="kw">condition</span> <span class="kw">=</span> <span class="kw">function</span>(<span class="no">x</span>, <span class="no">.xparents</span>) <span class="st">"Euler"</span> <span class="kw">%in%</span> <span class="no">.xparents</span>,
  <span class="kw">f</span> <span class="kw">=</span> <span class="kw">function</span>(<span class="no">x</span>) <span class="fu"><a href="https://rdrr.io/r/base/replace.html">replace</a></span>(<span class="no">x</span>, <span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="no">x</span>), <span class="fl">0</span>),
  <span class="kw">how</span> <span class="kw">=</span> <span class="st">"prune"</span>
)

<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="no">students_Euler</span>, <span class="kw">give.attr</span> <span class="kw">=</span> <span class="fl">FALSE</span>)
<span class="co">#&gt; List of 1</span>
<span class="co">#&gt;  $ Bernoulli:List of 1</span>
<span class="co">#&gt;   ..$ Bernoulli:List of 1</span>
<span class="co">#&gt;   .. ..$ Euler:List of 2</span>
<span class="co">#&gt;   .. .. ..$ Euler   : num 0</span>
<span class="co">#&gt;   .. .. ..$ Lagrange:List of 3</span>
<span class="co">#&gt;   .. .. .. ..$ Fourier: num 68679</span>
<span class="co">#&gt;   .. .. .. ..$ Plana  : num 0</span>
<span class="co">#&gt;   .. .. .. ..$ Poisson: num 113435</span></pre></body></html></div>
<p>For additional information and details check out the package vignette (<code><a href="https://rdrr.io/r/utils/browseVignettes.html">browseVignettes(package = "rapply")</a></code>) or the other articles in the <strong>Articles</strong> section.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Joris Chau.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>

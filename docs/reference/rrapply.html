<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Reimplementation of base-R's rapply — rrapply • rrapply</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet"><meta property="og:title" content="Reimplementation of base-R's rapply — rrapply"><meta name="description" content="rrapply is a reimplemented and extended version of rapply to recursively apply a function f to
a set of elements of a list and deciding how the result is structured."><meta property="og:description" content="rrapply is a reimplemented and extended version of rapply to recursively apply a function f to
a set of elements of a list and deciding how the result is structured."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">rrapply</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.2.8</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/1-when-to-use-rrapply.html">Efficient list recursion with rrapply</a></li>
    <li><a class="dropdown-item" href="../articles/2-efficient-melting-unnesting.html">Efficient list melting and unnesting with rrapply</a></li>
    <li><a class="dropdown-item" href="../articles/3-calls-and-expressions.html">Recursive apply for calls and expressions</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/JorisChau/rrapply/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Reimplementation of base-R's rapply</h1>
      <small class="dont-index">Source: <a href="https://github.com/JorisChau/rrapply/blob/HEAD/R/rrapply.R" class="external-link"><code>R/rrapply.R</code></a></small>
      <div class="d-none name"><code>rrapply.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><code>rrapply</code> is a reimplemented and extended version of <code><a href="https://rdrr.io/r/base/rapply.html" class="external-link">rapply</a></code> to recursively apply a function <code>f</code> to
a set of elements of a list and deciding <em>how</em> the result is structured.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">rrapply</span><span class="op">(</span></span>
<span>  <span class="va">object</span>,</span>
<span>  <span class="va">condition</span>,</span>
<span>  <span class="va">f</span>,</span>
<span>  classes <span class="op">=</span> <span class="st">"ANY"</span>,</span>
<span>  deflt <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  how <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"replace"</span>, <span class="st">"list"</span>, <span class="st">"unlist"</span>, <span class="st">"prune"</span>, <span class="st">"flatten"</span>, <span class="st">"melt"</span>, <span class="st">"bind"</span>, <span class="st">"recurse"</span>,</span>
<span>    <span class="st">"unmelt"</span>, <span class="st">"names"</span><span class="op">)</span>,</span>
<span>  <span class="va">options</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-object">object<a class="anchor" aria-label="anchor" href="#arg-object"></a></dt>
<dd><p>a <code><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></code>, <code><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></code> vector, or <code><a href="https://rdrr.io/r/base/call.html" class="external-link">call</a></code> object, i.e., “list-like”.</p></dd>


<dt id="arg-condition">condition<a class="anchor" aria-label="anchor" href="#arg-condition"></a></dt>
<dd><p>a condition <code><a href="https://rdrr.io/r/base/function.html" class="external-link">function</a></code> of one “principal” argument and optional special arguments <code>.xname</code>, <code>.xpos</code>,
<code>.xparents</code> and/or <code>.xsiblings</code> (see ‘Details’), passing further arguments via <code>...</code>.</p></dd>


<dt id="arg-f">f<a class="anchor" aria-label="anchor" href="#arg-f"></a></dt>
<dd><p>a <code><a href="https://rdrr.io/r/base/function.html" class="external-link">function</a></code> of one “principal” argument and optional special arguments <code>.xname</code>, <code>.xpos</code>, <code>.xparents</code>
and/or <code>.xsiblings</code> (see ‘Details’), passing further arguments via <code>...</code>.</p></dd>


<dt id="arg-classes">classes<a class="anchor" aria-label="anchor" href="#arg-classes"></a></dt>
<dd><p>character vector of <code><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></code> names, or <code>"ANY"</code> to match the class of any terminal node. Include <code>"list"</code> or <code>"data.frame"</code>
to match the class of non-terminal nodes as well.</p></dd>


<dt id="arg-deflt">deflt<a class="anchor" aria-label="anchor" href="#arg-deflt"></a></dt>
<dd><p>the default result (only used if <code>how = "list"</code> or <code>how = "unlist"</code>).</p></dd>


<dt id="arg-how">how<a class="anchor" aria-label="anchor" href="#arg-how"></a></dt>
<dd><p>character string partially matching the ten possibilities given: see ‘Details’.</p></dd>


<dt id="arg-options">options<a class="anchor" aria-label="anchor" href="#arg-options"></a></dt>
<dd><p>a named <code><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></code> with additional options <code>namesep</code>, <code>simplify</code>, <code>namecols</code> and/or <code>coldepth</code>
that only apply to certain choices of <code>how</code>: see ‘Details’.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>additional arguments passed to the call to <code>f</code> and <code>condition</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>If <code>how = "unlist"</code>, a vector as in <code><a href="https://rdrr.io/r/base/rapply.html" class="external-link">rapply</a></code>. If <code>how = "list"</code>, <code>how = "replace"</code>, <code>how = "recurse"</code> or <code>how = "names"</code>,
“list-like” of similar structure as <code>object</code> as in <code><a href="https://rdrr.io/r/base/rapply.html" class="external-link">rapply</a></code>. If <code>how = "prune"</code>, a pruned “list-like” object
of similar structure as <code>object</code> with pruned list elements based on <code>classes</code> and <code>condition</code>. If <code>how = "flatten"</code>, a flattened
pruned vector or list with pruned elements based on <code>classes</code> and <code>condition</code>. If <code>how = "melt"</code>, a melted data.frame containing the node paths
and values of the pruned list elements based on <code>classes</code> and <code>condition</code>. If <code>how = "bind"</code>, a wide data.frame with repeated list elements
expanded as single data.frame rows and aligned by identical list names using the same coercion rules as <code>how = "unlist"</code>. The repeated list elements
are subject to pruning based on <code>classes</code> and <code>condition</code>. If <code>how = "unmelt"</code>, a nested list with list names and values defined
in the data.frame <code>object</code>.</p>
    </div>
    <div class="section level2">
    <h2 id="note">Note<a class="anchor" aria-label="anchor" href="#note"></a></h2>
    <p><code>rrapply</code> allows the <code>f</code> function argument to be missing, in which case no function is applied to the list
elements.</p>
<p><code>how = "unmelt"</code> requires as input a data.frame as returned by <code>how = "melt"</code> with character columns to name the nested list components
and a final list- or vector-column containing the values of the nested list elements.</p>
    </div>
    <div class="section level2">
    <h2 id="how-to-structure-result">How to structure result<a class="anchor" aria-label="anchor" href="#how-to-structure-result"></a></h2>


<p>In addition to <code><a href="https://rdrr.io/r/base/rapply.html" class="external-link">rapply</a></code>'s modes to set <code>how</code> equal to <code>"replace"</code>, <code>"list"</code> or <code>"unlist"</code>,
seven choices <code>"prune"</code>, <code>"flatten"</code>, <code>"melt"</code>, <code>"bind"</code>, <code>"unmelt"</code>, <code>"recurse"</code>  and <code>"names"</code> are available:</p><ul><li><p><code>how = "prune"</code> filters all list elements not subject to application of <code>f</code> from the list <code>object</code>. The original
list structure is retained, similar to the non-pruned options <code>how = "replace"</code> or <code>how = "list"</code>.</p></li>
<li><p><code>how = "flatten"</code> is an efficient way to return a flattened unnested version of the pruned list. By default <code>how = "flatten"</code>
uses similar coercion rules as <code>how = "unlist"</code>, this can be disabled with <code>simplify = FALSE</code> in the <code>options</code> argument.</p></li>
<li><p><code>how = "melt"</code> returns a melted data.frame of the pruned list, each row contains the path of a single
terminal node in the pruned list at depth layers <code>L1</code>, <code>L2</code>, and so on. The column <code>"value"</code> contains the
possibly coerced values at the terminal nodes and is equivalent to the result of <code>how = "flatten"</code>. If no list names are present,
the node names in the data.frame default to the indices of the list elements <code>"1"</code>, <code>"2"</code>, etc.</p></li>
<li><p><code>how = "bind"</code> is used to unnest a nested list containing repeated sublists into a wide data.frame. Each repeated sublist is expanded
as a single row in the data.frame and identical sublist component names are aligned as individual columns. By default, the list layer
containing repeated sublists is identified based on the minimal depth detected across leaf nodes, this can be set manually with <code>coldepth</code>
in the <code>options</code> argument.</p></li>
<li><p><code>how = "unmelt"</code> is a special case that reconstructs a nested list from a melted data.frame. For this reason, <code>how = "unmelt"</code>
only applies to data.frames in the same format as returned by <code>how = "melt"</code>. Internally, <code>how = "unmelt"</code> first reconstructs
a nested list from the melted data.frame and second uses the same functional framework as <code>how = "replace"</code>.</p></li>
<li><p><code>how = "recurse"</code> is a specialized option that is only useful in combination with e.g. <code>classes = "list"</code> to recurse further
into updated “list-like” elements. This is explained in more detail below.</p></li>
<li><p><code>how = "names"</code> modifies the <em>names</em> of the nested list elements instead of the list content. <code>how = "names"</code> internally works
similar to <code>how = "list"</code>, except that the value of <code>f</code> is used to replace the name of the list element under evaluation
instead of its content.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="condition-function">Condition function<a class="anchor" aria-label="anchor" href="#condition-function"></a></h2>


<p>Both <code><a href="https://rdrr.io/r/base/rapply.html" class="external-link">rapply</a></code> and <code>rrapply</code> allow to apply <code>f</code> to list elements of certain classes via the <code>classes</code> argument.
<code>rrapply</code> generalizes this concept via an additional <code>condition</code> argument, which accepts any function to use as a condition
or predicate to select list elements to which <code>f</code> is applied. Conceptually, the <code>f</code> function is applied to all list elements for
which the <code>condition</code> function exactly evaluates to <code>TRUE</code> similar to <code><a href="https://rdrr.io/r/base/Logic.html" class="external-link">isTRUE</a></code>. If the condition function is missing,
<code>f</code> is applied to all list elements.
Since the <code>condition</code> function generalizes the <code>classes</code> argument, it is allowed to use the <code>deflt</code> argument
together with <code>how = "list"</code> or <code>how = "unlist"</code> to set a default value to all list elements for which the <code>condition</code> does
not evaluate to <code>TRUE</code>.</p>
    </div>
    <div class="section level2">
    <h2 id="correct-use-of-">Correct use of <code>...</code><a class="anchor" aria-label="anchor" href="#correct-use-of-"></a></h2>


<p>The principal argument of the <code>f</code> and <code>condition</code> functions evaluates to the content of the list element. Any further arguments to
<code>f</code> and <code>condition</code> (besides the special arguments <code>.xname</code>, <code>.xpos</code>, etc. discussed below) supplied via the dots <code>...</code>
argument need to be defined as function arguments in <em>both</em> the <code>f</code> and <code>condition</code> function (if existing), even if they are not
 used in the function itself. See also the ‘Examples’ section.</p>
    </div>
    <div class="section level2">
    <h2 id="special-arguments-xname-xpos-xparents-and-xsiblings">Special arguments <code>.xname</code>, <code>.xpos</code>, <code>.xparents</code> and <code>.xsiblings</code><a class="anchor" aria-label="anchor" href="#special-arguments-xname-xpos-xparents-and-xsiblings"></a></h2>


<p>The <code>f</code> and <code>condition</code> functions accept four special arguments <code>.xname</code>, <code>.xpos</code>, <code>.xparents</code> and <code>.xsiblings</code> in
addition to the first principal argument. The <code>.xname</code> argument evaluates to the name of the list element. The <code>.xpos</code> argument evaluates
to the position of the element in the nested list structured as an integer vector. That is, if <code>x = list(list("y", "z"))</code>, then an <code>.xpos</code>
location of <code>c(1, 2)</code> corresponds to the list element <code>x[[c(1, 2)]]</code>. The <code>.xparents</code> argument evaluates to a vector of all parent
node names in the path to the list element. The <code>.xsiblings</code> argument evaluates to the complete (sub)list that includes the list element as a direct child.
The names <code>.xname</code>, <code>.xpos</code>, <code>.xparents</code> or <code>.xsiblings</code> need to be explicitly included as function arguments in <code>f</code> and
<code>condition</code> (in addition to the principal argument). See also the ‘Examples’ section.</p>
    </div>
    <div class="section level2">
    <h2 id="avoid-recursing-into-list-nodes">Avoid recursing into list nodes<a class="anchor" aria-label="anchor" href="#avoid-recursing-into-list-nodes"></a></h2>


<p>By default, <code>rrapply</code> recurses into any “list-like” element. If <code>classes = "list"</code>, this behavior is overridden and the
<code>f</code> function is also applied to any list element of <code>object</code> that satisfies <code>condition</code>. For expression objects, use
<code>classes = "language"</code>, <code>classes = "expression"</code> or <code>classes = "pairlist"</code> to avoid recursing into branches of the abstract
syntax tree of <code>object</code>. If the <code>condition</code> or <code>classes</code> arguments are not satisfied for a “list-like” element,
<code>rrapply</code> will recurse further into the sublist, apply the <code>f</code> function to the nodes that satisfy <code>condition</code> and <code>classes</code>,
and so on. Note that this behavior can only be triggered using the <code>classes</code> argument and not the <code>condition</code> argument.</p>
    </div>
    <div class="section level2">
    <h2 id="recursive-list-node-updating">Recursive list node updating<a class="anchor" aria-label="anchor" href="#recursive-list-node-updating"></a></h2>


<p>If <code>classes = "list"</code> and <code>how = "recurse"</code>, <code>rrapply</code> applies the <code>f</code> function to any list element of <code>object</code> that satisfies
<code>condition</code> similar to the previous section using <code>how = "replace"</code>, but recurses further into the <em>updated</em> list-like element
after application of the <code>f</code> function. A primary use of <code>how = "recurse"</code> in combination with <code>classes = "list"</code> is to
recursively update for instance the class or other attributes of all nodes in a nested list.</p>
    </div>
    <div class="section level2">
    <h2 id="avoid-recursing-into-data-frames">Avoid recursing into data.frames<a class="anchor" aria-label="anchor" href="#avoid-recursing-into-data-frames"></a></h2>


<p>If <code>classes = "ANY"</code> (default), <code>rrapply</code> recurses into all “list-like” objects equivalent to <code><a href="https://rdrr.io/r/base/rapply.html" class="external-link">rapply</a></code>.
Since data.frames are “list-like” objects, the <code>f</code> function will descend into the individual columns of a data.frame.
To avoid this behavior, set <code>classes = "data.frame"</code>, in which case the <code>f</code> and <code>condition</code> functions are applied directly to
the data.frame and not its columns. Note that this behavior can only be triggered using the <code>classes</code> argument and not the <code>condition</code> argument.</p>
    </div>
    <div class="section level2">
    <h2 id="list-attributes">List attributes<a class="anchor" aria-label="anchor" href="#list-attributes"></a></h2>


<p>In <code><a href="https://rdrr.io/r/base/rapply.html" class="external-link">rapply</a></code> intermediate list attributes (not located at terminal nodes) are kept when <code>how = "replace"</code>, but are dropped when
<code>how = "list"</code>. To avoid unexpected behavior, <code>rrapply</code> always preserves intermediate list attributes when using <code>how = "replace"</code>,
<code>how = "list"</code>, <code>how = "prune"</code> or <code>how = "names"</code>. If <code>how = "unlist"</code>, <code>how = "flatten"</code>, <code>how = "melt"</code> or <code>how = "bind"</code>
intermediate list attributes cannot be preserved as the result is no longer a nested list.</p>
    </div>
    <div class="section level2">
    <h2 id="expressions">Expressions<a class="anchor" aria-label="anchor" href="#expressions"></a></h2>


<p>Call objects and expression vectors are also accepted as <code>object</code> argument, which are treated as nested lists based on their internal abstract
syntax trees. As such, all functionality that applies to nested lists extends directly to call objects and expression vectors. If <code>object</code> is a
call object or expression vector, <code>how = "replace"</code> always maintains the type of <code>object</code>, whereas <code>how = "list"</code> returns the result
structured as a nested list. <code>how = "prune"</code>, <code>how = "flatten"</code> and <code>how = "melt"</code> return the pruned abstract syntax tree as: a nested list,
a flattened list and a melted data.frame respectively. This is identical to application of <code>rrapply</code> to the abstract syntax tree formatted as a nested list.</p>
    </div>
    <div class="section level2">
    <h2 id="additional-options">Additional options<a class="anchor" aria-label="anchor" href="#additional-options"></a></h2>


<p>The <code>options</code> argument accepts a named list to configure several default options that only apply to certain choices of <code>how</code>. The <code>options</code>
list can contain (any of) the named components <code>namesep</code>, <code>simplify</code>, <code>namecols</code> and/or <code>coldepth</code>:</p><ul><li><p><code>namesep</code>, a character separator used to combine parent and child list names in <code>how = "flatten"</code> and <code>how = "bind"</code>. If <code>namesep = NA</code> (default),
no parent names are included in <code>how = "flatten"</code> and the default separator <code>"."</code> is used in <code>how = "bind"</code>. Note that <code>namesep</code> cannot be used with
<code>how = "unlist"</code> for which the name separator always defaults to <code>"."</code>.</p></li>
<li><p><code>simplify</code>, a logical value indicating whether the flattened unnested list in <code>how = "flatten"</code> and <code>how = "melt"</code> is simplified
according to standard coercion rules similar to <code>how = "unlist"</code>. The default is <code>simplify = TRUE</code>. If <code>simplify = FALSE</code>,
<code>object</code> is flattened to a single-layer list and returned as is.</p></li>
<li><p><code>namecols</code>, a logical value that only applies to <code>how = "bind"</code> indicating whether the parent node names associated to the each expanded sublist
should be included as columns <code>L1</code>, <code>L2</code>, etc. in the wide data.frame returned by <code>how = "bind"</code>.</p></li>
<li><p><code>coldepth</code>, an integer value indicating the depth (starting from depth 1) at which list elements should be mapped to individual columns
in the wide data.frame returned by <code>how = "bind"</code>. If <code>coldepth = 0</code> (default), this depth layer is identified automatically based on the
minimal depth detected across all leaf nodes. This option only applies to <code>how = "bind"</code>.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="https://rdrr.io/r/base/rapply.html" class="external-link">rapply</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Example data</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Renewable energy shares per country (% of total consumption) in 2016</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"renewable_energy_by_country"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Renewable energy shares in Oceania</span></span></span>
<span class="r-in"><span><span class="va">renewable_oceania</span> <span class="op">&lt;-</span> <span class="va">renewable_energy_by_country</span><span class="op">[[</span><span class="st">"World"</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="st">"Oceania"</span><span class="op">]</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Pokemon properties in Pokemon GO</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"pokedex"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># List pruning and unnesting</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Drop logical NA's while preserving list structure </span></span></span>
<span class="r-in"><span><span class="va">na_drop_oceania</span> <span class="op">&lt;-</span> <span class="fu">rrapply</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">renewable_oceania</span>,</span></span>
<span class="r-in"><span>  f <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span>,</span></span>
<span class="r-in"><span>  classes <span class="op">=</span> <span class="st">"numeric"</span>,</span></span>
<span class="r-in"><span>  how <span class="op">=</span> <span class="st">"prune"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">na_drop_oceania</span>, list.len <span class="op">=</span> <span class="fl">3</span>, give.attr <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> List of 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ Oceania:List of 4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..$ Australia and New Zealand:List of 2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. ..$ Australia  : num 9.32</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. ..$ New Zealand: num 32.8</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..$ Melanesia                :List of 5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. ..$ Fiji            : num 24.4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. ..$ New Caledonia   : num 4.03</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. ..$ Papua New Guinea: num 50.3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. .. [list output truncated]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..$ Micronesia               :List of 7</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. ..$ Guam                            : num 3.03</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. ..$ Kiribati                        : num 45.4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. ..$ Marshall Islands                : num 11.8</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. .. [list output truncated]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. [list output truncated]</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Drop logical NA's and return unnested list</span></span></span>
<span class="r-in"><span><span class="va">na_drop_oceania2</span> <span class="op">&lt;-</span> <span class="fu">rrapply</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">renewable_oceania</span>,</span></span>
<span class="r-in"><span>  classes <span class="op">=</span> <span class="st">"numeric"</span>,</span></span>
<span class="r-in"><span>  how <span class="op">=</span> <span class="st">"flatten"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">na_drop_oceania2</span>, n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        Australia      New Zealand             Fiji    New Caledonia </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             9.32            32.76            24.36             4.03 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Papua New Guinea  Solomon Islands          Vanuatu             Guam </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            50.34            65.73            33.67             3.03 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         Kiribati Marshall Islands </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            45.43            11.75 </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Flatten to simple list with full names</span></span></span>
<span class="r-in"><span><span class="va">na_drop_oceania3</span> <span class="op">&lt;-</span> <span class="fu">rrapply</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">renewable_oceania</span>,</span></span>
<span class="r-in"><span>  classes <span class="op">=</span> <span class="st">"numeric"</span>,</span></span>
<span class="r-in"><span>  how <span class="op">=</span> <span class="st">"flatten"</span>,</span></span>
<span class="r-in"><span>  options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>namesep <span class="op">=</span> <span class="st">"."</span>, simplify <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span> </span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">na_drop_oceania3</span>, list.len <span class="op">=</span> <span class="fl">10</span>, give.attr <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> List of 22</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ Oceania.Australia and New Zealand.Australia        : num 9.32</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ Oceania.Australia and New Zealand.New Zealand      : num 32.8</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ Oceania.Melanesia.Fiji                             : num 24.4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ Oceania.Melanesia.New Caledonia                    : num 4.03</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ Oceania.Melanesia.Papua New Guinea                 : num 50.3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ Oceania.Melanesia.Solomon Islands                  : num 65.7</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ Oceania.Melanesia.Vanuatu                          : num 33.7</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ Oceania.Micronesia.Guam                            : num 3.03</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ Oceania.Micronesia.Kiribati                        : num 45.4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ Oceania.Micronesia.Marshall Islands                : num 11.8</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   [list output truncated]</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Drop logical NA's and return melted data.frame</span></span></span>
<span class="r-in"><span><span class="va">na_drop_oceania4</span> <span class="op">&lt;-</span> <span class="fu">rrapply</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">renewable_oceania</span>,</span></span>
<span class="r-in"><span>  classes <span class="op">=</span> <span class="st">"numeric"</span>,</span></span>
<span class="r-in"><span>  how <span class="op">=</span> <span class="st">"melt"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">na_drop_oceania4</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        L1                        L2               L3 value</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 Oceania Australia and New Zealand        Australia  9.32</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 Oceania Australia and New Zealand      New Zealand 32.76</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 Oceania                 Melanesia             Fiji 24.36</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 Oceania                 Melanesia    New Caledonia  4.03</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 Oceania                 Melanesia Papua New Guinea 50.34</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6 Oceania                 Melanesia  Solomon Islands 65.73</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Reconstruct nested list from melted data.frame</span></span></span>
<span class="r-in"><span><span class="va">na_drop_oceania5</span> <span class="op">&lt;-</span> <span class="fu">rrapply</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">na_drop_oceania4</span>,</span></span>
<span class="r-in"><span>  how <span class="op">=</span> <span class="st">"unmelt"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">na_drop_oceania5</span>, list.len <span class="op">=</span> <span class="fl">3</span>, give.attr <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> List of 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ Oceania:List of 4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..$ Australia and New Zealand:List of 2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. ..$ Australia  : num 9.32</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. ..$ New Zealand: num 32.8</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..$ Melanesia                :List of 5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. ..$ Fiji            : num 24.4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. ..$ New Caledonia   : num 4.03</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. ..$ Papua New Guinea: num 50.3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. .. [list output truncated]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..$ Micronesia               :List of 7</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. ..$ Guam                            : num 3.03</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. ..$ Kiribati                        : num 45.4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. ..$ Marshall Islands                : num 11.8</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. .. [list output truncated]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. [list output truncated]</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Unnest list to wide data.frame</span></span></span>
<span class="r-in"><span><span class="va">pokedex_wide</span> <span class="op">&lt;-</span> <span class="fu">rrapply</span><span class="op">(</span><span class="va">pokedex</span>, how <span class="op">=</span> <span class="st">"bind"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">pokedex_wide</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   id num       name                                              img</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1  1 001  Bulbasaur http://www.serebii.net/pokemongo/pokemon/001.png</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2  2 002    Ivysaur http://www.serebii.net/pokemongo/pokemon/002.png</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3  3 003   Venusaur http://www.serebii.net/pokemongo/pokemon/003.png</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4  4 004 Charmander http://www.serebii.net/pokemongo/pokemon/004.png</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5  5 005 Charmeleon http://www.serebii.net/pokemongo/pokemon/005.png</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6  6 006  Charizard http://www.serebii.net/pokemongo/pokemon/006.png</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            type height   weight            candy candy_count         egg</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 Grass, Poison 0.71 m   6.9 kg  Bulbasaur Candy          25        2 km</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 Grass, Poison 0.99 m  13.0 kg  Bulbasaur Candy         100 Not in Eggs</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 Grass, Poison 2.01 m 100.0 kg  Bulbasaur Candy          NA Not in Eggs</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4          Fire 0.61 m   8.5 kg Charmander Candy          25        2 km</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5          Fire 1.09 m  19.0 kg Charmander Candy         100 Not in Eggs</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6  Fire, Flying 1.70 m  90.5 kg Charmander Candy          NA Not in Eggs</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   spawn_chance avg_spawns spawn_time multipliers                 weaknesses</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1       0.6900      69.00      20:00        1.58 Fire, Ice, Flying, Psychic</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2       0.0420       4.20      07:00    1.2, 1.6 Fire, Ice, Flying, Psychic</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3       0.0170       1.70      11:30          NA Fire, Ice, Flying, Psychic</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4       0.2530      25.30      08:45        1.65        Water, Ground, Rock</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5       0.0120       1.20      19:00        1.79        Water, Ground, Rock</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6       0.0031       0.31      13:34          NA      Water, Electric, Rock</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   next_evolution.1.num next_evolution.1.name next_evolution.2.num</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1                  002               Ivysaur                  003</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2                  003              Venusaur                 &lt;NA&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3                 &lt;NA&gt;                  &lt;NA&gt;                 &lt;NA&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4                  005            Charmeleon                  006</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5                  006             Charizard                 &lt;NA&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6                 &lt;NA&gt;                  &lt;NA&gt;                 &lt;NA&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   next_evolution.2.name prev_evolution.1.num prev_evolution.1.name</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1              Venusaur                 &lt;NA&gt;                  &lt;NA&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2                  &lt;NA&gt;                  001             Bulbasaur</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3                  &lt;NA&gt;                  001             Bulbasaur</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4             Charizard                 &lt;NA&gt;                  &lt;NA&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5                  &lt;NA&gt;                  004            Charmander</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6                  &lt;NA&gt;                  004            Charmander</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   prev_evolution.2.num prev_evolution.2.name next_evolution.3.num</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1                 &lt;NA&gt;                  &lt;NA&gt;                 &lt;NA&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2                 &lt;NA&gt;                  &lt;NA&gt;                 &lt;NA&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3                  002               Ivysaur                 &lt;NA&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4                 &lt;NA&gt;                  &lt;NA&gt;                 &lt;NA&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5                 &lt;NA&gt;                  &lt;NA&gt;                 &lt;NA&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6                  005            Charmeleon                 &lt;NA&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   next_evolution.3.name</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1                  &lt;NA&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2                  &lt;NA&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3                  &lt;NA&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4                  &lt;NA&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5                  &lt;NA&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6                  &lt;NA&gt;</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Unnest to data.frame including parent columns</span></span></span>
<span class="r-in"><span><span class="va">pokemon_evolutions</span> <span class="op">&lt;-</span> <span class="fu">rrapply</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">pokedex</span>, </span></span>
<span class="r-in"><span>  how <span class="op">=</span> <span class="st">"bind"</span>, </span></span>
<span class="r-in"><span>  options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>namecols <span class="op">=</span> <span class="cn">TRUE</span>, coldepth <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span> </span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">pokemon_evolutions</span>, n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         L1 L2             L3 L4 num       name</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1  pokemon  1 next_evolution  1 002    Ivysaur</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2  pokemon  1 next_evolution  2 003   Venusaur</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3  pokemon  2 prev_evolution  1 001  Bulbasaur</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4  pokemon  2 next_evolution  1 003   Venusaur</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5  pokemon  3 prev_evolution  1 001  Bulbasaur</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6  pokemon  3 prev_evolution  2 002    Ivysaur</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7  pokemon  4 next_evolution  1 005 Charmeleon</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8  pokemon  4 next_evolution  2 006  Charizard</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9  pokemon  5 prev_evolution  1 004 Charmander</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10 pokemon  5 next_evolution  1 006  Charizard</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Condition function</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Drop all NA elements using condition function</span></span></span>
<span class="r-in"><span><span class="va">na_drop_oceania6</span> <span class="op">&lt;-</span> <span class="fu">rrapply</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">renewable_oceania</span>,</span></span>
<span class="r-in"><span>  condition <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/funprog.html" class="external-link">Negate</a></span><span class="op">(</span><span class="va">is.na</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  how <span class="op">=</span> <span class="st">"prune"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">na_drop_oceania6</span>, list.len <span class="op">=</span> <span class="fl">3</span>, give.attr <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> List of 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ Oceania:List of 4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..$ Australia and New Zealand:List of 2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. ..$ Australia  : num 9.32</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. ..$ New Zealand: num 32.8</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..$ Melanesia                :List of 5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. ..$ Fiji            : num 24.4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. ..$ New Caledonia   : num 4.03</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. ..$ Papua New Guinea: num 50.3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. .. [list output truncated]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..$ Micronesia               :List of 7</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. ..$ Guam                            : num 3.03</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. ..$ Kiribati                        : num 45.4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. ..$ Marshall Islands                : num 11.8</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. .. [list output truncated]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. [list output truncated]</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Replace NA elements by a new value via the ... argument</span></span></span>
<span class="r-in"><span><span class="co">## NB: the 'newvalue' argument should be present as function </span></span></span>
<span class="r-in"><span><span class="co">## argument in both 'f' and 'condition', even if unused.</span></span></span>
<span class="r-in"><span><span class="va">na_zero_oceania</span> <span class="op">&lt;-</span> <span class="fu">rrapply</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">renewable_oceania</span>,</span></span>
<span class="r-in"><span>  condition <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">newvalue</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  f <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">newvalue</span><span class="op">)</span> <span class="va">newvalue</span>,</span></span>
<span class="r-in"><span>  newvalue <span class="op">=</span> <span class="fl">0</span>,</span></span>
<span class="r-in"><span>  how <span class="op">=</span> <span class="st">"replace"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">na_zero_oceania</span>, list.len <span class="op">=</span> <span class="fl">3</span>, give.attr <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> List of 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ Oceania:List of 4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..$ Australia and New Zealand:List of 6</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. ..$ Australia                        : num 9.32</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. ..$ Christmas Island                 : num 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. ..$ Cocos (Keeling) Islands          : num 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. .. [list output truncated]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..$ Melanesia                :List of 5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. ..$ Fiji            : num 24.4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. ..$ New Caledonia   : num 4.03</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. ..$ Papua New Guinea: num 50.3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. .. [list output truncated]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..$ Micronesia               :List of 8</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. ..$ Guam                                : num 3.03</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. ..$ Kiribati                            : num 45.4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. ..$ Marshall Islands                    : num 11.8</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. .. [list output truncated]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. [list output truncated]</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Filter all countries with values above 85%</span></span></span>
<span class="r-in"><span><span class="va">renewable_energy_above_85</span> <span class="op">&lt;-</span> <span class="fu">rrapply</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">renewable_energy_by_country</span>,</span></span>
<span class="r-in"><span>  condition <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span> <span class="op">&gt;</span> <span class="fl">85</span>,</span></span>
<span class="r-in"><span>  how <span class="op">=</span> <span class="st">"prune"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">renewable_energy_above_85</span>, give.attr <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> List of 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ World:List of 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..$ Africa:List of 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. ..$ Sub-Saharan Africa:List of 3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. .. ..$ Eastern Africa:List of 7</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. .. .. ..$ Burundi                    : num 89.2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. .. .. ..$ Ethiopia                   : num 91.9</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. .. .. ..$ Rwanda                     : num 86</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. .. .. ..$ Somalia                    : num 94.7</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. .. .. ..$ Uganda                     : num 88.6</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. .. .. ..$ United Republic of Tanzania: num 86.1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. .. .. ..$ Zambia                     : num 88.5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. .. ..$ Middle Africa :List of 2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. .. .. ..$ Chad                            : num 85.3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. .. .. ..$ Democratic Republic of the Congo: num 97</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. .. ..$ Western Africa:List of 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. .. .. ..$ Guinea-Bissau: num 86.5</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Special arguments .xname, .xpos, .xparents and .xsiblings</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Apply a function using the name of the node</span></span></span>
<span class="r-in"><span><span class="va">renewable_oceania_text</span> <span class="op">&lt;-</span> <span class="fu">rrapply</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">renewable_oceania</span>,</span></span>
<span class="r-in"><span>  condition <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/funprog.html" class="external-link">Negate</a></span><span class="op">(</span><span class="va">is.na</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  f <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">.xname</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Renewable energy in %s: %.2f%%"</span>, <span class="va">.xname</span>, <span class="va">x</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  how <span class="op">=</span> <span class="st">"flatten"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">renewable_oceania_text</span>, n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                                      Australia </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         "Renewable energy in Australia: 9.32%" </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                                    New Zealand </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      "Renewable energy in New Zealand: 32.76%" </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                                           Fiji </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             "Renewable energy in Fiji: 24.36%" </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                                  New Caledonia </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     "Renewable energy in New Caledonia: 4.03%" </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                               Papua New Guinea </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> "Renewable energy in Papua New Guinea: 50.34%" </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                                Solomon Islands </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  "Renewable energy in Solomon Islands: 65.73%" </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                                        Vanuatu </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          "Renewable energy in Vanuatu: 33.67%" </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                                           Guam </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>              "Renewable energy in Guam: 3.03%" </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                                       Kiribati </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         "Renewable energy in Kiribati: 45.43%" </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                               Marshall Islands </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> "Renewable energy in Marshall Islands: 11.75%" </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Extract values based on country names</span></span></span>
<span class="r-in"><span><span class="va">renewable_benelux</span> <span class="op">&lt;-</span> <span class="fu">rrapply</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">renewable_energy_by_country</span>,</span></span>
<span class="r-in"><span>  condition <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">.xname</span><span class="op">)</span> <span class="va">.xname</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Belgium"</span>, <span class="st">"Netherlands"</span>, <span class="st">"Luxembourg"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  how <span class="op">=</span> <span class="st">"prune"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">renewable_benelux</span>, give.attr <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> List of 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ World:List of 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..$ Europe:List of 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. ..$ Western Europe:List of 3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. .. ..$ Belgium    : num 9.14</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. .. ..$ Luxembourg : num 13.5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. .. ..$ Netherlands: num 5.78</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Filter European countries with value above 50%</span></span></span>
<span class="r-in"><span><span class="va">renewable_europe_above_50</span> <span class="op">&lt;-</span> <span class="fu">rrapply</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">renewable_energy_by_country</span>,</span></span>
<span class="r-in"><span>  condition <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">.xpos</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/identical.html" class="external-link">identical</a></span><span class="op">(</span><span class="va">.xpos</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1L</span>, <span class="fl">5L</span><span class="op">)</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">x</span> <span class="op">&gt;</span> <span class="fl">50</span>,</span></span>
<span class="r-in"><span>  how <span class="op">=</span> <span class="st">"prune"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">renewable_europe_above_50</span>, give.attr <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> List of 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ World:List of 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..$ Europe:List of 2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. ..$ Northern Europe:List of 3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. .. ..$ Iceland: num 78.1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. .. ..$ Norway : num 59.5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. .. ..$ Sweden : num 51.4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. ..$ Western Europe :List of 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. .. ..$ Liechtenstein: num 62.9</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Filter European countries with value above 50%</span></span></span>
<span class="r-in"><span><span class="va">renewable_europe_above_50</span> <span class="op">&lt;-</span> <span class="fu">rrapply</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">renewable_energy_by_country</span>,</span></span>
<span class="r-in"><span>  condition <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">.xparents</span><span class="op">)</span> <span class="st">"Europe"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">.xparents</span> <span class="op">&amp;</span> <span class="va">x</span> <span class="op">&gt;</span> <span class="fl">50</span>,</span></span>
<span class="r-in"><span>  how <span class="op">=</span> <span class="st">"prune"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">renewable_europe_above_50</span>, give.attr <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> List of 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ World:List of 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..$ Europe:List of 2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. ..$ Northern Europe:List of 3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. .. ..$ Iceland: num 78.1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. .. ..$ Norway : num 59.5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. .. ..$ Sweden : num 51.4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. ..$ Western Europe :List of 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. .. ..$ Liechtenstein: num 62.9</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Return position of Sweden in list</span></span></span>
<span class="r-in"><span><span class="op">(</span><span class="va">xpos_sweden</span> <span class="op">&lt;-</span> <span class="fu">rrapply</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">renewable_energy_by_country</span>,</span></span>
<span class="r-in"><span>  condition <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">.xname</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/identical.html" class="external-link">identical</a></span><span class="op">(</span><span class="va">.xname</span>, <span class="st">"Sweden"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  f <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">.xpos</span><span class="op">)</span> <span class="va">.xpos</span>,</span></span>
<span class="r-in"><span>  how <span class="op">=</span> <span class="st">"flatten"</span></span></span>
<span class="r-in"><span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $Sweden</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1]  1  5  2 14</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span><span class="va">renewable_energy_by_country</span><span class="op">[[</span><span class="va">xpos_sweden</span><span class="op">$</span><span class="va">Sweden</span><span class="op">]</span><span class="op">]</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 51.35</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"M49-code")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "752"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Return neighbors of Sweden in list</span></span></span>
<span class="r-in"><span><span class="va">siblings_sweden</span> <span class="op">&lt;-</span> <span class="fu">rrapply</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">renewable_energy_by_country</span>,</span></span>
<span class="r-in"><span>  condition <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">.xsiblings</span><span class="op">)</span> <span class="st">"Sweden"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">.xsiblings</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  how <span class="op">=</span> <span class="st">"flatten"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">siblings_sweden</span>, n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Aland Islands       Denmark       Estonia Faroe Islands       Finland </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            NA         33.06         26.55          4.24         42.03 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       Iceland       Ireland   Isle of Man        Latvia     Lithuania </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         78.07          8.65          4.30         38.48         31.42 </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Unnest selected columns in Pokedex list </span></span></span>
<span class="r-in"><span><span class="va">pokedex_small</span> <span class="op">&lt;-</span> <span class="fu">rrapply</span><span class="op">(</span></span></span>
<span class="r-in"><span>   <span class="va">pokedex</span>,</span></span>
<span class="r-in"><span>   condition <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">.xpos</span>, <span class="va">.xname</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">.xpos</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">4</span> <span class="op">&amp;</span> <span class="va">.xname</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"num"</span>, <span class="st">"name"</span>, <span class="st">"type"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>   how <span class="op">=</span> <span class="st">"bind"</span></span></span>
<span class="r-in"><span><span class="op">)</span>  </span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">pokedex_small</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   num       name          type</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 001  Bulbasaur Grass, Poison</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 002    Ivysaur Grass, Poison</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 003   Venusaur Grass, Poison</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 004 Charmander          Fire</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 005 Charmeleon          Fire</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6 006  Charizard  Fire, Flying</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Modifying list elements</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Calculate mean value of Europe</span></span></span>
<span class="r-in"><span><span class="fu">rrapply</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">renewable_energy_by_country</span>,  </span></span>
<span class="r-in"><span>  condition <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">.xname</span><span class="op">)</span> <span class="va">.xname</span> <span class="op">==</span> <span class="st">"Europe"</span>,</span></span>
<span class="r-in"><span>  f <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  classes <span class="op">=</span> <span class="st">"list"</span>,</span></span>
<span class="r-in"><span>  how <span class="op">=</span> <span class="st">"flatten"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Europe </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 22.36565 </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Calculate mean value for each continent</span></span></span>
<span class="r-in"><span><span class="co">## (Antarctica's value is missing)</span></span></span>
<span class="r-in"><span><span class="va">renewable_continent_summary</span> <span class="op">&lt;-</span> <span class="fu">rrapply</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">renewable_energy_by_country</span>,  </span></span>
<span class="r-in"><span>  condition <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">.xpos</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">.xpos</span><span class="op">)</span> <span class="op">==</span> <span class="fl">2</span>,</span></span>
<span class="r-in"><span>  f <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  classes <span class="op">=</span> <span class="st">"list"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">renewable_continent_summary</span>, give.attr <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> List of 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ World:List of 6</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..$ Africa    : num 54.3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..$ Americas  : num 18.2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..$ Antarctica: logi NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..$ Asia      : num 17.9</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..$ Europe    : num 22.4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..$ Oceania   : num 17.8</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Filter country or region by M49-code</span></span></span>
<span class="r-in"><span><span class="fu">rrapply</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">renewable_energy_by_country</span>,</span></span>
<span class="r-in"><span>  condition <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"M49-code"</span><span class="op">)</span> <span class="op">==</span> <span class="st">"155"</span>,</span></span>
<span class="r-in"><span>  f <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">.xname</span><span class="op">)</span> <span class="va">.xname</span>,</span></span>
<span class="r-in"><span>  classes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"list"</span>, <span class="st">"ANY"</span><span class="op">)</span>, </span></span>
<span class="r-in"><span>  how <span class="op">=</span> <span class="st">"unlist"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> World.Europe.Western Europe </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            "Western Europe" </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Recursive list updating</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Recursively remove list attributes</span></span></span>
<span class="r-in"><span><span class="va">renewable_no_attrs</span> <span class="op">&lt;-</span> <span class="fu">rrapply</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">renewable_oceania</span>,</span></span>
<span class="r-in"><span>  f <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  classes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"list"</span>, <span class="st">"ANY"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  how <span class="op">=</span> <span class="st">"recurse"</span></span></span>
<span class="r-in"><span><span class="op">)</span> </span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">renewable_no_attrs</span>, list.len <span class="op">=</span> <span class="fl">3</span>, give.attr <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> List of 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ Oceania:List of 4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..$ Australia and New Zealand:List of 6</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. ..$ Australia                        : num 9.32</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. ..$ Christmas Island                 : logi NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. ..$ Cocos (Keeling) Islands          : logi NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. .. [list output truncated]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..$ Melanesia                :List of 5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. ..$ Fiji            : num 24.4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. ..$ New Caledonia   : num 4.03</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. ..$ Papua New Guinea: num 50.3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. .. [list output truncated]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..$ Micronesia               :List of 8</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. ..$ Guam                                : num 3.03</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. ..$ Kiribati                            : num 45.4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. ..$ Marshall Islands                    : num 11.8</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. .. [list output truncated]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. [list output truncated]</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## recursively replace all names by M49-codes</span></span></span>
<span class="r-in"><span><span class="va">renewable_m49_names</span> <span class="op">&lt;-</span> <span class="fu">rrapply</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">renewable_oceania</span>,</span></span>
<span class="r-in"><span>  f <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"M49-code"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  how <span class="op">=</span> <span class="st">"names"</span></span></span>
<span class="r-in"><span><span class="op">)</span> </span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">renewable_m49_names</span>, list.len <span class="op">=</span> <span class="fl">3</span>, give.attr <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> List of 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ 009:List of 4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..$ 053:List of 6</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. ..$ 036: num 9.32</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. ..$ 162: logi NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. ..$ 166: logi NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. .. [list output truncated]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..$ 054:List of 5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. ..$ 242: num 24.4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. ..$ 540: num 4.03</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. ..$ 598: num 50.3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. .. [list output truncated]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..$ 057:List of 8</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. ..$ 316: num 3.03</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. ..$ 296: num 45.4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. ..$ 584: num 11.8</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. .. [list output truncated]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. [list output truncated]</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># List attributes</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## how = "list" preserves all list attributes</span></span></span>
<span class="r-in"><span><span class="va">na_drop_oceania_attr</span> <span class="op">&lt;-</span> <span class="fu">rrapply</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">renewable_oceania</span>,</span></span>
<span class="r-in"><span>  f <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/replace.html" class="external-link">replace</a></span><span class="op">(</span><span class="va">x</span>, <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, <span class="fl">0</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  how <span class="op">=</span> <span class="st">"list"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">na_drop_oceania_attr</span>, max.level <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> List of 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ Oceania:List of 4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..$ Australia and New Zealand:List of 6</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. ..- attr(*, "M49-code")= chr "053"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..$ Melanesia                :List of 5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. ..- attr(*, "M49-code")= chr "054"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..$ Micronesia               :List of 8</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. ..- attr(*, "M49-code")= chr "057"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..$ Polynesia                :List of 10</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. ..- attr(*, "M49-code")= chr "061"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..- attr(*, "M49-code")= chr "009"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## how = "prune" also preserves list attributes</span></span></span>
<span class="r-in"><span><span class="va">na_drop_oceania_attr2</span> <span class="op">&lt;-</span> <span class="fu">rrapply</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">renewable_oceania</span>,</span></span>
<span class="r-in"><span>  condition <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/funprog.html" class="external-link">Negate</a></span><span class="op">(</span><span class="va">is.na</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  how <span class="op">=</span> <span class="st">"prune"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">na_drop_oceania_attr2</span>, max.level <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> List of 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ Oceania:List of 4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..$ Australia and New Zealand:List of 2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. ..- attr(*, "M49-code")= chr "053"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..$ Melanesia                :List of 5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. ..- attr(*, "M49-code")= chr "054"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..$ Micronesia               :List of 7</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. ..- attr(*, "M49-code")= chr "057"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..$ Polynesia                :List of 8</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. ..- attr(*, "M49-code")= chr "061"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..- attr(*, "M49-code")= chr "009"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Expressions</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Replace logicals by integers</span></span></span>
<span class="r-in"><span><span class="va">call_old</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">quote</a></span><span class="op">(</span><span class="va">y</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">+</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">call_new</span> <span class="op">&lt;-</span> <span class="fu">rrapply</span><span class="op">(</span><span class="va">call_old</span>, </span></span>
<span class="r-in"><span>  f <span class="op">=</span> <span class="va">as.numeric</span>, </span></span>
<span class="r-in"><span>  how <span class="op">=</span> <span class="st">"replace"</span>,</span></span>
<span class="r-in"><span>  classes <span class="op">=</span> <span class="st">"logical"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">call_new</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  language y &lt;- x &lt;- 1 + 1</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Update and decompose call object</span></span></span>
<span class="r-in"><span><span class="va">call_ast</span> <span class="op">&lt;-</span> <span class="fu">rrapply</span><span class="op">(</span><span class="va">call_old</span>, </span></span>
<span class="r-in"><span>  f <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/logical.html" class="external-link">is.logical</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, <span class="va">x</span><span class="op">)</span>, </span></span>
<span class="r-in"><span>  how <span class="op">=</span> <span class="st">"list"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">call_ast</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> List of 3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ : symbol &lt;-</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ : symbol y</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ :List of 3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..$ : symbol &lt;-</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..$ : symbol x</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..$ :List of 3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. ..$ : symbol +</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. ..$ : num 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. ..$ : num 1</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Prune and decompose expression</span></span></span>
<span class="r-in"><span><span class="va">expr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">y</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">1</span>, <span class="fu">f</span><span class="op">(</span><span class="fu">g</span><span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">pi</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">is_new_name</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/exists.html" class="external-link">exists</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, envir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/environment.html" class="external-link">baseenv</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">expr_prune</span> <span class="op">&lt;-</span> <span class="fu">rrapply</span><span class="op">(</span><span class="va">expr</span>, </span></span>
<span class="r-in"><span>  classes <span class="op">=</span> <span class="st">"name"</span>, </span></span>
<span class="r-in"><span>  condition <span class="op">=</span> <span class="va">is_new_name</span>, </span></span>
<span class="r-in"><span>  how <span class="op">=</span> <span class="st">"prune"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">expr_prune</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> List of 2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ :List of 2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..$ : symbol y</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..$ :List of 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. ..$ : symbol x</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ :List of 2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..$ : symbol f</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..$ :List of 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. ..$ : symbol g</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Prune and flatten expression</span></span></span>
<span class="r-in"><span><span class="va">expr_flatten</span> <span class="op">&lt;-</span> <span class="fu">rrapply</span><span class="op">(</span><span class="va">expr</span>, </span></span>
<span class="r-in"><span>  classes <span class="op">=</span> <span class="st">"name"</span>, </span></span>
<span class="r-in"><span>  condition <span class="op">=</span> <span class="va">is_new_name</span>, </span></span>
<span class="r-in"><span>  how <span class="op">=</span> <span class="st">"flatten"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">expr_flatten</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> List of 4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ : symbol y</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ : symbol x</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ : symbol f</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ : symbol g</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Prune and melt expression</span></span></span>
<span class="r-in"><span><span class="fu">rrapply</span><span class="op">(</span><span class="va">expr</span>, </span></span>
<span class="r-in"><span>  classes <span class="op">=</span> <span class="st">"name"</span>, </span></span>
<span class="r-in"><span>  condition <span class="op">=</span> <span class="va">is_new_name</span>, </span></span>
<span class="r-in"><span>  f <span class="op">=</span> <span class="va">as.character</span>,</span></span>
<span class="r-in"><span>  how <span class="op">=</span> <span class="st">"melt"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   L1 L2   L3 value</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1  1  2 &lt;NA&gt;     y</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2  1  3    2     x</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3  2  1 &lt;NA&gt;     f</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4  2  2    1     g</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Avoid recursing into call objects</span></span></span>
<span class="r-in"><span><span class="fu">rrapply</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">expr</span>, </span></span>
<span class="r-in"><span>  classes <span class="op">=</span> <span class="st">"language"</span>, </span></span>
<span class="r-in"><span>  condition <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">is.call</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  how <span class="op">=</span> <span class="st">"flatten"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[1]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x &lt;- 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[2]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 * pi</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Joris Chau.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>


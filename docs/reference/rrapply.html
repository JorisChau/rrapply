<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Reimplementation of base-R's rapply — rrapply • rrapply</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>



  <link href="../extra.css" rel="stylesheet">
  

<meta property="og:title" content="Reimplementation of base-R's rapply — rrapply" />
<meta property="og:description" content="rrapply is a reimplemented and extended version of rapply to recursively apply a function f to 
a set of elements of a list and deciding how the result is structured." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">rrapply</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/articles/1-when-to-use-rrapply.html">Efficient list recursion with rrapply</a>
    </li>
    <li>
      <a href="../articles/articles/2-efficient-melting-unmelting.html">Efficient list melting and unmelting with rrapply</a>
    </li>
    <li>
      <a href="../articles/articles/3-calls-and-expressions.html">Recursive apply for call and expression objects</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/JorisChau/rrapply/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Reimplementation of base-R's rapply</h1>
    <small class="dont-index">Source: <a href='https://github.com/JorisChau/rrapply/blob/master/R/rrapply.R'><code>R/rrapply.R</code></a></small>
    <div class="hidden name"><code>rrapply.Rd</code></div>
    </div>

    <div class="ref-description">
    <p><code>rrapply</code> is a reimplemented and extended version of <code><a href='https://rdrr.io/r/base/rapply.html'>rapply</a></code> to recursively apply a function <code>f</code> to 
a set of elements of a list and deciding <em>how</em> the result is structured.</p>
    </div>

    <pre class="usage"><span class='fu'>rrapply</span>(
  <span class='no'>object</span>,
  <span class='no'>condition</span>,
  <span class='no'>f</span>,
  <span class='kw'>classes</span> <span class='kw'>=</span> <span class='st'>"ANY"</span>,
  <span class='kw'>deflt</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>how</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"replace"</span>, <span class='st'>"list"</span>, <span class='st'>"unlist"</span>, <span class='st'>"prune"</span>, <span class='st'>"flatten"</span>, <span class='st'>"melt"</span>, <span class='st'>"unmelt"</span>),
  <span class='kw'>feverywhere</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>dfaslist</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>,
  <span class='no'>...</span>
)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>object</th>
      <td><p>a <code><a href='https://rdrr.io/r/base/list.html'>list</a></code>, <code><a href='https://rdrr.io/r/base/expression.html'>expression</a></code> vector, or <code><a href='https://rdrr.io/r/base/call.html'>call</a></code> object, i.e., &#8220;list-like&#8221;.</p></td>
    </tr>
    <tr>
      <th>condition</th>
      <td><p>a condition <code><a href='https://rdrr.io/r/base/function.html'>function</a></code> of one &#8220;principal&#8221; argument and optional special arguments <code>.xname</code>, <code>.xpos</code>, 
<code>.xparents</code> and/or <code>.xsiblings</code> (see &#8216;Details&#8217;), passing further arguments via <code>...</code>.</p></td>
    </tr>
    <tr>
      <th>f</th>
      <td><p>a <code><a href='https://rdrr.io/r/base/function.html'>function</a></code> of one &#8220;principal&#8221; argument and optional special arguments <code>.xname</code>, <code>.xpos</code>, <code>.xparents</code> 
and/or <code>.xsiblings</code> (see &#8216;Details&#8217;), passing further arguments via <code>...</code>.</p></td>
    </tr>
    <tr>
      <th>classes</th>
      <td><p>character vector of <code><a href='https://rdrr.io/r/base/class.html'>class</a></code> names, or
    <code>"ANY"</code> to match any class.</p></td>
    </tr>
    <tr>
      <th>deflt</th>
      <td><p>the default result (only used if <code>how = "list"</code> or <code>how = "unlist"</code>).</p></td>
    </tr>
    <tr>
      <th>how</th>
      <td><p>character string partially matching the seven possibilities given: see &#8216;Details&#8217;.</p></td>
    </tr>
    <tr>
      <th>feverywhere</th>
      <td><p>character options <code>"break"</code> or <code>"recurse"</code> to override default behavior of <code>f</code>: see &#8216;Details&#8217;.
By default <code>NULL</code>, which applies <code>f</code> only to non &#8220;list-like&#8221; elements.</p></td>
    </tr>
    <tr>
      <th>dfaslist</th>
      <td><p>logical value to treat data.frames as &#8220;list-like&#8221; object.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>additional arguments passed to the call to <code>f</code> and <code>condition</code></p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>If <code>how = "unlist"</code>, a vector as in <code><a href='https://rdrr.io/r/base/rapply.html'>rapply</a></code>. If <code>how = "list"</code> or <code>how = "replace"</code>, &#8220;list-like&#8221; of similar 
structure as <code>object</code> as in <code><a href='https://rdrr.io/r/base/rapply.html'>rapply</a></code>. If <code>how = "prune"</code>, a pruned &#8220;list-like&#8221; object of similar structure as <code>object</code>
with pruned list elements based on <code>classes</code> and <code>condition</code>. If <code>how = "flatten"</code>, an unnested pruned list with pruned list elements 
based on <code>classes</code> and <code>condition</code>. If <code>how = "melt"</code>, a melted data.frame containing the node paths and values of the pruned list 
elements based on <code>classes</code> and <code>condition</code>. If <code>how = "unmelt"</code>, a nested list with list names and values defined in the data.frame <code>object</code>.</p>
    <h2 class="hasAnchor" id="note"><a class="anchor" href="#note"></a>Note</h2>

    <p><code>rrapply</code> allows the <code>f</code> function argument to be missing, in which case no function is applied to the list 
elements.</p>
<p><code>how = "unmelt"</code> requires as input a data.frame as returned by <code>how = "melt"</code> with character columns to name the nested list components
and a final list-column containing the values of the nested list elements.</p>
    <h2 class="hasAnchor" id="how-to-structure-result"><a class="anchor" href="#how-to-structure-result"></a>How to structure result</h2>

    

<p>In addition to <code><a href='https://rdrr.io/r/base/rapply.html'>rapply</a></code>'s modes to set <code>how</code> equal to <code>"replace"</code>, <code>"list"</code> or <code>"unlist"</code>, 
four choices <code>"prune"</code>, <code>"flatten"</code>, <code>"melt"</code> and <code>"unmelt"</code> are available. <code>how = "prune"</code> filters 
all list elements not subject to application of <code>f</code> from the list <code>object</code>. The original list structure is retained, 
similar to the non-pruned options <code>how = "replace"</code> or <code>how = "list"</code>. <code>how = "flatten"</code> is an efficient way to 
return a flattened unnested version of the pruned list. <code>how = "melt"</code> returns a melted data.frame of the pruned list, 
each row contains the path of a single terminal node in the pruned list at depth layers <code>L1</code>, <code>L2</code>, and so on. The list-column 
<code>"value"</code> contains the values at the terminal nodes and is equivalent to the flattened list returned by <code>how = "flatten"</code>. 
If no list names are present, the node names in the data.frame default to the indices of the list elements <code>"..1"</code>, <code>"..2"</code>, etc.
<code>how = "unmelt"</code> is a special case that reconstructs a nested list from a melted data.frame. For this reason, <code>how = "unmelt"</code> 
only applies to data.frames in the same format as returned by <code>how = "melt"</code>. Internally, <code>how = "unmelt"</code> first reconstructs 
a nested list from the melted data.frame and second uses the same framework as <code>how = "replace"</code>.</p>
    <h2 class="hasAnchor" id="condition-function"><a class="anchor" href="#condition-function"></a>Condition function</h2>

    

<p>Both <code><a href='https://rdrr.io/r/base/rapply.html'>rapply</a></code> and <code>rrapply</code> allow to apply <code>f</code> to list elements of certain classes via the <code>classes</code> argument. 
<code>rrapply</code> generalizes this concept via an additional <code>condition</code> argument, which accepts any function to use as a condition 
or predicate to select list elements to which <code>f</code> is applied. Conceptually, the <code>f</code> function is applied to all list elements for 
which the <code>condition</code> function exactly evaluates to <code>TRUE</code> similar to <code><a href='https://rdrr.io/r/base/Logic.html'>isTRUE</a></code>. If the condition function is missing, 
<code>f</code> is applied to all list elements.
Since the <code>condition</code> function generalizes the <code>classes</code> argument, it is allowed to use the <code>deflt</code> argument 
together with <code>how = "list"</code> or <code>how = "unlist"</code> to set a default value to all list elements for which the <code>condition</code> does 
not evaluate to <code>TRUE</code>.</p>
    <h2 class="hasAnchor" id="correct-use-of-"><a class="anchor" href="#correct-use-of-"></a>Correct use of <code>...</code></h2>

    

<p>The principal argument of the <code>f</code> and <code>condition</code> functions evaluates to the content of the list element. Any further arguments to 
<code>f</code> and <code>condition</code> (besides the special arguments <code>.xname</code> and <code>.xpos</code> discussed below) supplied via the dots <code>...</code> 
argument need to be defined as function arguments in <em>both</em> the <code>f</code> and <code>condition</code> function (if existing), even if they are not
 used in the function itself. See also the &#8216;Examples&#8217; section.</p>
    <h2 class="hasAnchor" id="special-arguments-xname-xpos-xparents-and-xsiblings"><a class="anchor" href="#special-arguments-xname-xpos-xparents-and-xsiblings"></a>Special arguments <code>.xname</code>, <code>.xpos</code>, <code>.xparents</code> and <code>.xsiblings</code></h2>

    

<p>The <code>f</code> and <code>condition</code> functions accept four special arguments <code>.xname</code>, <code>.xpos</code>, <code>.xparents</code> and <code>.xsiblings</code> in
addition to the first principal argument. The <code>.xname</code> argument evaluates to the name of the list element. The <code>.xpos</code> argument evaluates 
to the position of the element in the nested list structured as an integer vector. That is, if <code>x = list(list("y", "z"))</code>, then an <code>.xpos</code> 
location of <code><a href='https://rdrr.io/r/base/c.html'>c(1, 2)</a></code> corresponds to the list element <code>x[[c(1, 2)]]</code>. The <code>.xparents</code> argument evaluates to a vector of all parent 
node names in the path to the list element. The <code>.xsiblings</code> argument evaluates to the complete (sub)list that includes the list element as a direct child.
The names <code>.xname</code>, <code>.xpos</code>, <code>.xparents</code> or <code>.xsiblings</code> need to be explicitly included as function arguments in <code>f</code> and 
<code>condition</code> (in addition to the principal argument). See the package vignette for example uses of these special variables.</p>
    <h2 class="hasAnchor" id="list-node-aggregation"><a class="anchor" href="#list-node-aggregation"></a>List node aggregation</h2>

    

<p>By default, <code>rrapply</code> recurses into any &#8220;list-like&#8221; element. If <code>feverywhere = "break"</code>, this behavior is overridden and the 
<code>f</code> function is applied to any element of <code>object</code> (e.g. a sublist) that satisfies <code>condition</code> and <code>classes</code>. 
If the <code>condition</code> or <code>classes</code> arguments are not satisfied for a &#8220;list-like&#8221; element, <code>rrapply</code> will recurse further into the sublist, 
apply the <code>f</code> function to the nodes that satisfy <code>condition</code> and <code>classes</code>, and so on. The primary use of <code>feverywhere = "break"</code> is 
to aggregate list nodes or summarize sublists of <code>object</code>. Additional examples can be found in the package vignette.</p>
    <h2 class="hasAnchor" id="list-node-updating"><a class="anchor" href="#list-node-updating"></a>List node updating</h2>

    

<p>If <code>feverywhere = "recurse"</code>, <code>rrapply</code> applies the <code>f</code> function to any element of <code>object</code> (e.g. a sublist) that satisfies 
<code>condition</code> and <code>classes</code> similar to <code>feverywhere = "break"</code>, but recurses further into the <em>updated</em> list-like element 
after application of the <code>f</code> function. The primary use of <code>feverywhere = "recurse"</code> is to recursively update for instance the names of 
all nodes in a nested list. Additional examples are found in the package vignette.</p>
    <h2 class="hasAnchor" id="data-frames-as-lists"><a class="anchor" href="#data-frames-as-lists"></a>Data.frames as lists</h2>

    

<p>If <code>feverywhere = NULL</code> (default), <code>rrapply</code> recurses into all &#8220;list-like&#8221; objects equivalent to <code><a href='https://rdrr.io/r/base/rapply.html'>rapply</a></code>. 
Since data.frames are &#8220;list-like&#8221; objects, the <code>f</code> function will descend into the individual columns of a data.frame. 
If <code>dfaslist = FALSE</code>, data.frames are no longer viewed as lists and the <code>f</code> and <code>condition</code> functions are 
applied directly to the data.frame itself and not its columns.</p>
    <h2 class="hasAnchor" id="list-attributes"><a class="anchor" href="#list-attributes"></a>List attributes</h2>

    

<p>In <code><a href='https://rdrr.io/r/base/rapply.html'>rapply</a></code> intermediate list attributes (not located at the leafs) are kept when <code>how = "replace"</code>, but are dropped when 
<code>how = "list"</code>. To avoid unexpected behavior, <code>rrapply</code> always preserves intermediate list attributes when using <code>how = "replace"</code>, 
<code>how = "list"</code> or <code>how = "prune"</code>. If <code>how = "flatten"</code> or <code>how = "unlist"</code> intermediate list attributes cannot be preserved as 
the result is no longer a nested list.</p>
    <h2 class="hasAnchor" id="expressions"><a class="anchor" href="#expressions"></a>Expressions</h2>

    

<p>Call objects and expression vectors are also accepted as <code>object</code> argument, which are treated as nested lists based on their internal abstract
syntax trees. As such, all functionality that applies to nested lists extends directly to call objects and expression vectors. If <code>object</code> is a 
call object or expression vector, <code>how = "replace"</code> always maintains the type of <code>object</code>, whereas <code>how = "list"</code> returns the result 
structured as a nested list. <code>how = "prune"</code>, <code>how = "flatten"</code> and <code>how = "melt"</code> return the pruned abstract syntax tree as: a nested list, 
a flattened list and a melted data.frame respectively. This is identical to application of <code>rrapply</code> to the abstract syntax tree formatted as a nested list.</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='https://rdrr.io/r/base/rapply.html'>rapply</a></code></p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'># Example data</span>

<span class='co'>## Nested list of renewable energy (%) of total energy consumption per country in 2016</span>
<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span>(<span class='st'>"renewable_energy_by_country"</span>)
<span class='co'>## Subset values for countries and areas in Oceania</span>
<span class='no'>renewable_oceania</span> <span class='kw'>&lt;-</span> <span class='no'>renewable_energy_by_country</span><span class='kw'>[[</span><span class='st'>"World"</span>]][<span class='st'>"Oceania"</span>]

<span class='co'># List pruning and unnesting</span>

<span class='co'>## Drop all logical NA's while preserving list structure </span>
<span class='no'>na_drop_oceania</span> <span class='kw'>&lt;-</span> <span class='fu'>rrapply</span>(
  <span class='no'>renewable_oceania</span>,
  <span class='kw'>f</span> <span class='kw'>=</span> <span class='kw'>function</span>(<span class='no'>x</span>) <span class='no'>x</span>,
  <span class='kw'>classes</span> <span class='kw'>=</span> <span class='st'>"numeric"</span>,
  <span class='kw'>how</span> <span class='kw'>=</span> <span class='st'>"prune"</span>
)
<span class='fu'><a href='https://rdrr.io/r/utils/str.html'>str</a></span>(<span class='no'>na_drop_oceania</span>, <span class='kw'>list.len</span> <span class='kw'>=</span> <span class='fl'>3</span>, <span class='kw'>give.attr</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)</div><div class='output co'>#&gt; List of 1
#&gt;  $ Oceania:List of 4
#&gt;   ..$ Australia and New Zealand:List of 2
#&gt;   .. ..$ Australia  : num 9.32
#&gt;   .. ..$ New Zealand: num 32.8
#&gt;   ..$ Melanesia                :List of 5
#&gt;   .. ..$ Fiji            : num 24.4
#&gt;   .. ..$ New Caledonia   : num 4.03
#&gt;   .. ..$ Papua New Guinea: num 50.3
#&gt;   .. .. [list output truncated]
#&gt;   ..$ Micronesia               :List of 7
#&gt;   .. ..$ Guam                            : num 3.03
#&gt;   .. ..$ Kiribati                        : num 45.4
#&gt;   .. ..$ Marshall Islands                : num 11.8
#&gt;   .. .. [list output truncated]
#&gt;   .. [list output truncated]</div><div class='input'>
<span class='co'>## Drop all logical NA's and return unnested list</span>
<span class='no'>na_drop_oceania2</span> <span class='kw'>&lt;-</span> <span class='fu'>rrapply</span>(
  <span class='no'>renewable_oceania</span>,
  <span class='kw'>f</span> <span class='kw'>=</span> <span class='kw'>function</span>(<span class='no'>x</span>) <span class='no'>x</span>,
  <span class='kw'>classes</span> <span class='kw'>=</span> <span class='st'>"numeric"</span>,
  <span class='kw'>how</span> <span class='kw'>=</span> <span class='st'>"flatten"</span>
)
<span class='fu'><a href='https://rdrr.io/r/utils/str.html'>str</a></span>(<span class='no'>na_drop_oceania2</span>, <span class='kw'>list.len</span> <span class='kw'>=</span> <span class='fl'>10</span>, <span class='kw'>give.attr</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)</div><div class='output co'>#&gt; List of 22
#&gt;  $ Australia                       : num 9.32
#&gt;  $ New Zealand                     : num 32.8
#&gt;  $ Fiji                            : num 24.4
#&gt;  $ New Caledonia                   : num 4.03
#&gt;  $ Papua New Guinea                : num 50.3
#&gt;  $ Solomon Islands                 : num 65.7
#&gt;  $ Vanuatu                         : num 33.7
#&gt;  $ Guam                            : num 3.03
#&gt;  $ Kiribati                        : num 45.4
#&gt;  $ Marshall Islands                : num 11.8
#&gt;   [list output truncated]</div><div class='input'>
<span class='co'>## Drop all logical NA's and return melted data.frame</span>
<span class='no'>na_drop_oceania3</span> <span class='kw'>&lt;-</span> <span class='fu'>rrapply</span>(
  <span class='no'>renewable_oceania</span>,
  <span class='kw'>f</span> <span class='kw'>=</span> <span class='no'>identity</span>,
  <span class='kw'>classes</span> <span class='kw'>=</span> <span class='st'>"numeric"</span>,
  <span class='kw'>how</span> <span class='kw'>=</span> <span class='st'>"melt"</span>
)

<span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span>(<span class='no'>na_drop_oceania3</span>)</div><div class='output co'>#&gt;        L1                        L2               L3 value
#&gt; 1 Oceania Australia and New Zealand        Australia  9.32
#&gt; 2 Oceania Australia and New Zealand      New Zealand 32.76
#&gt; 3 Oceania                 Melanesia             Fiji 24.36
#&gt; 4 Oceania                 Melanesia    New Caledonia  4.03
#&gt; 5 Oceania                 Melanesia Papua New Guinea 50.34
#&gt; 6 Oceania                 Melanesia  Solomon Islands 65.73</div><div class='input'>
<span class='co'>## Reconstruct nested list from melted data.frame</span>
<span class='no'>na_drop_oceania4</span> <span class='kw'>&lt;-</span> <span class='fu'>rrapply</span>(
  <span class='no'>na_drop_oceania3</span>,
  <span class='kw'>how</span> <span class='kw'>=</span> <span class='st'>"unmelt"</span>
)

<span class='fu'><a href='https://rdrr.io/r/utils/str.html'>str</a></span>(<span class='no'>na_drop_oceania4</span>, <span class='kw'>list.len</span> <span class='kw'>=</span> <span class='fl'>3</span>, <span class='kw'>give.attr</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)</div><div class='output co'>#&gt; List of 1
#&gt;  $ Oceania:List of 4
#&gt;   ..$ Australia and New Zealand:List of 2
#&gt;   .. ..$ Australia  : num 9.32
#&gt;   .. ..$ New Zealand: num 32.8
#&gt;   ..$ Melanesia                :List of 5
#&gt;   .. ..$ Fiji            : num 24.4
#&gt;   .. ..$ New Caledonia   : num 4.03
#&gt;   .. ..$ Papua New Guinea: num 50.3
#&gt;   .. .. [list output truncated]
#&gt;   ..$ Micronesia               :List of 7
#&gt;   .. ..$ Guam                            : num 3.03
#&gt;   .. ..$ Kiribati                        : num 45.4
#&gt;   .. ..$ Marshall Islands                : num 11.8
#&gt;   .. .. [list output truncated]
#&gt;   .. [list output truncated]</div><div class='input'>
<span class='co'># Condition function</span>

<span class='co'>## Drop all NA elements using condition function</span>
<span class='no'>na_drop_oceania3</span> <span class='kw'>&lt;-</span> <span class='fu'>rrapply</span>(
  <span class='no'>renewable_oceania</span>,
  <span class='kw'>condition</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/funprog.html'>Negate</a></span>(<span class='no'>is.na</span>),
  <span class='kw'>f</span> <span class='kw'>=</span> <span class='kw'>function</span>(<span class='no'>x</span>) <span class='no'>x</span>,
  <span class='kw'>how</span> <span class='kw'>=</span> <span class='st'>"prune"</span>
)
<span class='fu'><a href='https://rdrr.io/r/utils/str.html'>str</a></span>(<span class='no'>na_drop_oceania3</span>, <span class='kw'>list.len</span> <span class='kw'>=</span> <span class='fl'>3</span>, <span class='kw'>give.attr</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)</div><div class='output co'>#&gt; List of 1
#&gt;  $ Oceania:List of 4
#&gt;   ..$ Australia and New Zealand:List of 2
#&gt;   .. ..$ Australia  : num 9.32
#&gt;   .. ..$ New Zealand: num 32.8
#&gt;   ..$ Melanesia                :List of 5
#&gt;   .. ..$ Fiji            : num 24.4
#&gt;   .. ..$ New Caledonia   : num 4.03
#&gt;   .. ..$ Papua New Guinea: num 50.3
#&gt;   .. .. [list output truncated]
#&gt;   ..$ Micronesia               :List of 7
#&gt;   .. ..$ Guam                            : num 3.03
#&gt;   .. ..$ Kiribati                        : num 45.4
#&gt;   .. ..$ Marshall Islands                : num 11.8
#&gt;   .. .. [list output truncated]
#&gt;   .. [list output truncated]</div><div class='input'>
<span class='co'>## Replace NA elements by a new value via the ... argument</span>
<span class='co'>## NB: the 'newvalue' argument should be present as function </span>
<span class='co'>## argument in both 'f' and 'condition', even if unused.</span>
<span class='no'>na_zero_oceania</span> <span class='kw'>&lt;-</span> <span class='fu'>rrapply</span>(
  <span class='no'>renewable_oceania</span>,
  <span class='kw'>condition</span> <span class='kw'>=</span> <span class='kw'>function</span>(<span class='no'>x</span>, <span class='no'>newvalue</span>) <span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span>(<span class='no'>x</span>),
  <span class='kw'>f</span> <span class='kw'>=</span> <span class='kw'>function</span>(<span class='no'>x</span>, <span class='no'>newvalue</span>) <span class='no'>newvalue</span>,
  <span class='kw'>newvalue</span> <span class='kw'>=</span> <span class='fl'>0</span>,
  <span class='kw'>how</span> <span class='kw'>=</span> <span class='st'>"replace"</span>
)
<span class='fu'><a href='https://rdrr.io/r/utils/str.html'>str</a></span>(<span class='no'>na_zero_oceania</span>, <span class='kw'>list.len</span> <span class='kw'>=</span> <span class='fl'>3</span>, <span class='kw'>give.attr</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)</div><div class='output co'>#&gt; List of 1
#&gt;  $ Oceania:List of 4
#&gt;   ..$ Australia and New Zealand:List of 6
#&gt;   .. ..$ Australia                        : num 9.32
#&gt;   .. ..$ Christmas Island                 : num 0
#&gt;   .. ..$ Cocos (Keeling) Islands          : num 0
#&gt;   .. .. [list output truncated]
#&gt;   ..$ Melanesia                :List of 5
#&gt;   .. ..$ Fiji            : num 24.4
#&gt;   .. ..$ New Caledonia   : num 4.03
#&gt;   .. ..$ Papua New Guinea: num 50.3
#&gt;   .. .. [list output truncated]
#&gt;   ..$ Micronesia               :List of 8
#&gt;   .. ..$ Guam                                : num 3.03
#&gt;   .. ..$ Kiribati                            : num 45.4
#&gt;   .. ..$ Marshall Islands                    : num 11.8
#&gt;   .. .. [list output truncated]
#&gt;   .. [list output truncated]</div><div class='input'>
<span class='co'>## Filter all countries with values above 85%</span>
<span class='no'>renewable_energy_above_85</span> <span class='kw'>&lt;-</span> <span class='fu'>rrapply</span>(
  <span class='no'>renewable_energy_by_country</span>,
  <span class='kw'>condition</span> <span class='kw'>=</span> <span class='kw'>function</span>(<span class='no'>x</span>) <span class='no'>x</span> <span class='kw'>&gt;</span> <span class='fl'>85</span>,
  <span class='kw'>how</span> <span class='kw'>=</span> <span class='st'>"prune"</span>
)
<span class='fu'><a href='https://rdrr.io/r/utils/str.html'>str</a></span>(<span class='no'>renewable_energy_above_85</span>, <span class='kw'>give.attr</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)</div><div class='output co'>#&gt; List of 1
#&gt;  $ World:List of 1
#&gt;   ..$ Africa:List of 1
#&gt;   .. ..$ Sub-Saharan Africa:List of 3
#&gt;   .. .. ..$ Eastern Africa:List of 7
#&gt;   .. .. .. ..$ Burundi                    : num 89.2
#&gt;   .. .. .. ..$ Ethiopia                   : num 91.9
#&gt;   .. .. .. ..$ Rwanda                     : num 86
#&gt;   .. .. .. ..$ Somalia                    : num 94.7
#&gt;   .. .. .. ..$ Uganda                     : num 88.6
#&gt;   .. .. .. ..$ United Republic of Tanzania: num 86.1
#&gt;   .. .. .. ..$ Zambia                     : num 88.5
#&gt;   .. .. ..$ Middle Africa :List of 2
#&gt;   .. .. .. ..$ Chad                            : num 85.3
#&gt;   .. .. .. ..$ Democratic Republic of the Congo: num 97
#&gt;   .. .. ..$ Western Africa:List of 1
#&gt;   .. .. .. ..$ Guinea-Bissau: num 86.5</div><div class='input'>
<span class='co'># Special arguments .xname, .xpos and .xparents</span>

<span class='co'>## Apply a function using the name of the node</span>
<span class='no'>renewable_oceania_text</span> <span class='kw'>&lt;-</span> <span class='fu'>rrapply</span>(
  <span class='no'>renewable_oceania</span>,
  <span class='kw'>f</span> <span class='kw'>=</span> <span class='kw'>function</span>(<span class='no'>x</span>, <span class='no'>.xname</span>) <span class='fu'><a href='https://rdrr.io/r/base/sprintf.html'>sprintf</a></span>(<span class='st'>"Renewable energy in %s: %.2f%%"</span>, <span class='no'>.xname</span>, <span class='no'>x</span>),
  <span class='kw'>condition</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/funprog.html'>Negate</a></span>(<span class='no'>is.na</span>),
  <span class='kw'>how</span> <span class='kw'>=</span> <span class='st'>"flatten"</span>
)
<span class='fu'><a href='https://rdrr.io/r/utils/str.html'>str</a></span>(<span class='no'>renewable_oceania_text</span>, <span class='kw'>list.len</span> <span class='kw'>=</span> <span class='fl'>10</span>)</div><div class='output co'>#&gt; List of 22
#&gt;  $ Australia                       : chr "Renewable energy in Australia: 9.32%"
#&gt;  $ New Zealand                     : chr "Renewable energy in New Zealand: 32.76%"
#&gt;  $ Fiji                            : chr "Renewable energy in Fiji: 24.36%"
#&gt;  $ New Caledonia                   : chr "Renewable energy in New Caledonia: 4.03%"
#&gt;  $ Papua New Guinea                : chr "Renewable energy in Papua New Guinea: 50.34%"
#&gt;  $ Solomon Islands                 : chr "Renewable energy in Solomon Islands: 65.73%"
#&gt;  $ Vanuatu                         : chr "Renewable energy in Vanuatu: 33.67%"
#&gt;  $ Guam                            : chr "Renewable energy in Guam: 3.03%"
#&gt;  $ Kiribati                        : chr "Renewable energy in Kiribati: 45.43%"
#&gt;  $ Marshall Islands                : chr "Renewable energy in Marshall Islands: 11.75%"
#&gt;   [list output truncated]</div><div class='input'>
<span class='co'>## Extract values based on country names</span>
<span class='no'>renewable_benelux</span> <span class='kw'>&lt;-</span> <span class='fu'>rrapply</span>(
  <span class='no'>renewable_energy_by_country</span>,
  <span class='kw'>condition</span> <span class='kw'>=</span> <span class='kw'>function</span>(<span class='no'>x</span>, <span class='no'>.xname</span>) <span class='no'>.xname</span> <span class='kw'>%in%</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"Belgium"</span>, <span class='st'>"Netherlands"</span>, <span class='st'>"Luxembourg"</span>),
  <span class='kw'>how</span> <span class='kw'>=</span> <span class='st'>"prune"</span>
)
<span class='fu'><a href='https://rdrr.io/r/utils/str.html'>str</a></span>(<span class='no'>renewable_benelux</span>, <span class='kw'>give.attr</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)</div><div class='output co'>#&gt; List of 1
#&gt;  $ World:List of 1
#&gt;   ..$ Europe:List of 1
#&gt;   .. ..$ Western Europe:List of 3
#&gt;   .. .. ..$ Belgium    : num 9.14
#&gt;   .. .. ..$ Luxembourg : num 13.5
#&gt;   .. .. ..$ Netherlands: num 5.78</div><div class='input'>
<span class='co'>## Filter European countries with value above 50%</span>
<span class='no'>renewable_europe_above_50</span> <span class='kw'>&lt;-</span> <span class='fu'>rrapply</span>(
  <span class='no'>renewable_energy_by_country</span>,
  <span class='kw'>condition</span> <span class='kw'>=</span> <span class='kw'>function</span>(<span class='no'>x</span>, <span class='no'>.xpos</span>) <span class='fu'><a href='https://rdrr.io/r/base/identical.html'>identical</a></span>(<span class='no'>.xpos</span>[<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>1</span>, <span class='fl'>2</span>)], <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>1L</span>, <span class='fl'>5L</span>)) <span class='kw'>&amp;</span> <span class='no'>x</span> <span class='kw'>&gt;</span> <span class='fl'>50</span>,
  <span class='kw'>how</span> <span class='kw'>=</span> <span class='st'>"prune"</span>
)
<span class='fu'><a href='https://rdrr.io/r/utils/str.html'>str</a></span>(<span class='no'>renewable_europe_above_50</span>, <span class='kw'>give.attr</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)</div><div class='output co'>#&gt; List of 1
#&gt;  $ World:List of 1
#&gt;   ..$ Europe:List of 2
#&gt;   .. ..$ Northern Europe:List of 3
#&gt;   .. .. ..$ Iceland: num 78.1
#&gt;   .. .. ..$ Norway : num 59.5
#&gt;   .. .. ..$ Sweden : num 51.4
#&gt;   .. ..$ Western Europe :List of 1
#&gt;   .. .. ..$ Liechtenstein: num 62.9</div><div class='input'>
<span class='co'>## Filter European countries with value above 50%</span>
<span class='no'>renewable_europe_above_50</span> <span class='kw'>&lt;-</span> <span class='fu'>rrapply</span>(
  <span class='no'>renewable_energy_by_country</span>,
  <span class='kw'>condition</span> <span class='kw'>=</span> <span class='kw'>function</span>(<span class='no'>x</span>, <span class='no'>.xparents</span>) <span class='st'>"Europe"</span> <span class='kw'>%in%</span> <span class='no'>.xparents</span> <span class='kw'>&amp;</span> <span class='no'>x</span> <span class='kw'>&gt;</span> <span class='fl'>50</span>,
  <span class='kw'>how</span> <span class='kw'>=</span> <span class='st'>"prune"</span>
)
<span class='fu'><a href='https://rdrr.io/r/utils/str.html'>str</a></span>(<span class='no'>renewable_europe_above_50</span>, <span class='kw'>give.attr</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)</div><div class='output co'>#&gt; List of 1
#&gt;  $ World:List of 1
#&gt;   ..$ Europe:List of 2
#&gt;   .. ..$ Northern Europe:List of 3
#&gt;   .. .. ..$ Iceland: num 78.1
#&gt;   .. .. ..$ Norway : num 59.5
#&gt;   .. .. ..$ Sweden : num 51.4
#&gt;   .. ..$ Western Europe :List of 1
#&gt;   .. .. ..$ Liechtenstein: num 62.9</div><div class='input'>
<span class='co'>## Return position of Sweden in list</span>
(<span class='no'>xpos_sweden</span> <span class='kw'>&lt;-</span> <span class='fu'>rrapply</span>(
  <span class='no'>renewable_energy_by_country</span>,
  <span class='kw'>condition</span> <span class='kw'>=</span> <span class='kw'>function</span>(<span class='no'>x</span>, <span class='no'>.xname</span>) <span class='fu'><a href='https://rdrr.io/r/base/identical.html'>identical</a></span>(<span class='no'>.xname</span>, <span class='st'>"Sweden"</span>),
  <span class='kw'>f</span> <span class='kw'>=</span> <span class='kw'>function</span>(<span class='no'>x</span>, <span class='no'>.xpos</span>) <span class='no'>.xpos</span>,
  <span class='kw'>how</span> <span class='kw'>=</span> <span class='st'>"flatten"</span>
))</div><div class='output co'>#&gt; $Sweden
#&gt; [1]  1  5  2 14
#&gt; </div><div class='input'><span class='no'>renewable_energy_by_country</span><span class='kw'>[[</span><span class='no'>xpos_sweden</span>$<span class='no'>Sweden</span>]]</div><div class='output co'>#&gt; [1] 51.35
#&gt; attr(,"M49-code")
#&gt; [1] "752"</div><div class='input'>
<span class='co'>## Return siblings of Sweden in list</span>
<span class='no'>siblings_sweden</span> <span class='kw'>&lt;-</span> <span class='fu'>rrapply</span>(
  <span class='no'>renewable_energy_by_country</span>,
  <span class='kw'>condition</span> <span class='kw'>=</span> <span class='kw'>function</span>(<span class='no'>x</span>, <span class='no'>.xsiblings</span>) <span class='st'>"Sweden"</span> <span class='kw'>%in%</span> <span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span>(<span class='no'>.xsiblings</span>),
  <span class='kw'>how</span> <span class='kw'>=</span> <span class='st'>"flatten"</span>
)
<span class='fu'><a href='https://rdrr.io/r/utils/str.html'>str</a></span>(<span class='no'>siblings_sweden</span>, <span class='kw'>list.len</span> <span class='kw'>=</span> <span class='fl'>10</span>, <span class='kw'>give.attr</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)</div><div class='output co'>#&gt; List of 14
#&gt;  $ Aland Islands                                       : logi NA
#&gt;  $ Denmark                                             : num 33.1
#&gt;  $ Estonia                                             : num 26.6
#&gt;  $ Faroe Islands                                       : num 4.24
#&gt;  $ Finland                                             : num 42
#&gt;  $ Iceland                                             : num 78.1
#&gt;  $ Ireland                                             : num 8.65
#&gt;  $ Isle of Man                                         : num 4.3
#&gt;  $ Latvia                                              : num 38.5
#&gt;  $ Lithuania                                           : num 31.4
#&gt;   [list output truncated]</div><div class='input'>
<span class='co'># List node aggregation</span>

<span class='co'>## Calculate mean value of Europe</span>
<span class='fu'>rrapply</span>(
  <span class='no'>renewable_energy_by_country</span>,
  <span class='kw'>condition</span> <span class='kw'>=</span> <span class='kw'>function</span>(<span class='no'>x</span>, <span class='no'>.xname</span>) <span class='no'>.xname</span> <span class='kw'>==</span> <span class='st'>"Europe"</span>,
  <span class='kw'>f</span> <span class='kw'>=</span> <span class='kw'>function</span>(<span class='no'>x</span>) <span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/unlist.html'>unlist</a></span>(<span class='no'>x</span>), <span class='kw'>na.rm</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>),
  <span class='kw'>how</span> <span class='kw'>=</span> <span class='st'>"flatten"</span>,
  <span class='kw'>feverywhere</span> <span class='kw'>=</span> <span class='st'>"break"</span>
)</div><div class='output co'>#&gt; $Europe
#&gt; [1] 22.36565
#&gt; </div><div class='input'>
<span class='co'>## Calculate mean value for each continent</span>
<span class='no'>renewable_continent_summary</span> <span class='kw'>&lt;-</span> <span class='fu'>rrapply</span>(
  <span class='no'>renewable_energy_by_country</span>,
  <span class='kw'>condition</span> <span class='kw'>=</span> <span class='kw'>function</span>(<span class='no'>x</span>, <span class='no'>.xpos</span>) <span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span>(<span class='no'>.xpos</span>) <span class='kw'>==</span> <span class='fl'>2</span>,
  <span class='kw'>f</span> <span class='kw'>=</span> <span class='kw'>function</span>(<span class='no'>x</span>) <span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/unlist.html'>unlist</a></span>(<span class='no'>x</span>), <span class='kw'>na.rm</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>),
  <span class='kw'>feverywhere</span> <span class='kw'>=</span> <span class='st'>"break"</span>
)

<span class='co'>## Antarctica's value is missing</span>
<span class='fu'><a href='https://rdrr.io/r/utils/str.html'>str</a></span>(<span class='no'>renewable_continent_summary</span>, <span class='kw'>give.attr</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)</div><div class='output co'>#&gt; List of 1
#&gt;  $ World:List of 6
#&gt;   ..$ Africa    : num 54.3
#&gt;   ..$ Americas  : num 18.2
#&gt;   ..$ Antarctica: num NaN
#&gt;   ..$ Asia      : num 17.9
#&gt;   ..$ Europe    : num 22.4
#&gt;   ..$ Oceania   : num 17.8</div><div class='input'>
<span class='co'># List node updating</span>

<span class='co'>## replace country names by M-49 codes</span>
<span class='no'>renewable_M49</span> <span class='kw'>&lt;-</span> <span class='fu'>rrapply</span>(
  <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='no'>renewable_energy_by_country</span>),
  <span class='kw'>condition</span> <span class='kw'>=</span> <span class='no'>is.list</span>,
  <span class='kw'>f</span> <span class='kw'>=</span> <span class='kw'>function</span>(<span class='no'>x</span>) {
    <span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span>(<span class='no'>x</span>) <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>vapply</a></span>(<span class='no'>x</span>, <span class='no'>attr</span>, <span class='fu'><a href='https://rdrr.io/r/base/character.html'>character</a></span>(<span class='fl'>1L</span>), <span class='kw'>which</span> <span class='kw'>=</span> <span class='st'>"M49-code"</span>)
    <span class='fu'><a href='https://rdrr.io/r/base/function.html'>return</a></span>(<span class='no'>x</span>)
  },
  <span class='kw'>feverywhere</span> <span class='kw'>=</span> <span class='st'>"recurse"</span>
)

<span class='fu'><a href='https://rdrr.io/r/utils/str.html'>str</a></span>(<span class='no'>renewable_M49</span><span class='kw'>[[</span><span class='fl'>1</span>]], <span class='kw'>max.level</span> <span class='kw'>=</span> <span class='fl'>3</span>, <span class='kw'>list.len</span> <span class='kw'>=</span> <span class='fl'>3</span>, <span class='kw'>give.attr</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)</div><div class='output co'>#&gt; List of 1
#&gt;  $ 001:List of 6
#&gt;   ..$ 002:List of 2
#&gt;   .. ..$ 015:List of 7
#&gt;   .. ..$ 202:List of 4
#&gt;   ..$ 019:List of 2
#&gt;   .. ..$ 419:List of 3
#&gt;   .. ..$ 021:List of 5
#&gt;   ..$ 010: logi NA
#&gt;   .. [list output truncated]</div><div class='input'>
<span class='co'># List attributes</span>

<span class='co'>## how = "list" preserves all list attributes</span>
<span class='no'>na_drop_oceania_attr</span> <span class='kw'>&lt;-</span> <span class='fu'>rrapply</span>(
  <span class='no'>renewable_oceania</span>,
  <span class='kw'>f</span> <span class='kw'>=</span> <span class='kw'>function</span>(<span class='no'>x</span>) <span class='fu'><a href='https://rdrr.io/r/base/replace.html'>replace</a></span>(<span class='no'>x</span>, <span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span>(<span class='no'>x</span>), <span class='fl'>0</span>),
  <span class='kw'>how</span> <span class='kw'>=</span> <span class='st'>"list"</span>
)
<span class='fu'><a href='https://rdrr.io/r/utils/str.html'>str</a></span>(<span class='no'>na_drop_oceania_attr</span>, <span class='kw'>max.level</span> <span class='kw'>=</span> <span class='fl'>2</span>)</div><div class='output co'>#&gt; List of 1
#&gt;  $ Oceania:List of 4
#&gt;   ..$ Australia and New Zealand:List of 6
#&gt;   .. ..- attr(*, "M49-code")= chr "053"
#&gt;   ..$ Melanesia                :List of 5
#&gt;   .. ..- attr(*, "M49-code")= chr "054"
#&gt;   ..$ Micronesia               :List of 8
#&gt;   .. ..- attr(*, "M49-code")= chr "057"
#&gt;   ..$ Polynesia                :List of 10
#&gt;   .. ..- attr(*, "M49-code")= chr "061"
#&gt;   ..- attr(*, "M49-code")= chr "009"</div><div class='input'>
<span class='co'>## how = "prune" also preserves list attributes</span>
<span class='no'>na_drop_oceania_attr2</span> <span class='kw'>&lt;-</span> <span class='fu'>rrapply</span>(
  <span class='no'>renewable_oceania</span>,
  <span class='kw'>condition</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/funprog.html'>Negate</a></span>(<span class='no'>is.na</span>),
  <span class='kw'>how</span> <span class='kw'>=</span> <span class='st'>"prune"</span>
)
<span class='fu'><a href='https://rdrr.io/r/utils/str.html'>str</a></span>(<span class='no'>na_drop_oceania_attr2</span>, <span class='kw'>max.level</span> <span class='kw'>=</span> <span class='fl'>2</span>)</div><div class='output co'>#&gt; List of 1
#&gt;  $ Oceania:List of 4
#&gt;   ..$ Australia and New Zealand:List of 2
#&gt;   .. ..- attr(*, "M49-code")= chr "053"
#&gt;   ..$ Melanesia                :List of 5
#&gt;   .. ..- attr(*, "M49-code")= chr "054"
#&gt;   ..$ Micronesia               :List of 7
#&gt;   .. ..- attr(*, "M49-code")= chr "057"
#&gt;   ..$ Polynesia                :List of 8
#&gt;   .. ..- attr(*, "M49-code")= chr "061"
#&gt;   ..- attr(*, "M49-code")= chr "009"</div><div class='input'>
<span class='co'># Expressions</span>

<span class='co'>## Replace logicals by integers</span>
<span class='no'>call_old</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/substitute.html'>quote</a></span>(<span class='no'>y</span> <span class='kw'>&lt;-</span> <span class='no'>x</span> <span class='kw'>&lt;-</span> <span class='fl'>1</span> + <span class='fl'>TRUE</span>)
<span class='no'>call_new</span> <span class='kw'>&lt;-</span> <span class='fu'>rrapply</span>(<span class='no'>call_old</span>,
  <span class='kw'>classes</span> <span class='kw'>=</span> <span class='st'>"logical"</span>,
  <span class='kw'>f</span> <span class='kw'>=</span> <span class='no'>as.numeric</span>,
  <span class='kw'>how</span> <span class='kw'>=</span> <span class='st'>"replace"</span>
)
<span class='fu'><a href='https://rdrr.io/r/utils/str.html'>str</a></span>(<span class='no'>call_new</span>)</div><div class='output co'>#&gt;  language y &lt;- x &lt;- 1 + 1</div><div class='input'>
<span class='co'>## Update and decompose call object</span>
<span class='no'>call_ast</span> <span class='kw'>&lt;-</span> <span class='fu'>rrapply</span>(<span class='no'>call_old</span>,
  <span class='kw'>f</span> <span class='kw'>=</span> <span class='kw'>function</span>(<span class='no'>x</span>) <span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/logical.html'>is.logical</a></span>(<span class='no'>x</span>), <span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span>(<span class='no'>x</span>), <span class='no'>x</span>),
  <span class='kw'>how</span> <span class='kw'>=</span> <span class='st'>"list"</span>
)
<span class='fu'><a href='https://rdrr.io/r/utils/str.html'>str</a></span>(<span class='no'>call_ast</span>)</div><div class='output co'>#&gt; List of 3
#&gt;  $ : symbol &lt;-
#&gt;  $ : symbol y
#&gt;  $ :List of 3
#&gt;   ..$ : symbol &lt;-
#&gt;   ..$ : symbol x
#&gt;   ..$ :List of 3
#&gt;   .. ..$ : symbol +
#&gt;   .. ..$ : num 1
#&gt;   .. ..$ : num 1</div><div class='input'>
<span class='co'>## Prune and decompose expression</span>
<span class='no'>expr</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/expression.html'>expression</a></span>(<span class='no'>y</span> <span class='kw'>&lt;-</span> <span class='no'>x</span> <span class='kw'>&lt;-</span> <span class='fl'>1</span>, <span class='fu'>f</span>(<span class='fu'>g</span>(<span class='fl'>2</span> * <span class='no'>pi</span>)))
<span class='no'>is_new_name</span> <span class='kw'>&lt;-</span> <span class='kw'>function</span>(<span class='no'>x</span>) !<span class='fu'><a href='https://rdrr.io/r/base/exists.html'>exists</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/character.html'>as.character</a></span>(<span class='no'>x</span>), <span class='kw'>envir</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/environment.html'>baseenv</a></span>())
<span class='no'>expr_prune</span> <span class='kw'>&lt;-</span> <span class='fu'>rrapply</span>(<span class='no'>expr</span>,
  <span class='kw'>classes</span> <span class='kw'>=</span> <span class='st'>"name"</span>,
  <span class='kw'>condition</span> <span class='kw'>=</span> <span class='no'>is_new_name</span>,
  <span class='kw'>how</span> <span class='kw'>=</span> <span class='st'>"prune"</span>
)
<span class='fu'><a href='https://rdrr.io/r/utils/str.html'>str</a></span>(<span class='no'>expr_prune</span>)</div><div class='output co'>#&gt; List of 2
#&gt;  $ :List of 2
#&gt;   ..$ : symbol y
#&gt;   ..$ :List of 1
#&gt;   .. ..$ : symbol x
#&gt;  $ :List of 2
#&gt;   ..$ : symbol f
#&gt;   ..$ :List of 1
#&gt;   .. ..$ : symbol g</div><div class='input'>
<span class='co'>## Prune and flatten expression</span>
<span class='no'>expr_flatten</span> <span class='kw'>&lt;-</span> <span class='fu'>rrapply</span>(<span class='no'>expr</span>,
  <span class='kw'>classes</span> <span class='kw'>=</span> <span class='st'>"name"</span>,
  <span class='kw'>condition</span> <span class='kw'>=</span> <span class='no'>is_new_name</span>,
  <span class='kw'>how</span> <span class='kw'>=</span> <span class='st'>"flatten"</span>
)
<span class='fu'><a href='https://rdrr.io/r/utils/str.html'>str</a></span>(<span class='no'>expr_flatten</span>)</div><div class='output co'>#&gt; List of 4
#&gt;  $ : symbol y
#&gt;  $ : symbol x
#&gt;  $ : symbol f
#&gt;  $ : symbol g</div><div class='input'>
<span class='co'>## Prune and melt expression</span>
<span class='no'>expr_melt</span> <span class='kw'>&lt;-</span> <span class='fu'>rrapply</span>(<span class='no'>expr</span>,
  <span class='kw'>classes</span> <span class='kw'>=</span> <span class='st'>"name"</span>,
  <span class='kw'>condition</span> <span class='kw'>=</span> <span class='no'>is_new_name</span>,
  <span class='kw'>how</span> <span class='kw'>=</span> <span class='st'>"melt"</span>
)
<span class='no'>expr_melt</span></div><div class='output co'>#&gt;    L1  L2   L3 value
#&gt; 1 ..1 ..2 &lt;NA&gt;     y
#&gt; 2 ..1 ..3  ..2     x
#&gt; 3 ..2 ..1 &lt;NA&gt;     f
#&gt; 4 ..2 ..2  ..1     g</div><div class='input'>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Joris Chau.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>



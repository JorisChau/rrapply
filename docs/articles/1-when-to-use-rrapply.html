<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Efficient list recursion with rrapply • rrapply</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Efficient list recursion with rrapply">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">rrapply</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.2.8</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/1-when-to-use-rrapply.html">Efficient list recursion with rrapply</a></li>
    <li><a class="dropdown-item" href="../articles/2-efficient-melting-unnesting.html">Efficient list melting and unnesting with rrapply</a></li>
    <li><a class="dropdown-item" href="../articles/3-calls-and-expressions.html">Recursive apply for calls and expressions</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/JorisChau/rrapply/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Efficient list recursion with rrapply</h1>
                        <h4 data-toc-skip class="author">Joris Chau</h4>
            
            <h4 data-toc-skip class="date">Latest date: 2025-11-24</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/JorisChau/rrapply/blob/HEAD/vignettes/articles/1-when-to-use-rrapply.Rmd" class="external-link"><code>vignettes/articles/1-when-to-use-rrapply.Rmd</code></a></small>
      <div class="d-none name"><code>1-when-to-use-rrapply.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="list-recursion-in-r">List recursion in R<a class="anchor" aria-label="anchor" href="#list-recursion-in-r"></a>
</h2>
<p>The nested list below shows a small extract from the <a href="https://www.genealogy.math.ndsu.nodak.edu/" class="external-link">Mathematics Genealogy
Project</a> highlighting the advisor/student genealogy of several famous
mathematicians. The mathematician’s given names are present in the
<code>"given"</code> attribute of each list element. The numeric values
at the leaf elements are the total number of student descendants
according to the website as of June 2022. If no descendants are
available there is a missing value present at the leaf element.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">students</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  Bernoulli <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/structure.html" class="external-link">structure</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    Bernoulli <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/structure.html" class="external-link">structure</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      Bernoulli <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/structure.html" class="external-link">structure</a></span><span class="op">(</span><span class="fl">1L</span>, given <span class="op">=</span> <span class="st">"Daniel"</span><span class="op">)</span>,</span>
<span>      Euler <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/structure.html" class="external-link">structure</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        Euler <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/structure.html" class="external-link">structure</a></span><span class="op">(</span><span class="cn">NA</span>, given <span class="op">=</span> <span class="st">"Johann"</span><span class="op">)</span>,</span>
<span>        Lagrange <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/structure.html" class="external-link">structure</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>          Fourier <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/structure.html" class="external-link">structure</a></span><span class="op">(</span><span class="fl">73788L</span>, given <span class="op">=</span> <span class="st">"Jean-Baptiste"</span><span class="op">)</span>, </span>
<span>          Plana <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/structure.html" class="external-link">structure</a></span><span class="op">(</span><span class="cn">NA</span>, given <span class="op">=</span> <span class="st">"Giovanni"</span><span class="op">)</span>,</span>
<span>          Poisson <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/structure.html" class="external-link">structure</a></span><span class="op">(</span><span class="fl">128235L</span>, given <span class="op">=</span> <span class="st">"Simeon"</span><span class="op">)</span></span>
<span>        <span class="op">)</span>, given <span class="op">=</span> <span class="st">"Joseph"</span><span class="op">)</span></span>
<span>      <span class="op">)</span>, given <span class="op">=</span> <span class="st">"Leonhard"</span><span class="op">)</span></span>
<span>    <span class="op">)</span>, given <span class="op">=</span> <span class="st">"Johann"</span><span class="op">)</span>,</span>
<span>    Bernoulli <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/structure.html" class="external-link">structure</a></span><span class="op">(</span><span class="cn">NA</span>, given <span class="op">=</span> <span class="st">"Nikolaus"</span><span class="op">)</span></span>
<span>  <span class="op">)</span>, given <span class="op">=</span> <span class="st">"Jacob"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">students</span>, give.attr <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 1</span></span>
<span><span class="co">#&gt;  $ Bernoulli:List of 2</span></span>
<span><span class="co">#&gt;   ..$ Bernoulli:List of 2</span></span>
<span><span class="co">#&gt;   .. ..$ Bernoulli: int 1</span></span>
<span><span class="co">#&gt;   .. ..$ Euler    :List of 2</span></span>
<span><span class="co">#&gt;   .. .. ..$ Euler   : logi NA</span></span>
<span><span class="co">#&gt;   .. .. ..$ Lagrange:List of 3</span></span>
<span><span class="co">#&gt;   .. .. .. ..$ Fourier: int 73788</span></span>
<span><span class="co">#&gt;   .. .. .. ..$ Plana  : logi NA</span></span>
<span><span class="co">#&gt;   .. .. .. ..$ Poisson: int 128235</span></span>
<span><span class="co">#&gt;   ..$ Bernoulli: logi NA</span></span></code></pre></div>
<p>As an exercise in list recursion, consider the following simple data
exploration question:</p>
<blockquote>
<p>Filter all descendants of ‘Leonhard Euler’ and replace all missing
values by zero while maintaining the list structure.</p>
</blockquote>
<p>Here is a possible (not so efficient) base R solution using recursion
with the <code><a href="https://rdrr.io/r/base/Recall.html" class="external-link">Recall()</a></code> function:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">filter_desc_euler</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">i</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span>  <span class="kw">while</span><span class="op">(</span><span class="va">i</span> <span class="op">&lt;=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/identical.html" class="external-link">identical</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="st">"Euler"</span><span class="op">)</span> <span class="op">&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/identical.html" class="external-link">identical</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">x</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>, <span class="st">"given"</span><span class="op">)</span>, <span class="st">"Leonhard"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">x</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rapply.html" class="external-link">rapply</a></span><span class="op">(</span><span class="va">x</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>, f <span class="op">=</span> \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/replace.html" class="external-link">replace</a></span><span class="op">(</span><span class="va">x</span>, <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, <span class="fl">0</span><span class="op">)</span>, how <span class="op">=</span> <span class="st">"replace"</span><span class="op">)</span></span>
<span>      <span class="va">i</span> <span class="op">&lt;-</span> <span class="va">i</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>      <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">is.list</a></span><span class="op">(</span><span class="va">x</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">val</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Recall.html" class="external-link">Recall</a></span><span class="op">(</span><span class="va">x</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>        <span class="va">x</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">val</span></span>
<span>        <span class="va">i</span> <span class="op">&lt;-</span> <span class="va">i</span> <span class="op">+</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">val</span><span class="op">)</span></span>
<span>      <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>        <span class="va">x</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span>      <span class="op">}</span></span>
<span>      <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">is.null</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">x</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span>      <span class="op">}</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="fu">filter_desc_euler</span><span class="op">(</span><span class="va">students</span><span class="op">)</span>, give.attr <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 1</span></span>
<span><span class="co">#&gt;  $ Bernoulli:List of 1</span></span>
<span><span class="co">#&gt;   ..$ Bernoulli:List of 1</span></span>
<span><span class="co">#&gt;   .. ..$ Euler:List of 2</span></span>
<span><span class="co">#&gt;   .. .. ..$ Euler   : num 0</span></span>
<span><span class="co">#&gt;   .. .. ..$ Lagrange:List of 3</span></span>
<span><span class="co">#&gt;   .. .. .. ..$ Fourier: num 73788</span></span>
<span><span class="co">#&gt;   .. .. .. ..$ Plana  : num 0</span></span>
<span><span class="co">#&gt;   .. .. .. ..$ Poisson: num 128235</span></span></code></pre></div>
<p>This works, but is hardly the kind of convoluted code we would like
to write for such a seemingly simple question. Moreover, this code is
not very easy to follow, which can make updating or modifying it quite a
time-consuming and error-prone task.</p>
<p>An alternative approach would be to unnest the list into a more
manageable (e.g. rectangular) format or use specialized packages, such
as <a href="https://igraph.org/r/" class="external-link">igraph</a> or <a href="https://CRAN.R-project.org/package=data.tree" class="external-link">data.tree</a>, to
make pruning or modifying node entries more straightforward. Note that
attention must be paid to correctly include the node attributes in the
transformed object as the node names themselves are not unique in this
example. This is a sensible approach and usually the way to go when
cleaning or tidying up the data, but for fast prototyping and data
exploration tasks we may want to keep the list in its original format to
reduce the number of processing steps and minimize the code complexity.
Sometimes it is also required to maintain a nested data structure as
this can be for instance the expected input format for some data
visualization or data exporting function.</p>
<p>The recursive function above makes use of base <code><a href="https://rdrr.io/r/base/rapply.html" class="external-link">rapply()</a></code>,
a member of the <a href="https://rdrr.io/r/base/lapply.html" class="external-link">apply</a>-family of functions
in R, that allows to apply a function recursively to the elements of a
nested list and decide how the returned result is structured. Although
sometimes useful, the existing <code><a href="https://rdrr.io/r/base/rapply.html" class="external-link">rapply()</a></code> function is often
not sufficiently flexible for list recursion tasks in practice, for
instance for pruning elements of a nested list (as demonstrated above).
In this context, the <code><a href="../reference/rrapply.html">rrapply()</a></code> function in the minimal
<code>rrapply</code>-package attempts to enhance and update base
<code><a href="https://rdrr.io/r/base/rapply.html" class="external-link">rapply()</a></code> to make it more generally applicable for list
recursion in the wild. The <code><a href="../reference/rrapply.html">rrapply()</a></code> function builds upon
R’s native C implementation of<code><a href="https://rdrr.io/r/base/rapply.html" class="external-link">rapply()</a></code> and for this reason
requires no other external dependencies.</p>
</div>
<div class="section level2">
<h2 id="when-to-use-rrapply">When to use <code>rrapply()</code><a class="anchor" aria-label="anchor" href="#when-to-use-rrapply"></a>
</h2>
<p>For demonstrational purposes, we make use of the two datasets
<code>renewable_energy_by_country</code> and <code>pokedex</code>
included in the <code>rrapply</code>-package.
<code>renewable_energy_by_country</code> is a nested list containing the
renewable energy shares per country (% of total energy consumption) in
2016. The data is publicly available at the <a href="https://unstats-undesa.opendata.arcgis.com/datasets/" class="external-link">United
Nations Open SDG Data Hub</a>. The 249 countries and areas are
structured based on their geographical locations according to the <a href="https://unstats.un.org/unsd/methodology/m49/" class="external-link">United Nations M49
standard</a>. The numeric values listed for each country are
percentages, if no data is available the value of the country is
<code>NA</code>. <code>pokedex</code> is a nested list containing
various property values for each of the 151 original Pokémon available
(in .json) from <a href="https://github.com/Biuni/PokemonGO-Pokedex" class="external-link uri">https://github.com/Biuni/PokemonGO-Pokedex</a>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://jorischau.github.io/rrapply/">rrapply</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"renewable_energy_by_country"</span><span class="op">)</span></span></code></pre></div>
<p>For convenience, we subset only the values for countries and areas in
Oceania from <code>renewable_energy_by_country</code>,</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">renewable_oceania</span> <span class="op">&lt;-</span> <span class="va">renewable_energy_by_country</span><span class="op">[[</span><span class="st">"World"</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="st">"Oceania"</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">renewable_oceania</span>, list.len <span class="op">=</span> <span class="fl">3</span>, give.attr <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 1</span></span>
<span><span class="co">#&gt;  $ Oceania:List of 4</span></span>
<span><span class="co">#&gt;   ..$ Australia and New Zealand:List of 6</span></span>
<span><span class="co">#&gt;   .. ..$ Australia                        : num 9.32</span></span>
<span><span class="co">#&gt;   .. ..$ Christmas Island                 : logi NA</span></span>
<span><span class="co">#&gt;   .. ..$ Cocos (Keeling) Islands          : logi NA</span></span>
<span><span class="co">#&gt;   .. .. [list output truncated]</span></span>
<span><span class="co">#&gt;   ..$ Melanesia                :List of 5</span></span>
<span><span class="co">#&gt;   .. ..$ Fiji            : num 24.4</span></span>
<span><span class="co">#&gt;   .. ..$ New Caledonia   : num 4.03</span></span>
<span><span class="co">#&gt;   .. ..$ Papua New Guinea: num 50.3</span></span>
<span><span class="co">#&gt;   .. .. [list output truncated]</span></span>
<span><span class="co">#&gt;   ..$ Micronesia               :List of 8</span></span>
<span><span class="co">#&gt;   .. ..$ Guam                                : num 3.03</span></span>
<span><span class="co">#&gt;   .. ..$ Kiribati                            : num 45.4</span></span>
<span><span class="co">#&gt;   .. ..$ Marshall Islands                    : num 11.8</span></span>
<span><span class="co">#&gt;   .. .. [list output truncated]</span></span>
<span><span class="co">#&gt;   .. [list output truncated]</span></span></code></pre></div>
<div class="section level3">
<h3 id="list-pruning-and-unnesting">List pruning and unnesting<a class="anchor" aria-label="anchor" href="#list-pruning-and-unnesting"></a>
</h3>
<div class="section level4">
<h4 id="how-prune">
<code>how = "prune"</code><a class="anchor" aria-label="anchor" href="#how-prune"></a>
</h4>
<p>With base <code><a href="https://rdrr.io/r/base/rapply.html" class="external-link">rapply()</a></code>, there is no convenient way to prune
or filter elements from the input list. The <code><a href="../reference/rrapply.html">rrapply()</a></code>
function adds an option <code>how = "prune"</code> to prune all list
elements not subject to application of the function <code>f</code> from
a nested list. The original list structure is retained, similar to the
non-pruned versions <code>how = "replace"</code> and
<code>how = "list"</code>. Using <code>how = "prune"</code> and the same
syntax as in <code><a href="https://rdrr.io/r/base/rapply.html" class="external-link">rapply()</a></code>, we can easily drop all missing
values from the list while preserving the nested list structure:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## drop all logical NA's while preserving list structure </span></span>
<span><span class="fu"><a href="../reference/rrapply.html">rrapply</a></span><span class="op">(</span></span>
<span>  <span class="va">renewable_oceania</span>,</span>
<span>  f <span class="op">=</span> \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span>,  </span>
<span>  classes <span class="op">=</span> <span class="st">"numeric"</span>,</span>
<span>  how <span class="op">=</span> <span class="st">"prune"</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span>list.len <span class="op">=</span> <span class="fl">3</span>, give.attr <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 1</span></span>
<span><span class="co">#&gt;  $ Oceania:List of 4</span></span>
<span><span class="co">#&gt;   ..$ Australia and New Zealand:List of 2</span></span>
<span><span class="co">#&gt;   .. ..$ Australia  : num 9.32</span></span>
<span><span class="co">#&gt;   .. ..$ New Zealand: num 32.8</span></span>
<span><span class="co">#&gt;   ..$ Melanesia                :List of 5</span></span>
<span><span class="co">#&gt;   .. ..$ Fiji            : num 24.4</span></span>
<span><span class="co">#&gt;   .. ..$ New Caledonia   : num 4.03</span></span>
<span><span class="co">#&gt;   .. ..$ Papua New Guinea: num 50.3</span></span>
<span><span class="co">#&gt;   .. .. [list output truncated]</span></span>
<span><span class="co">#&gt;   ..$ Micronesia               :List of 7</span></span>
<span><span class="co">#&gt;   .. ..$ Guam                            : num 3.03</span></span>
<span><span class="co">#&gt;   .. ..$ Kiribati                        : num 45.4</span></span>
<span><span class="co">#&gt;   .. ..$ Marshall Islands                : num 11.8</span></span>
<span><span class="co">#&gt;   .. .. [list output truncated]</span></span>
<span><span class="co">#&gt;   .. [list output truncated]</span></span></code></pre></div>
<p><strong>Remark</strong>: if the <code>f</code> function is missing,
it defaults to the identity function. That is, the <code>f</code>
argument can be dropped when no (non-trivial) function is applied to the
list elements.</p>
</div>
<div class="section level4">
<h4 id="how-flatten">
<code>how = "flatten"</code><a class="anchor" aria-label="anchor" href="#how-flatten"></a>
</h4>
<p>Instead, we can set <code>how = "flatten"</code> to return a
<em>flattened</em> unnested version of the pruned list. This is more
efficient than first returning the pruned list with
<code>how = "prune"</code> and unlisting or flattening the list in a
subsequent step.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## drop all logical NA's and return unnested list</span></span>
<span><span class="fu"><a href="../reference/rrapply.html">rrapply</a></span><span class="op">(</span></span>
<span>  <span class="va">renewable_oceania</span>,</span>
<span>  classes <span class="op">=</span> <span class="st">"numeric"</span>,</span>
<span>  how <span class="op">=</span> <span class="st">"flatten"</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt;        Australia      New Zealand             Fiji    New Caledonia </span></span>
<span><span class="co">#&gt;             9.32            32.76            24.36             4.03 </span></span>
<span><span class="co">#&gt; Papua New Guinea  Solomon Islands          Vanuatu             Guam </span></span>
<span><span class="co">#&gt;            50.34            65.73            33.67             3.03 </span></span>
<span><span class="co">#&gt;         Kiribati Marshall Islands </span></span>
<span><span class="co">#&gt;            45.43            11.75</span></span></code></pre></div>
<p><strong>Hint</strong>: the <code>options</code> argument allows to
tune several options specific to certain choices of <code>how</code>.
With <code>how = "flatten"</code>, we can choose to not coerce the
flattened list to a vector and/or to include all parent list names in
the result similar to <code>how = "unlist"</code> but then with a custom
name separator.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## flatten to simple list with full names</span></span>
<span><span class="fu"><a href="../reference/rrapply.html">rrapply</a></span><span class="op">(</span></span>
<span>  <span class="va">renewable_oceania</span>,</span>
<span>  classes <span class="op">=</span> <span class="st">"numeric"</span>,</span>
<span>  how <span class="op">=</span> <span class="st">"flatten"</span>,</span>
<span>  options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>namesep <span class="op">=</span> <span class="st">"."</span>, simplify <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span>list.len <span class="op">=</span> <span class="fl">10</span>, give.attr <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 22</span></span>
<span><span class="co">#&gt;  $ Oceania.Australia and New Zealand.Australia        : num 9.32</span></span>
<span><span class="co">#&gt;  $ Oceania.Australia and New Zealand.New Zealand      : num 32.8</span></span>
<span><span class="co">#&gt;  $ Oceania.Melanesia.Fiji                             : num 24.4</span></span>
<span><span class="co">#&gt;  $ Oceania.Melanesia.New Caledonia                    : num 4.03</span></span>
<span><span class="co">#&gt;  $ Oceania.Melanesia.Papua New Guinea                 : num 50.3</span></span>
<span><span class="co">#&gt;  $ Oceania.Melanesia.Solomon Islands                  : num 65.7</span></span>
<span><span class="co">#&gt;  $ Oceania.Melanesia.Vanuatu                          : num 33.7</span></span>
<span><span class="co">#&gt;  $ Oceania.Micronesia.Guam                            : num 3.03</span></span>
<span><span class="co">#&gt;  $ Oceania.Micronesia.Kiribati                        : num 45.4</span></span>
<span><span class="co">#&gt;  $ Oceania.Micronesia.Marshall Islands                : num 11.8</span></span>
<span><span class="co">#&gt;   [list output truncated]</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="how-melt">
<code>how = "melt"</code><a class="anchor" aria-label="anchor" href="#how-melt"></a>
</h4>
<p>Using <code>how = "melt"</code>, we can return a melted data.frame of
the pruned list similar in format to <code><a href="https://rdrr.io/pkg/reshape2/man/melt.html" class="external-link">reshape2::melt()</a></code>
applied to a nested list. The rows of the melted data.frame contain the
parent node paths of the elements in the pruned list. The
<code>"value"</code> column contains the values of the terminal or leaf
nodes analogous to the flattened list returned by
<code>how = "flatten"</code>.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## drop all logical NA's and return melted data.frame</span></span>
<span><span class="va">oceania_melt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rrapply.html">rrapply</a></span><span class="op">(</span></span>
<span>  <span class="va">renewable_oceania</span>,</span>
<span>  classes <span class="op">=</span> <span class="st">"numeric"</span>,</span>
<span>  how <span class="op">=</span> <span class="st">"melt"</span></span>
<span><span class="op">)</span> </span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">oceania_melt</span>, n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt;         L1                        L2               L3 value</span></span>
<span><span class="co">#&gt; 1  Oceania Australia and New Zealand        Australia  9.32</span></span>
<span><span class="co">#&gt; 2  Oceania Australia and New Zealand      New Zealand 32.76</span></span>
<span><span class="co">#&gt; 3  Oceania                 Melanesia             Fiji 24.36</span></span>
<span><span class="co">#&gt; 4  Oceania                 Melanesia    New Caledonia  4.03</span></span>
<span><span class="co">#&gt; 5  Oceania                 Melanesia Papua New Guinea 50.34</span></span>
<span><span class="co">#&gt; 6  Oceania                 Melanesia  Solomon Islands 65.73</span></span>
<span><span class="co">#&gt; 7  Oceania                 Melanesia          Vanuatu 33.67</span></span>
<span><span class="co">#&gt; 8  Oceania                Micronesia             Guam  3.03</span></span>
<span><span class="co">#&gt; 9  Oceania                Micronesia         Kiribati 45.43</span></span>
<span><span class="co">#&gt; 10 Oceania                Micronesia Marshall Islands 11.75</span></span></code></pre></div>
<p><strong>Remark</strong>: if no names are present in a certain sublist
of the input list, <code>how = "melt"</code> replaces the names in the
melted data.frame by list element indices <code>"1"</code>,
<code>"2"</code>, etc.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## drop some area names </span></span>
<span><span class="va">renewable_oceania1</span> <span class="op">&lt;-</span> <span class="va">renewable_oceania</span></span>
<span><span class="va">renewable_oceania1</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unname.html" class="external-link">unname</a></span><span class="op">(</span><span class="va">renewable_oceania</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## drop all logical NA's and return melted data.frame</span></span>
<span><span class="fu"><a href="../reference/rrapply.html">rrapply</a></span><span class="op">(</span></span>
<span>  <span class="va">renewable_oceania1</span>,</span>
<span>  classes <span class="op">=</span> <span class="st">"numeric"</span>,</span>
<span>  how <span class="op">=</span> <span class="st">"melt"</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt;         L1 L2               L3 value</span></span>
<span><span class="co">#&gt; 1  Oceania  1        Australia  9.32</span></span>
<span><span class="co">#&gt; 2  Oceania  1      New Zealand 32.76</span></span>
<span><span class="co">#&gt; 3  Oceania  2             Fiji 24.36</span></span>
<span><span class="co">#&gt; 4  Oceania  2    New Caledonia  4.03</span></span>
<span><span class="co">#&gt; 5  Oceania  2 Papua New Guinea 50.34</span></span>
<span><span class="co">#&gt; 6  Oceania  2  Solomon Islands 65.73</span></span>
<span><span class="co">#&gt; 7  Oceania  2          Vanuatu 33.67</span></span>
<span><span class="co">#&gt; 8  Oceania  3             Guam  3.03</span></span>
<span><span class="co">#&gt; 9  Oceania  3         Kiribati 45.43</span></span>
<span><span class="co">#&gt; 10 Oceania  3 Marshall Islands 11.75</span></span></code></pre></div>
<p>A melted data.frame can be used to reconstruct a nested list with
<code>how = "unmelt"</code>. No skeleton object as e.g. required by
<code><a href="https://rdrr.io/r/utils/relist.html" class="external-link">relist()</a></code> is needed, only an ordinary data.frame in the
format returned by <code>how = "melt"</code>. This option can be
convenient to construct nested lists from a rectangular data.frame
format without having to resort to recursive function definitions.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## reconstruct nested list from melted data.frame</span></span>
<span><span class="fu"><a href="../reference/rrapply.html">rrapply</a></span><span class="op">(</span><span class="va">oceania_melt</span>, how <span class="op">=</span> <span class="st">"unmelt"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span>list.len <span class="op">=</span> <span class="fl">3</span>, give.attr <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 1</span></span>
<span><span class="co">#&gt;  $ Oceania:List of 4</span></span>
<span><span class="co">#&gt;   ..$ Australia and New Zealand:List of 2</span></span>
<span><span class="co">#&gt;   .. ..$ Australia  : num 9.32</span></span>
<span><span class="co">#&gt;   .. ..$ New Zealand: num 32.8</span></span>
<span><span class="co">#&gt;   ..$ Melanesia                :List of 5</span></span>
<span><span class="co">#&gt;   .. ..$ Fiji            : num 24.4</span></span>
<span><span class="co">#&gt;   .. ..$ New Caledonia   : num 4.03</span></span>
<span><span class="co">#&gt;   .. ..$ Papua New Guinea: num 50.3</span></span>
<span><span class="co">#&gt;   .. .. [list output truncated]</span></span>
<span><span class="co">#&gt;   ..$ Micronesia               :List of 7</span></span>
<span><span class="co">#&gt;   .. ..$ Guam                            : num 3.03</span></span>
<span><span class="co">#&gt;   .. ..$ Kiribati                        : num 45.4</span></span>
<span><span class="co">#&gt;   .. ..$ Marshall Islands                : num 11.8</span></span>
<span><span class="co">#&gt;   .. .. [list output truncated]</span></span>
<span><span class="co">#&gt;   .. [list output truncated]</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="how-bind">
<code>how = "bind"</code><a class="anchor" aria-label="anchor" href="#how-bind"></a>
</h4>
<p>Nested lists containing repeated observations can be unnested with
<code>how = "bind"</code>. Each repeated sublist is expanded as a single
row in a wide data.frame and identical sublist component names are
aligned as individual columns. By default, the list layer containing the
repeated observations is identified by the minimal depth detected across
leaf elements, but this can also be overridden using the
<code>coldepth</code> option in the <code>options</code> argument. Note
that the returned data.frame is similar in format to repeated
application of <code><a href="https://tidyr.tidyverse.org/reference/unnest_wider.html" class="external-link">tidyr::unnest_wider()</a></code> to a nested
data.frame, with the same coercion rules applied to the individual
columns as `how = “unlist”.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"pokedex"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">pokedex</span>, list.len <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 1</span></span>
<span><span class="co">#&gt;  $ pokemon:List of 151</span></span>
<span><span class="co">#&gt;   ..$ :List of 16</span></span>
<span><span class="co">#&gt;   .. ..$ id            : int 1</span></span>
<span><span class="co">#&gt;   .. ..$ num           : chr "001"</span></span>
<span><span class="co">#&gt;   .. ..$ name          : chr "Bulbasaur"</span></span>
<span><span class="co">#&gt;   .. .. [list output truncated]</span></span>
<span><span class="co">#&gt;   ..$ :List of 17</span></span>
<span><span class="co">#&gt;   .. ..$ id            : int 2</span></span>
<span><span class="co">#&gt;   .. ..$ num           : chr "002"</span></span>
<span><span class="co">#&gt;   .. ..$ name          : chr "Ivysaur"</span></span>
<span><span class="co">#&gt;   .. .. [list output truncated]</span></span>
<span><span class="co">#&gt;   ..$ :List of 15</span></span>
<span><span class="co">#&gt;   .. ..$ id            : int 3</span></span>
<span><span class="co">#&gt;   .. ..$ num           : chr "003"</span></span>
<span><span class="co">#&gt;   .. ..$ name          : chr "Venusaur"</span></span>
<span><span class="co">#&gt;   .. .. [list output truncated]</span></span>
<span><span class="co">#&gt;   .. [list output truncated]</span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## unnest list to wide data.frame</span></span>
<span><span class="fu"><a href="../reference/rrapply.html">rrapply</a></span><span class="op">(</span><span class="va">pokedex</span>, how <span class="op">=</span> <span class="st">"bind"</span><span class="op">)</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="fl">5</span><span class="op">:</span><span class="fl">8</span><span class="op">)</span><span class="op">]</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt;    id num       name          type height   weight            candy</span></span>
<span><span class="co">#&gt; 1   1 001  Bulbasaur Grass, Poison 0.71 m   6.9 kg  Bulbasaur Candy</span></span>
<span><span class="co">#&gt; 2   2 002    Ivysaur Grass, Poison 0.99 m  13.0 kg  Bulbasaur Candy</span></span>
<span><span class="co">#&gt; 3   3 003   Venusaur Grass, Poison 2.01 m 100.0 kg  Bulbasaur Candy</span></span>
<span><span class="co">#&gt; 4   4 004 Charmander          Fire 0.61 m   8.5 kg Charmander Candy</span></span>
<span><span class="co">#&gt; 5   5 005 Charmeleon          Fire 1.09 m  19.0 kg Charmander Candy</span></span>
<span><span class="co">#&gt; 6   6 006  Charizard  Fire, Flying 1.70 m  90.5 kg Charmander Candy</span></span>
<span><span class="co">#&gt; 7   7 007   Squirtle         Water 0.51 m   9.0 kg   Squirtle Candy</span></span>
<span><span class="co">#&gt; 8   8 008  Wartortle         Water 0.99 m  22.5 kg   Squirtle Candy</span></span>
<span><span class="co">#&gt; 9   9 009  Blastoise         Water 1.60 m  85.5 kg   Squirtle Candy</span></span>
<span><span class="co">#&gt; 10 10 010   Caterpie           Bug 0.30 m   2.9 kg   Caterpie Candy</span></span></code></pre></div>
<p><strong>Hint</strong>: setting <code>namecols = TRUE</code> in the
<code>options</code> argument includes the parent list names associated
to each row in the wide data.frame as individual columns
<code>L1</code>, <code>L2</code>, etc.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## bind to data.frame including parent columns</span></span>
<span><span class="va">pokemon_evolutions</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rrapply.html">rrapply</a></span><span class="op">(</span></span>
<span>  <span class="va">pokedex</span>, </span>
<span>  how <span class="op">=</span> <span class="st">"bind"</span>, </span>
<span>  options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>namecols <span class="op">=</span> <span class="cn">TRUE</span>, coldepth <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="op">)</span> </span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">pokemon_evolutions</span>, n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt;         L1 L2             L3 L4 num       name</span></span>
<span><span class="co">#&gt; 1  pokemon  1 next_evolution  1 002    Ivysaur</span></span>
<span><span class="co">#&gt; 2  pokemon  1 next_evolution  2 003   Venusaur</span></span>
<span><span class="co">#&gt; 3  pokemon  2 prev_evolution  1 001  Bulbasaur</span></span>
<span><span class="co">#&gt; 4  pokemon  2 next_evolution  1 003   Venusaur</span></span>
<span><span class="co">#&gt; 5  pokemon  3 prev_evolution  1 001  Bulbasaur</span></span>
<span><span class="co">#&gt; 6  pokemon  3 prev_evolution  2 002    Ivysaur</span></span>
<span><span class="co">#&gt; 7  pokemon  4 next_evolution  1 005 Charmeleon</span></span>
<span><span class="co">#&gt; 8  pokemon  4 next_evolution  2 006  Charizard</span></span>
<span><span class="co">#&gt; 9  pokemon  5 prev_evolution  1 004 Charmander</span></span>
<span><span class="co">#&gt; 10 pokemon  5 next_evolution  1 006  Charizard</span></span></code></pre></div>
<p>This can be useful to unnest repeated list elements at multiple
nested list levels and join the results into a single data.frame:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## merge pokemon evolutions with pokemon names</span></span>
<span><span class="fu"><a href="../reference/rrapply.html">rrapply</a></span><span class="op">(</span></span>
<span>  <span class="va">pokedex</span>,</span>
<span>  how <span class="op">=</span> <span class="st">"bind"</span>,</span>
<span>  options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>namecols <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="op">)</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"L1"</span>, <span class="st">"L2"</span>, <span class="st">"name"</span><span class="op">)</span><span class="op">]</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span></span>
<span>    <span class="va">pokemon_evolutions</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"L1"</span>, <span class="st">"L2"</span>, <span class="st">"L3"</span>, <span class="st">"name"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>    by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"L1"</span>, <span class="st">"L2"</span><span class="op">)</span>,</span>
<span>    suffixes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">""</span>, <span class="st">".evolution"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt;         L1  L2      name             L3 name.evolution</span></span>
<span><span class="co">#&gt; 1  pokemon   1 Bulbasaur next_evolution        Ivysaur</span></span>
<span><span class="co">#&gt; 2  pokemon   1 Bulbasaur next_evolution       Venusaur</span></span>
<span><span class="co">#&gt; 3  pokemon  10  Caterpie next_evolution        Metapod</span></span>
<span><span class="co">#&gt; 4  pokemon  10  Caterpie next_evolution     Butterfree</span></span>
<span><span class="co">#&gt; 5  pokemon 100   Voltorb next_evolution      Electrode</span></span>
<span><span class="co">#&gt; 6  pokemon 101 Electrode prev_evolution        Voltorb</span></span>
<span><span class="co">#&gt; 7  pokemon 102 Exeggcute next_evolution      Exeggutor</span></span>
<span><span class="co">#&gt; 8  pokemon 103 Exeggutor prev_evolution      Exeggcute</span></span>
<span><span class="co">#&gt; 9  pokemon 104    Cubone next_evolution        Marowak</span></span>
<span><span class="co">#&gt; 10 pokemon 105   Marowak prev_evolution         Cubone</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="condition-function">Condition function<a class="anchor" aria-label="anchor" href="#condition-function"></a>
</h3>
<p>Base <code><a href="https://rdrr.io/r/base/rapply.html" class="external-link">rapply()</a></code> allows to apply a function <code>f</code>
to list elements of certain types or classes via the
<code>classes</code> argument. <code><a href="../reference/rrapply.html">rrapply()</a></code> generalizes this
concept via an additional <code>condition</code> argument, which accepts
any function to use as a condition or predicate to apply <code>f</code>
to a subset of list elements. Conceptually, the <code>f</code> function
is applied to all leaf elements for which the <code>condition</code>
function exactly evaluates to <code>TRUE</code> similar to
<code><a href="https://rdrr.io/r/base/Logic.html" class="external-link">isTRUE()</a></code>. If the <code>condition</code> argument is
missing, <code>f</code> is applied to all leaf elements. In combination
with <code>how = "prune"</code>, the <code>condition</code> function
provides additional flexibility in selecting and filtering elements from
a nested list,</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## drop all NA's using condition function</span></span>
<span><span class="fu"><a href="../reference/rrapply.html">rrapply</a></span><span class="op">(</span></span>
<span>  <span class="va">renewable_oceania</span>,</span>
<span>  condition <span class="op">=</span> \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>  how <span class="op">=</span> <span class="st">"prune"</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span>list.len <span class="op">=</span> <span class="fl">3</span>, give.attr <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 1</span></span>
<span><span class="co">#&gt;  $ Oceania:List of 4</span></span>
<span><span class="co">#&gt;   ..$ Australia and New Zealand:List of 2</span></span>
<span><span class="co">#&gt;   .. ..$ Australia  : num 9.32</span></span>
<span><span class="co">#&gt;   .. ..$ New Zealand: num 32.8</span></span>
<span><span class="co">#&gt;   ..$ Melanesia                :List of 5</span></span>
<span><span class="co">#&gt;   .. ..$ Fiji            : num 24.4</span></span>
<span><span class="co">#&gt;   .. ..$ New Caledonia   : num 4.03</span></span>
<span><span class="co">#&gt;   .. ..$ Papua New Guinea: num 50.3</span></span>
<span><span class="co">#&gt;   .. .. [list output truncated]</span></span>
<span><span class="co">#&gt;   ..$ Micronesia               :List of 7</span></span>
<span><span class="co">#&gt;   .. ..$ Guam                            : num 3.03</span></span>
<span><span class="co">#&gt;   .. ..$ Kiribati                        : num 45.4</span></span>
<span><span class="co">#&gt;   .. ..$ Marshall Islands                : num 11.8</span></span>
<span><span class="co">#&gt;   .. .. [list output truncated]</span></span>
<span><span class="co">#&gt;   .. [list output truncated]</span></span></code></pre></div>
<p>More interesting is to consider a <code>condition</code> that cannot
also be defined using the <code>classes</code> argument. For instance,
we can filter all countries with values that satisfy a certain numeric
condition:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## filter all countries with values above 85%</span></span>
<span><span class="fu"><a href="../reference/rrapply.html">rrapply</a></span><span class="op">(</span></span>
<span>  <span class="va">renewable_energy_by_country</span>, </span>
<span>  condition <span class="op">=</span> \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span> <span class="op">&gt;</span> <span class="fl">85</span>, </span>
<span>  how <span class="op">=</span> <span class="st">"prune"</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span>give.attr <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 1</span></span>
<span><span class="co">#&gt;  $ World:List of 1</span></span>
<span><span class="co">#&gt;   ..$ Africa:List of 1</span></span>
<span><span class="co">#&gt;   .. ..$ Sub-Saharan Africa:List of 3</span></span>
<span><span class="co">#&gt;   .. .. ..$ Eastern Africa:List of 7</span></span>
<span><span class="co">#&gt;   .. .. .. ..$ Burundi                    : num 89.2</span></span>
<span><span class="co">#&gt;   .. .. .. ..$ Ethiopia                   : num 91.9</span></span>
<span><span class="co">#&gt;   .. .. .. ..$ Rwanda                     : num 86</span></span>
<span><span class="co">#&gt;   .. .. .. ..$ Somalia                    : num 94.7</span></span>
<span><span class="co">#&gt;   .. .. .. ..$ Uganda                     : num 88.6</span></span>
<span><span class="co">#&gt;   .. .. .. ..$ United Republic of Tanzania: num 86.1</span></span>
<span><span class="co">#&gt;   .. .. .. ..$ Zambia                     : num 88.5</span></span>
<span><span class="co">#&gt;   .. .. ..$ Middle Africa :List of 2</span></span>
<span><span class="co">#&gt;   .. .. .. ..$ Chad                            : num 85.3</span></span>
<span><span class="co">#&gt;   .. .. .. ..$ Democratic Republic of the Congo: num 97</span></span>
<span><span class="co">#&gt;   .. .. ..$ Western Africa:List of 1</span></span>
<span><span class="co">#&gt;   .. .. .. ..$ Guinea-Bissau: num 86.5</span></span>
<span></span>
<span><span class="co">## or by passing arguments to condition via ...</span></span>
<span><span class="fu"><a href="../reference/rrapply.html">rrapply</a></span><span class="op">(</span></span>
<span>  <span class="va">renewable_energy_by_country</span>, </span>
<span>  condition <span class="op">=</span> <span class="st">"=="</span>, </span>
<span>  e2 <span class="op">=</span> <span class="fl">0</span>, </span>
<span>  how <span class="op">=</span> <span class="st">"prune"</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span>give.attr <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 1</span></span>
<span><span class="co">#&gt;  $ World:List of 4</span></span>
<span><span class="co">#&gt;   ..$ Americas:List of 1</span></span>
<span><span class="co">#&gt;   .. ..$ Latin America and the Caribbean:List of 1</span></span>
<span><span class="co">#&gt;   .. .. ..$ Caribbean:List of 1</span></span>
<span><span class="co">#&gt;   .. .. .. ..$ Antigua and Barbuda: num 0</span></span>
<span><span class="co">#&gt;   ..$ Asia    :List of 1</span></span>
<span><span class="co">#&gt;   .. ..$ Western Asia:List of 4</span></span>
<span><span class="co">#&gt;   .. .. ..$ Bahrain: num 0</span></span>
<span><span class="co">#&gt;   .. .. ..$ Kuwait : num 0</span></span>
<span><span class="co">#&gt;   .. .. ..$ Oman   : num 0</span></span>
<span><span class="co">#&gt;   .. .. ..$ Qatar  : num 0</span></span>
<span><span class="co">#&gt;   ..$ Europe  :List of 2</span></span>
<span><span class="co">#&gt;   .. ..$ Northern Europe:List of 1</span></span>
<span><span class="co">#&gt;   .. .. ..$ Channel Islands:List of 1</span></span>
<span><span class="co">#&gt;   .. .. .. ..$ Guernsey: num 0</span></span>
<span><span class="co">#&gt;   .. ..$ Southern Europe:List of 1</span></span>
<span><span class="co">#&gt;   .. .. ..$ Gibraltar: num 0</span></span>
<span><span class="co">#&gt;   ..$ Oceania :List of 2</span></span>
<span><span class="co">#&gt;   .. ..$ Micronesia:List of 1</span></span>
<span><span class="co">#&gt;   .. .. ..$ Northern Mariana Islands: num 0</span></span>
<span><span class="co">#&gt;   .. ..$ Polynesia :List of 1</span></span>
<span><span class="co">#&gt;   .. .. ..$ Wallis and Futuna Islands: num 0</span></span></code></pre></div>
<p>Note that the <code>NA</code> elements are not returned, as the
<code>condition</code> function does not evaluate to <code>TRUE</code>
for <code>NA</code> values.</p>
<p>As the <code>condition</code> function is a generalization of the
<code>classes</code> argument, it remains possible to use
<code>deflt</code> together with <code>how = "list"</code> or
<code>how = "unlist"</code> to set a default value to all leaf elements
for which the <code>condition</code> is not <code>TRUE</code>:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## replace all NA elements by zero</span></span>
<span><span class="fu"><a href="../reference/rrapply.html">rrapply</a></span><span class="op">(</span></span>
<span>  <span class="va">renewable_oceania</span>, </span>
<span>  condition <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/funprog.html" class="external-link">Negate</a></span><span class="op">(</span><span class="va">is.na</span><span class="op">)</span>, </span>
<span>  deflt <span class="op">=</span> <span class="fl">0</span>, </span>
<span>  how <span class="op">=</span> <span class="st">"list"</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span>list.len <span class="op">=</span> <span class="fl">3</span>, give.attr <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 1</span></span>
<span><span class="co">#&gt;  $ Oceania:List of 4</span></span>
<span><span class="co">#&gt;   ..$ Australia and New Zealand:List of 6</span></span>
<span><span class="co">#&gt;   .. ..$ Australia                        : num 9.32</span></span>
<span><span class="co">#&gt;   .. ..$ Christmas Island                 : num 0</span></span>
<span><span class="co">#&gt;   .. ..$ Cocos (Keeling) Islands          : num 0</span></span>
<span><span class="co">#&gt;   .. .. [list output truncated]</span></span>
<span><span class="co">#&gt;   ..$ Melanesia                :List of 5</span></span>
<span><span class="co">#&gt;   .. ..$ Fiji            : num 24.4</span></span>
<span><span class="co">#&gt;   .. ..$ New Caledonia   : num 4.03</span></span>
<span><span class="co">#&gt;   .. ..$ Papua New Guinea: num 50.3</span></span>
<span><span class="co">#&gt;   .. .. [list output truncated]</span></span>
<span><span class="co">#&gt;   ..$ Micronesia               :List of 8</span></span>
<span><span class="co">#&gt;   .. ..$ Guam                                : num 3.03</span></span>
<span><span class="co">#&gt;   .. ..$ Kiribati                            : num 45.4</span></span>
<span><span class="co">#&gt;   .. ..$ Marshall Islands                    : num 11.8</span></span>
<span><span class="co">#&gt;   .. .. [list output truncated]</span></span>
<span><span class="co">#&gt;   .. [list output truncated]</span></span></code></pre></div>
<p>To be consistent with base <code><a href="https://rdrr.io/r/base/rapply.html" class="external-link">rapply()</a></code>, the
<code>deflt</code> argument can still only be used in combination with
<code>how = "list"</code> or <code>how = "unlist"</code>.</p>
<div class="section level4">
<h4 id="using-the-----argument">Using the <code>...</code> argument<a class="anchor" aria-label="anchor" href="#using-the-----argument"></a>
</h4>
<p>The first argument to <code>f</code> always evaluates to the content
of the list element to which <code>f</code> is applied. Any further
arguments, (besides the special arguments <code>.xname</code>,
<code>.xpos</code>, <code>.xparents</code> and <code>.xsiblings</code>
discussed below), that are independent of the list content can be
supplied via the <code>...</code> argument. Since <code><a href="../reference/rrapply.html">rrapply()</a></code>
accepts a function in two of its arguments <code>f</code> and
<code>condition</code>, any arguments defined via the <code>...</code>
need to be defined as function arguments in <em>both</em> the
<code>f</code> and <code>condition</code> functions (if existing), even
if they are not used in the function itself.</p>
<p>To clarify, consider the following example which replaces all missing
values by a value defined in a separate argument
<code>newvalue</code>:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## this is not ok!</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/rrapply.html">rrapply</a></span><span class="op">(</span></span>
<span>    <span class="va">renewable_oceania</span>, </span>
<span>    condition <span class="op">=</span> <span class="va">is.na</span>, </span>
<span>    f <span class="op">=</span> \<span class="op">(</span><span class="va">x</span>, <span class="va">newvalue</span><span class="op">)</span> <span class="va">newvalue</span>, </span>
<span>    newvalue <span class="op">=</span> <span class="fl">0</span>, </span>
<span>    how <span class="op">=</span> <span class="st">"replace"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span>, error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">error</span><span class="op">)</span> <span class="va">error</span><span class="op">$</span><span class="va">message</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "2 arguments passed to 'is.na' which requires 1"</span></span>
<span></span>
<span><span class="co">## this is ok</span></span>
<span><span class="fu"><a href="../reference/rrapply.html">rrapply</a></span><span class="op">(</span></span>
<span>  <span class="va">renewable_oceania</span>, </span>
<span>  condition <span class="op">=</span> \<span class="op">(</span><span class="va">x</span>, <span class="va">newvalue</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, </span>
<span>  f <span class="op">=</span> \<span class="op">(</span><span class="va">x</span>, <span class="va">newvalue</span><span class="op">)</span> <span class="va">newvalue</span>, </span>
<span>  newvalue <span class="op">=</span> <span class="fl">0</span>, </span>
<span>  how <span class="op">=</span> <span class="st">"replace"</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span>list.len <span class="op">=</span> <span class="fl">3</span>, give.attr <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 1</span></span>
<span><span class="co">#&gt;  $ Oceania:List of 4</span></span>
<span><span class="co">#&gt;   ..$ Australia and New Zealand:List of 6</span></span>
<span><span class="co">#&gt;   .. ..$ Australia                        : num 9.32</span></span>
<span><span class="co">#&gt;   .. ..$ Christmas Island                 : num 0</span></span>
<span><span class="co">#&gt;   .. ..$ Cocos (Keeling) Islands          : num 0</span></span>
<span><span class="co">#&gt;   .. .. [list output truncated]</span></span>
<span><span class="co">#&gt;   ..$ Melanesia                :List of 5</span></span>
<span><span class="co">#&gt;   .. ..$ Fiji            : num 24.4</span></span>
<span><span class="co">#&gt;   .. ..$ New Caledonia   : num 4.03</span></span>
<span><span class="co">#&gt;   .. ..$ Papua New Guinea: num 50.3</span></span>
<span><span class="co">#&gt;   .. .. [list output truncated]</span></span>
<span><span class="co">#&gt;   ..$ Micronesia               :List of 8</span></span>
<span><span class="co">#&gt;   .. ..$ Guam                                : num 3.03</span></span>
<span><span class="co">#&gt;   .. ..$ Kiribati                            : num 45.4</span></span>
<span><span class="co">#&gt;   .. ..$ Marshall Islands                    : num 11.8</span></span>
<span><span class="co">#&gt;   .. .. [list output truncated]</span></span>
<span><span class="co">#&gt;   .. [list output truncated]</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="special-arguments--xname--xpos--xparents--xsiblings">Special arguments <code>.xname</code>, <code>.xpos</code>,
<code>.xparents</code>, <code>.xsiblings</code><a class="anchor" aria-label="anchor" href="#special-arguments--xname--xpos--xparents--xsiblings"></a>
</h3>
<p>With base <code><a href="https://rdrr.io/r/base/rapply.html" class="external-link">rapply()</a></code>, the <code>f</code> function only has
access to the <em>content</em> of the list element under evaluation, and
there is no convenient way to access its name or location in the nested
list from inside the <code>f</code> function. To overcome this
limitation, <code><a href="../reference/rrapply.html">rrapply()</a></code> defines the special arguments
<code>.xname</code>, <code>.xpos</code>, <code>.xparents</code> and
<code>.xsiblings</code> inside the <code>f</code> and
<code>condition</code> functions (in addition to the principal function
argument):</p>
<ul>
<li>
<code>.xname</code> evaluates to the name of the list element;</li>
<li>
<code>.xpos</code> evaluates to the position of the element in the
nested list structured as an integer vector;</li>
<li>
<code>.xparents</code> evaluates to a vector of parent list names in
the path to the current list element;</li>
<li>
<code>.xsiblings</code> evaluates to the parent list containing the
current list element and its direct siblings.</li>
</ul>
<p>Using the <code>.xname</code> and <code>.xpos</code> arguments, we
can transform or filter list elements based on their names and/or
positions in the nested list:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## apply f based on element's name</span></span>
<span><span class="fu"><a href="../reference/rrapply.html">rrapply</a></span><span class="op">(</span></span>
<span>  <span class="va">renewable_oceania</span>,</span>
<span>  condition <span class="op">=</span> \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>  f <span class="op">=</span> \<span class="op">(</span><span class="va">x</span>, <span class="va">.xname</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Renewable energy in %s: %.2f%%"</span>, <span class="va">.xname</span>, <span class="va">x</span><span class="op">)</span>,</span>
<span>  how <span class="op">=</span> <span class="st">"flatten"</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="co">#&gt;                                      Australia </span></span>
<span><span class="co">#&gt;         "Renewable energy in Australia: 9.32%" </span></span>
<span><span class="co">#&gt;                                    New Zealand </span></span>
<span><span class="co">#&gt;      "Renewable energy in New Zealand: 32.76%" </span></span>
<span><span class="co">#&gt;                                           Fiji </span></span>
<span><span class="co">#&gt;             "Renewable energy in Fiji: 24.36%" </span></span>
<span><span class="co">#&gt;                                  New Caledonia </span></span>
<span><span class="co">#&gt;     "Renewable energy in New Caledonia: 4.03%" </span></span>
<span><span class="co">#&gt;                               Papua New Guinea </span></span>
<span><span class="co">#&gt; "Renewable energy in Papua New Guinea: 50.34%"</span></span>
<span></span>
<span><span class="co">## filter elements by name</span></span>
<span><span class="fu"><a href="../reference/rrapply.html">rrapply</a></span><span class="op">(</span></span>
<span>  <span class="va">renewable_energy_by_country</span>,</span>
<span>  condition <span class="op">=</span> \<span class="op">(</span><span class="va">x</span>, <span class="va">.xname</span><span class="op">)</span> <span class="va">.xname</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Belgium"</span>, <span class="st">"Netherlands"</span>, <span class="st">"Luxembourg"</span><span class="op">)</span>,</span>
<span>  how <span class="op">=</span> <span class="st">"prune"</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span>give.attr <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 1</span></span>
<span><span class="co">#&gt;  $ World:List of 1</span></span>
<span><span class="co">#&gt;   ..$ Europe:List of 1</span></span>
<span><span class="co">#&gt;   .. ..$ Western Europe:List of 3</span></span>
<span><span class="co">#&gt;   .. .. ..$ Belgium    : num 9.14</span></span>
<span><span class="co">#&gt;   .. .. ..$ Luxembourg : num 13.5</span></span>
<span><span class="co">#&gt;   .. .. ..$ Netherlands: num 5.78</span></span></code></pre></div>
<p>Knowing that Europe is located at
<code>renewable_energy_by_country[[c(1, 5)]]</code>, we can filter all
European countries with a renewable energy share above 50% using the
<code>.xpos</code> argument as follows,</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## filter European countries &gt; 50% using .xpos</span></span>
<span><span class="fu"><a href="../reference/rrapply.html">rrapply</a></span><span class="op">(</span></span>
<span>  <span class="va">renewable_energy_by_country</span>,</span>
<span>  condition <span class="op">=</span> \<span class="op">(</span><span class="va">x</span>, <span class="va">.xpos</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/identical.html" class="external-link">identical</a></span><span class="op">(</span><span class="va">.xpos</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1L</span>, <span class="fl">5L</span><span class="op">)</span><span class="op">)</span> <span class="op">&amp;&amp;</span> <span class="va">x</span> <span class="op">&gt;</span> <span class="fl">50</span>,</span>
<span>  how <span class="op">=</span> <span class="st">"prune"</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span>give.attr <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 1</span></span>
<span><span class="co">#&gt;  $ World:List of 1</span></span>
<span><span class="co">#&gt;   ..$ Europe:List of 2</span></span>
<span><span class="co">#&gt;   .. ..$ Northern Europe:List of 3</span></span>
<span><span class="co">#&gt;   .. .. ..$ Iceland: num 78.1</span></span>
<span><span class="co">#&gt;   .. .. ..$ Norway : num 59.5</span></span>
<span><span class="co">#&gt;   .. .. ..$ Sweden : num 51.4</span></span>
<span><span class="co">#&gt;   .. ..$ Western Europe :List of 1</span></span>
<span><span class="co">#&gt;   .. .. ..$ Liechtenstein: num 62.9</span></span></code></pre></div>
<p>This can be done more conveniently using the <code>.xparents</code>
argument, which this does not require looking up the location of Europe
in the nested list,</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## filter European countries &gt; 50% using .xparents</span></span>
<span><span class="fu"><a href="../reference/rrapply.html">rrapply</a></span><span class="op">(</span></span>
<span>  <span class="va">renewable_energy_by_country</span>,</span>
<span>  condition <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">.xparents</span><span class="op">)</span> <span class="st">"Europe"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">.xparents</span> <span class="op">&amp;&amp;</span> <span class="va">x</span> <span class="op">&gt;</span> <span class="fl">50</span>,</span>
<span>  how <span class="op">=</span> <span class="st">"prune"</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span>give.attr <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 1</span></span>
<span><span class="co">#&gt;  $ World:List of 1</span></span>
<span><span class="co">#&gt;   ..$ Europe:List of 2</span></span>
<span><span class="co">#&gt;   .. ..$ Northern Europe:List of 3</span></span>
<span><span class="co">#&gt;   .. .. ..$ Iceland: num 78.1</span></span>
<span><span class="co">#&gt;   .. .. ..$ Norway : num 59.5</span></span>
<span><span class="co">#&gt;   .. .. ..$ Sweden : num 51.4</span></span>
<span><span class="co">#&gt;   .. ..$ Western Europe :List of 1</span></span>
<span><span class="co">#&gt;   .. .. ..$ Liechtenstein: num 62.9</span></span></code></pre></div>
<p>Using the <code>.xpos</code> argument, we can quickly look up the
position of a specific element in the nested list,</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## return position of Sweden in list</span></span>
<span><span class="fu"><a href="../reference/rrapply.html">rrapply</a></span><span class="op">(</span></span>
<span>  <span class="va">renewable_energy_by_country</span>,</span>
<span>  condition <span class="op">=</span> \<span class="op">(</span><span class="va">x</span>, <span class="va">.xname</span><span class="op">)</span> <span class="va">.xname</span> <span class="op">==</span> <span class="st">"Sweden"</span>,</span>
<span>  f <span class="op">=</span> \<span class="op">(</span><span class="va">x</span>, <span class="va">.xpos</span><span class="op">)</span> <span class="va">.xpos</span>,</span>
<span>  how <span class="op">=</span> <span class="st">"flatten"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; $Sweden</span></span>
<span><span class="co">#&gt; [1]  1  5  2 14</span></span></code></pre></div>
<p>Using the <code>.xsiblings</code> argument, we can look up the direct
neighbors of an element in the nested list,</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## look up neighbors of Sweden in list</span></span>
<span><span class="fu"><a href="../reference/rrapply.html">rrapply</a></span><span class="op">(</span></span>
<span>  <span class="va">renewable_energy_by_country</span>,</span>
<span>  condition <span class="op">=</span> \<span class="op">(</span><span class="va">x</span>, <span class="va">.xsiblings</span><span class="op">)</span> <span class="st">"Sweden"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">.xsiblings</span><span class="op">)</span>,</span>
<span>  how <span class="op">=</span> <span class="st">"flatten"</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt; Aland Islands       Denmark       Estonia Faroe Islands       Finland </span></span>
<span><span class="co">#&gt;            NA         33.06         26.55          4.24         42.03 </span></span>
<span><span class="co">#&gt;       Iceland       Ireland   Isle of Man        Latvia     Lithuania </span></span>
<span><span class="co">#&gt;         78.07          8.65          4.30         38.48         31.42</span></span></code></pre></div>
<p>We can also use the <code>.xpos</code> argument to determine the
maximum depth of the list or the length of the longest sublist as
follows,</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## maximum list depth</span></span>
<span><span class="fu"><a href="../reference/rrapply.html">rrapply</a></span><span class="op">(</span></span>
<span>  <span class="va">renewable_energy_by_country</span>, </span>
<span>  f <span class="op">=</span> \<span class="op">(</span><span class="va">x</span>, <span class="va">.xpos</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">.xpos</span><span class="op">)</span>, </span>
<span>  how <span class="op">=</span> <span class="st">"unlist"</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 5</span></span>
<span></span>
<span><span class="co">## longest sublist length</span></span>
<span><span class="fu"><a href="../reference/rrapply.html">rrapply</a></span><span class="op">(</span></span>
<span>  <span class="va">renewable_energy_by_country</span>, </span>
<span>  f <span class="op">=</span> \<span class="op">(</span><span class="va">x</span>, <span class="va">.xpos</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">.xpos</span><span class="op">)</span>, </span>
<span>  how <span class="op">=</span> <span class="st">"unlist"</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 28</span></span></code></pre></div>
<p>When unnesting nested lists with <code>how = "bind"</code>, the
<code>.xname</code>, <code>.xpos</code> or <code>.xparents</code>
arguments can be useful to decide which list elements to include in the
unnested data.frame:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## filter elements and unnest list  </span></span>
<span><span class="fu"><a href="../reference/rrapply.html">rrapply</a></span><span class="op">(</span></span>
<span>  <span class="va">pokedex</span>,</span>
<span>  condition <span class="op">=</span> \<span class="op">(</span><span class="va">x</span>, <span class="va">.xpos</span>, <span class="va">.xname</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">.xpos</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">4</span> <span class="op">&amp;</span> <span class="va">.xname</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"num"</span>, <span class="st">"name"</span>, <span class="st">"type"</span><span class="op">)</span>,</span>
<span>  how <span class="op">=</span> <span class="st">"bind"</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;   num       name          type</span></span>
<span><span class="co">#&gt; 1 001  Bulbasaur Grass, Poison</span></span>
<span><span class="co">#&gt; 2 002    Ivysaur Grass, Poison</span></span>
<span><span class="co">#&gt; 3 003   Venusaur Grass, Poison</span></span>
<span><span class="co">#&gt; 4 004 Charmander          Fire</span></span>
<span><span class="co">#&gt; 5 005 Charmeleon          Fire</span></span>
<span><span class="co">#&gt; 6 006  Charizard  Fire, Flying</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="modifying-list-elements">Modifying list elements<a class="anchor" aria-label="anchor" href="#modifying-list-elements"></a>
</h3>
<p>By default, both base <code><a href="https://rdrr.io/r/base/rapply.html" class="external-link">rapply()</a></code> and
<code><a href="../reference/rrapply.html">rrapply()</a></code> recurse into any <em>list-like</em> element.
Setting <code>classes = "list"</code> in <code><a href="../reference/rrapply.html">rrapply()</a></code>
overrides this behavior and applies the <code>f</code> function to any
list element (i.e. a sublist) that satisfies the <code>condition</code>
argument. If the <code>condition</code> is not satisfied for a list
element, <code><a href="../reference/rrapply.html">rrapply()</a></code> recurses further into the sublist,
applies <code>f</code> to the elements that satisfy
<code>condition</code> and so on. The use of
<code>classes = "list"</code> signals the <code><a href="../reference/rrapply.html">rrapply()</a></code>
function not to descend into list objects by default. For this reason
this behavior can only be triggered via the <code>classes</code>
argument and <em>not</em> through the use of
e.g. <code>condition = is.list</code>.</p>
<p>The mode <code>classes = "list"</code> can be useful to e.g. collapse
sublists or calculate summary statistics across elements in a nested
list:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## calculate mean value of Europe</span></span>
<span><span class="fu"><a href="../reference/rrapply.html">rrapply</a></span><span class="op">(</span></span>
<span>  <span class="va">renewable_energy_by_country</span>,  </span>
<span>  condition <span class="op">=</span> \<span class="op">(</span><span class="va">x</span>, <span class="va">.xname</span><span class="op">)</span> <span class="va">.xname</span> <span class="op">==</span> <span class="st">"Europe"</span>,</span>
<span>  f <span class="op">=</span> \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>  classes <span class="op">=</span> <span class="st">"list"</span>,</span>
<span>  how <span class="op">=</span> <span class="st">"flatten"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;   Europe </span></span>
<span><span class="co">#&gt; 22.36565</span></span></code></pre></div>
<p>Note that the principal argument in the <code>f</code> function now
evaluates to a list. For this reason, we first have to
<code>unlist</code> the sublist before calculating the mean.</p>
<p>To calculate the mean renewable energy shares for each continent, we
can make use of the fact that the <code>.xpos</code> vector of each
continent has length (i.e. depth) 2:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## calculate mean value for each continent</span></span>
<span><span class="co">## (Antartica's value is missing)</span></span>
<span><span class="fu"><a href="../reference/rrapply.html">rrapply</a></span><span class="op">(</span></span>
<span>  <span class="va">renewable_energy_by_country</span>, </span>
<span>  condition <span class="op">=</span> \<span class="op">(</span><span class="va">x</span>, <span class="va">.xpos</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">.xpos</span><span class="op">)</span> <span class="op">==</span> <span class="fl">2</span>,</span>
<span>  f <span class="op">=</span> \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>  classes <span class="op">=</span> <span class="st">"list"</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span>give.attr <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 1</span></span>
<span><span class="co">#&gt;  $ World:List of 6</span></span>
<span><span class="co">#&gt;   ..$ Africa    : num 54.3</span></span>
<span><span class="co">#&gt;   ..$ Americas  : num 18.2</span></span>
<span><span class="co">#&gt;   ..$ Antarctica: logi NA</span></span>
<span><span class="co">#&gt;   ..$ Asia      : num 17.9</span></span>
<span><span class="co">#&gt;   ..$ Europe    : num 22.4</span></span>
<span><span class="co">#&gt;   ..$ Oceania   : num 17.8</span></span></code></pre></div>
<p><strong>Remark</strong>: if <code>classes = "list"</code>, the
<code>f</code> function is only applied to the (non-terminal) list
elements. To apply <code>f</code> to both terminal and non-terminal
elements in the nested list, we can include additional classes, such as
<code>classes = c("list", "numeric", "character")</code>. To apply
<code>f</code> to <em>any</em> terminal and non-terminal element in the
nested list, we can even combine
<code>classes = c("list", "ANY")</code>. To illustrate, we search across
all list elements for the country or region with M49-code
<code>"155"</code>:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## filter country or region by M49-code</span></span>
<span><span class="fu"><a href="../reference/rrapply.html">rrapply</a></span><span class="op">(</span></span>
<span>  <span class="va">renewable_energy_by_country</span>,</span>
<span>  condition <span class="op">=</span> \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"M49-code"</span><span class="op">)</span> <span class="op">==</span> <span class="st">"155"</span>,</span>
<span>  f <span class="op">=</span> \<span class="op">(</span><span class="va">x</span>, <span class="va">.xname</span><span class="op">)</span> <span class="va">.xname</span>,</span>
<span>  classes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"list"</span>, <span class="st">"ANY"</span><span class="op">)</span>, </span>
<span>  how <span class="op">=</span> <span class="st">"unlist"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; World.Europe.Western Europe </span></span>
<span><span class="co">#&gt;            "Western Europe"</span></span></code></pre></div>
<p>As a more complex example, we unnest the Pokémon evolutions in
<code>pokedex</code> into a wide data.frame by returning the sublists
with Pokémon evolutions as character vectors:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## simplify pokemon evolutions to character vectors </span></span>
<span><span class="fu"><a href="../reference/rrapply.html">rrapply</a></span><span class="op">(</span></span>
<span>  <span class="va">pokedex</span>,</span>
<span>  condition <span class="op">=</span> \<span class="op">(</span><span class="va">x</span>, <span class="va">.xname</span><span class="op">)</span> <span class="va">.xname</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"name"</span>, <span class="st">"next_evolution"</span>, <span class="st">"prev_evolution"</span><span class="op">)</span>, </span>
<span>  f <span class="op">=</span> \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">is.list</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">`[[`</span>, <span class="st">"name"</span><span class="op">)</span> <span class="kw">else</span> <span class="va">x</span>,</span>
<span>  classes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"list"</span>, <span class="st">"character"</span><span class="op">)</span>,</span>
<span>  how <span class="op">=</span> <span class="st">"bind"</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">9</span><span class="op">)</span></span>
<span><span class="co">#&gt;         name        next_evolution         prev_evolution</span></span>
<span><span class="co">#&gt; 1  Bulbasaur     Ivysaur, Venusaur                     NA</span></span>
<span><span class="co">#&gt; 2    Ivysaur              Venusaur              Bulbasaur</span></span>
<span><span class="co">#&gt; 3   Venusaur                    NA     Bulbasaur, Ivysaur</span></span>
<span><span class="co">#&gt; 4 Charmander Charmeleon, Charizard                     NA</span></span>
<span><span class="co">#&gt; 5 Charmeleon             Charizard             Charmander</span></span>
<span><span class="co">#&gt; 6  Charizard                    NA Charmander, Charmeleon</span></span>
<span><span class="co">#&gt; 7   Squirtle  Wartortle, Blastoise                     NA</span></span>
<span><span class="co">#&gt; 8  Wartortle             Blastoise               Squirtle</span></span>
<span><span class="co">#&gt; 9  Blastoise                    NA    Squirtle, Wartortle</span></span></code></pre></div>
<p><strong>Hint:</strong> as data.frames are also list-like objects,
<code><a href="../reference/rrapply.html">rrapply()</a></code> applies <code>f</code> to individual data.frame
columns by default. Set <code>classes = "data.frame"</code> to avoid
this behavior and apply the <code>f</code> and <code>condition</code>
functions to complete data.frame objects instead of individual
data.frame columns.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## create a nested list of data.frames</span></span>
<span><span class="va">oceania_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rrapply.html">rrapply</a></span><span class="op">(</span></span>
<span>  <span class="va">renewable_oceania</span>,</span>
<span>  condition <span class="op">=</span> \<span class="op">(</span><span class="va">x</span>, <span class="va">.xpos</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">.xpos</span><span class="op">)</span> <span class="op">==</span> <span class="fl">2</span>,</span>
<span>  f <span class="op">=</span> \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  classes <span class="op">=</span> <span class="st">"list"</span>,</span>
<span>  how <span class="op">=</span> <span class="st">"replace"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co">## this does not work!</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/rrapply.html">rrapply</a></span><span class="op">(</span></span>
<span>    <span class="va">oceania_df</span>,</span>
<span>    f <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">x</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span>, <span class="co">## filter NA-rows of data.frame</span></span>
<span>    how <span class="op">=</span> <span class="st">"replace"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span>, error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">error</span><span class="op">)</span> <span class="va">error</span><span class="op">$</span><span class="va">message</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "object 'value' not found"</span></span>
<span></span>
<span><span class="co">## this does work</span></span>
<span><span class="fu"><a href="../reference/rrapply.html">rrapply</a></span><span class="op">(</span></span>
<span>  <span class="va">oceania_df</span>,</span>
<span>  f <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">x</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  classes <span class="op">=</span> <span class="st">"data.frame"</span>,</span>
<span>  how <span class="op">=</span> <span class="st">"replace"</span></span>
<span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span></span>
<span><span class="co">#&gt; $`Australia and New Zealand`</span></span>
<span><span class="co">#&gt;                    name value</span></span>
<span><span class="co">#&gt; Australia     Australia  9.32</span></span>
<span><span class="co">#&gt; New Zealand New Zealand 32.76</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $Melanesia</span></span>
<span><span class="co">#&gt;                              name value</span></span>
<span><span class="co">#&gt; Fiji                         Fiji 24.36</span></span>
<span><span class="co">#&gt; New Caledonia       New Caledonia  4.03</span></span>
<span><span class="co">#&gt; Papua New Guinea Papua New Guinea 50.34</span></span>
<span><span class="co">#&gt; Solomon Islands   Solomon Islands 65.73</span></span>
<span><span class="co">#&gt; Vanuatu                   Vanuatu 33.67</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="recursive-list-updating">Recursive list updating<a class="anchor" aria-label="anchor" href="#recursive-list-updating"></a>
</h3>
<div class="section level4">
<h4 id="how-recurse">
<code>how = "recurse"</code><a class="anchor" aria-label="anchor" href="#how-recurse"></a>
</h4>
<p>If <code>classes = "list"</code> and <code>how = "recurse"</code>,
<code><a href="../reference/rrapply.html">rrapply()</a></code> applies the <code>f</code> function to any list
element that satisfies the <code>condition</code> argument, but recurses
further into any <em>updated</em> list element after application of
<code>f</code>. This can be useful to e.g. recursively update the class
or other attributes of all elements in a nested list:</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## recursively remove all list attributes</span></span>
<span><span class="fu"><a href="../reference/rrapply.html">rrapply</a></span><span class="op">(</span></span>
<span>  <span class="va">renewable_oceania</span>,</span>
<span>  f <span class="op">=</span> \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>  classes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"list"</span>, <span class="st">"ANY"</span><span class="op">)</span>,</span>
<span>  how <span class="op">=</span> <span class="st">"recurse"</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span>list.len <span class="op">=</span> <span class="fl">3</span>, give.attr <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 1</span></span>
<span><span class="co">#&gt;  $ Oceania:List of 4</span></span>
<span><span class="co">#&gt;   ..$ Australia and New Zealand:List of 6</span></span>
<span><span class="co">#&gt;   .. ..$ Australia                        : num 9.32</span></span>
<span><span class="co">#&gt;   .. ..$ Christmas Island                 : logi NA</span></span>
<span><span class="co">#&gt;   .. ..$ Cocos (Keeling) Islands          : logi NA</span></span>
<span><span class="co">#&gt;   .. .. [list output truncated]</span></span>
<span><span class="co">#&gt;   ..$ Melanesia                :List of 5</span></span>
<span><span class="co">#&gt;   .. ..$ Fiji            : num 24.4</span></span>
<span><span class="co">#&gt;   .. ..$ New Caledonia   : num 4.03</span></span>
<span><span class="co">#&gt;   .. ..$ Papua New Guinea: num 50.3</span></span>
<span><span class="co">#&gt;   .. .. [list output truncated]</span></span>
<span><span class="co">#&gt;   ..$ Micronesia               :List of 8</span></span>
<span><span class="co">#&gt;   .. ..$ Guam                                : num 3.03</span></span>
<span><span class="co">#&gt;   .. ..$ Kiribati                            : num 45.4</span></span>
<span><span class="co">#&gt;   .. ..$ Marshall Islands                    : num 11.8</span></span>
<span><span class="co">#&gt;   .. .. [list output truncated]</span></span>
<span><span class="co">#&gt;   .. [list output truncated]</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="how-names">
<code>how = "names"</code><a class="anchor" aria-label="anchor" href="#how-names"></a>
</h4>
<p>The option <code>how = "names"</code> is a special case of
<code>how = "recurse"</code>, where the value of <code>f</code> is used
to replace the <em>name</em> of the evaluated list element instead of
its <em>content</em> (as with all other <code>how</code> options). By
default, <code>how = "names"</code> uses
<code>classes = c("list", "ANY")</code> in order to allow updating of
all names in the nested list.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## recursively replace all names by M49-codes</span></span>
<span><span class="fu"><a href="../reference/rrapply.html">rrapply</a></span><span class="op">(</span></span>
<span>  <span class="va">renewable_oceania</span>,</span>
<span>  f <span class="op">=</span> \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"M49-code"</span><span class="op">)</span>,</span>
<span>  how <span class="op">=</span> <span class="st">"names"</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span>list.len <span class="op">=</span> <span class="fl">3</span>, give.attr <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 1</span></span>
<span><span class="co">#&gt;  $ 009:List of 4</span></span>
<span><span class="co">#&gt;   ..$ 053:List of 6</span></span>
<span><span class="co">#&gt;   .. ..$ 036: num 9.32</span></span>
<span><span class="co">#&gt;   .. ..$ 162: logi NA</span></span>
<span><span class="co">#&gt;   .. ..$ 166: logi NA</span></span>
<span><span class="co">#&gt;   .. .. [list output truncated]</span></span>
<span><span class="co">#&gt;   ..$ 054:List of 5</span></span>
<span><span class="co">#&gt;   .. ..$ 242: num 24.4</span></span>
<span><span class="co">#&gt;   .. ..$ 540: num 4.03</span></span>
<span><span class="co">#&gt;   .. ..$ 598: num 50.3</span></span>
<span><span class="co">#&gt;   .. .. [list output truncated]</span></span>
<span><span class="co">#&gt;   ..$ 057:List of 8</span></span>
<span><span class="co">#&gt;   .. ..$ 316: num 3.03</span></span>
<span><span class="co">#&gt;   .. ..$ 296: num 45.4</span></span>
<span><span class="co">#&gt;   .. ..$ 584: num 11.8</span></span>
<span><span class="co">#&gt;   .. .. [list output truncated]</span></span>
<span><span class="co">#&gt;   .. [list output truncated]</span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h2>
<p>To conclude, we return to the list recursion exercise in the first
section. Using <code><a href="../reference/rrapply.html">rrapply()</a></code>, one possible solution is to split
the question into two steps as follows:</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## look up position of Euler (Leonhard)</span></span>
<span><span class="va">euler</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rrapply.html">rrapply</a></span><span class="op">(</span></span>
<span>  <span class="va">students</span>,</span>
<span>  condition <span class="op">=</span> \<span class="op">(</span><span class="va">x</span>, <span class="va">.xname</span><span class="op">)</span> <span class="va">.xname</span> <span class="op">==</span> <span class="st">"Euler"</span> <span class="op">&amp;&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"given"</span><span class="op">)</span> <span class="op">==</span> <span class="st">"Leonhard"</span>,</span>
<span>  f <span class="op">=</span> \<span class="op">(</span><span class="va">x</span>, <span class="va">.xpos</span><span class="op">)</span> <span class="va">.xpos</span>,</span>
<span>  classes <span class="op">=</span> <span class="st">"list"</span>,</span>
<span>  how <span class="op">=</span> <span class="st">"flatten"</span></span>
<span><span class="op">)</span><span class="op">[[</span><span class="st">"Euler"</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span><span class="co">## filter descendants of Euler (Leonhard) and replace missing values by zero</span></span>
<span><span class="fu"><a href="../reference/rrapply.html">rrapply</a></span><span class="op">(</span></span>
<span>  <span class="va">students</span>,</span>
<span>  condition <span class="op">=</span> \<span class="op">(</span><span class="va">x</span>, <span class="va">.xpos</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/identical.html" class="external-link">identical</a></span><span class="op">(</span><span class="va">.xpos</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">euler</span><span class="op">)</span><span class="op">]</span>, <span class="va">euler</span><span class="op">)</span>, </span>
<span>  f <span class="op">=</span> \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/replace.html" class="external-link">replace</a></span><span class="op">(</span><span class="va">x</span>, <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, <span class="fl">0</span><span class="op">)</span>,</span>
<span>  how <span class="op">=</span> <span class="st">"prune"</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span>give.attr <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 1</span></span>
<span><span class="co">#&gt;  $ Bernoulli:List of 1</span></span>
<span><span class="co">#&gt;   ..$ Bernoulli:List of 1</span></span>
<span><span class="co">#&gt;   .. ..$ Euler:List of 2</span></span>
<span><span class="co">#&gt;   .. .. ..$ Euler   : num 0</span></span>
<span><span class="co">#&gt;   .. .. ..$ Lagrange:List of 3</span></span>
<span><span class="co">#&gt;   .. .. .. ..$ Fourier: num 73788</span></span>
<span><span class="co">#&gt;   .. .. .. ..$ Plana  : num 0</span></span>
<span><span class="co">#&gt;   .. .. .. ..$ Poisson: num 128235</span></span></code></pre></div>
<p>Knowing that Johann Euler is a descendant of Leonhard Euler, we can
further simplify this into a single function call using the
<code>.xparents</code> argument:</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## filter descendants of Euler (Leonhard) and replace missing values by zero</span></span>
<span><span class="fu"><a href="../reference/rrapply.html">rrapply</a></span><span class="op">(</span></span>
<span>  <span class="va">students</span>,</span>
<span>  condition <span class="op">=</span> \<span class="op">(</span><span class="va">x</span>, <span class="va">.xparents</span><span class="op">)</span> <span class="st">"Euler"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">.xparents</span>,</span>
<span>  f <span class="op">=</span> \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/replace.html" class="external-link">replace</a></span><span class="op">(</span><span class="va">x</span>, <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, <span class="fl">0</span><span class="op">)</span>,</span>
<span>  how <span class="op">=</span> <span class="st">"prune"</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span>give.attr <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 1</span></span>
<span><span class="co">#&gt;  $ Bernoulli:List of 1</span></span>
<span><span class="co">#&gt;   ..$ Bernoulli:List of 1</span></span>
<span><span class="co">#&gt;   .. ..$ Euler:List of 2</span></span>
<span><span class="co">#&gt;   .. .. ..$ Euler   : num 0</span></span>
<span><span class="co">#&gt;   .. .. ..$ Lagrange:List of 3</span></span>
<span><span class="co">#&gt;   .. .. .. ..$ Fourier: num 73788</span></span>
<span><span class="co">#&gt;   .. .. .. ..$ Plana  : num 0</span></span>
<span><span class="co">#&gt;   .. .. .. ..$ Poisson: num 128235</span></span></code></pre></div>
<p>Or alternatively, we could first update the names of the elements in
the nested list to include both first and last names and then prune the
list in a second step:</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## include first names in list element names</span></span>
<span><span class="va">students_fullnames</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rrapply.html">rrapply</a></span><span class="op">(</span></span>
<span>  <span class="va">students</span>, </span>
<span>  f <span class="op">=</span> \<span class="op">(</span><span class="va">x</span>, <span class="va">.xname</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"given"</span><span class="op">)</span>, <span class="va">.xname</span><span class="op">)</span>,</span>
<span>  how <span class="op">=</span> <span class="st">"names"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co">## filter descendants of Euler (Leonhard) and replace missing values by zero</span></span>
<span><span class="fu"><a href="../reference/rrapply.html">rrapply</a></span><span class="op">(</span></span>
<span>  <span class="va">students_fullnames</span>,</span>
<span>  condition <span class="op">=</span> \<span class="op">(</span><span class="va">x</span>, <span class="va">.xparents</span><span class="op">)</span> <span class="st">"Leonhard Euler"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">.xparents</span>,</span>
<span>  f <span class="op">=</span> \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/replace.html" class="external-link">replace</a></span><span class="op">(</span><span class="va">x</span>, <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, <span class="fl">0</span><span class="op">)</span>,</span>
<span>  how <span class="op">=</span> <span class="st">"prune"</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span>give.attr <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 1</span></span>
<span><span class="co">#&gt;  $ Jacob Bernoulli:List of 1</span></span>
<span><span class="co">#&gt;   ..$ Johann Bernoulli:List of 1</span></span>
<span><span class="co">#&gt;   .. ..$ Leonhard Euler:List of 2</span></span>
<span><span class="co">#&gt;   .. .. ..$ Johann Euler   : num 0</span></span>
<span><span class="co">#&gt;   .. .. ..$ Joseph Lagrange:List of 3</span></span>
<span><span class="co">#&gt;   .. .. .. ..$ Jean-Baptiste Fourier: num 73788</span></span>
<span><span class="co">#&gt;   .. .. .. ..$ Giovanni Plana       : num 0</span></span>
<span><span class="co">#&gt;   .. .. .. ..$ Simeon Poisson       : num 128235</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Joris Chau.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>

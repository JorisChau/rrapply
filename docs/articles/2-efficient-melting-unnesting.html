<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="rrapply">
<title>Efficient list melting and unnesting with rrapply • rrapply</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Efficient list melting and unnesting with rrapply">
<meta property="og:description" content="rrapply">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">rrapply</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.2.7</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/1-when-to-use-rrapply.html">Efficient list recursion with rrapply</a>
    <a class="dropdown-item" href="../articles/2-efficient-melting-unnesting.html">Efficient list melting and unnesting with rrapply</a>
    <a class="dropdown-item" href="../articles/3-calls-and-expressions.html">Recursive apply for calls and expressions</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/JorisChau/rrapply/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Efficient list melting and unnesting with rrapply</h1>
                        <h4 data-toc-skip class="author">Joris Chau</h4>
            
            <h4 data-toc-skip class="date">Latest date: 2024-06-26</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/JorisChau/rrapply/blob/HEAD/vignettes/articles/2-efficient-melting-unnesting.Rmd" class="external-link"><code>vignettes/articles/2-efficient-melting-unnesting.Rmd</code></a></small>
      <div class="d-none name"><code>2-efficient-melting-unnesting.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The previous article <code><a href="../articles/1-when-to-use-rrapply.html">vignette("1-when-to-use-rrapply")</a></code>
describes the principal use of the <code><a href="../reference/rrapply.html">rrapply()</a></code> function as a
revised and extended version of base <code><a href="https://rdrr.io/r/base/rapply.html" class="external-link">rapply()</a></code> in the
context of nested list recursion. For quick data exploration of a nested
list it can make sense to keep the list in its original nested format to
reduce the number of processing steps and minimize code complexity. As
part of a more elaborate data analysis, if there is no specific reason
to keep the nested data structure, it is often more practical to
transform the nested list into a more convenient rectangular format and
work with the unnested object (e.g. a data.frame) instead. In this
follow-up article, we review the available (<code>how</code>) options in
<code><a href="../reference/rrapply.html">rrapply()</a></code> to unnest or melt nested lists into a rectangular
format in more detail and highlight the similarities and differences
with respect to several common alternatives in R.</p>
</div>
<div class="section level2">
<h2 id="nested-list-to-data-frame">Nested list to data.frame<a class="anchor" aria-label="anchor" href="#nested-list-to-data-frame"></a>
</h2>
<div class="section level3">
<h3 id="melt-to-long-data-frame">Melt to long data.frame<a class="anchor" aria-label="anchor" href="#melt-to-long-data-frame"></a>
</h3>
<p>The option <code>how = "melt"</code> in <code><a href="../reference/rrapply.html">rrapply()</a></code>
unnests a nested list to a <em>long</em> or melted data.frame similar in
format to the retired <code><a href="https://rdrr.io/pkg/reshape2/man/melt.html" class="external-link">reshape2::melt()</a></code> function applied to
a nested list. The rows of the melted data.frame contain the individual
node paths of the elements in the nested list after pruning (based on
the <code>condition</code> and/or <code>classes</code> arguments). The
<code>"value"</code> column is a vector- or list-column containing the
values of the leaf elements identical to the object returned by
<code>how = "flatten"</code>.</p>
<p>To demonstrate, we use the <code>renewable_energy_by_country</code>
dataset included in the <code>rrapply</code>-package, a nested list
containing the renewable energy shares per country (% of total energy
consumption) in 2016<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;The &lt;code&gt;renewable_energy_by_country&lt;/code&gt; dataset is
publicly available at the &lt;a href="https://unstats-undesa.opendata.arcgis.com/datasets/" class="external-link"&gt;United
Nations Open SDG Data Hub&lt;/a&gt;&lt;/p&gt;'><sup>1</sup></a>. The 249 countries and areas are structured
based on their geographical locations according to the <a href="https://unstats.un.org/unsd/methodology/m49/" class="external-link">United Nations M49
standard</a>. The numeric values listed for each country are
percentages, if no data is available the value of the country is
<code>NA</code>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://jorischau.github.io/rrapply/" class="external-link">rrapply</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co">## melt all data to long data.frame</span></span>
<span><span class="fu"><a href="../reference/rrapply.html">rrapply</a></span><span class="op">(</span></span>
<span>  <span class="va">renewable_energy_by_country</span>, </span>
<span>  how <span class="op">=</span> <span class="st">"melt"</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt;       L1     L2                 L3             L4                             L5 value</span></span>
<span><span class="co">#&gt; 1  World Africa    Northern Africa        Algeria                           &lt;NA&gt;  0.08</span></span>
<span><span class="co">#&gt; 2  World Africa    Northern Africa          Egypt                           &lt;NA&gt;  5.69</span></span>
<span><span class="co">#&gt; 3  World Africa    Northern Africa          Libya                           &lt;NA&gt;  1.64</span></span>
<span><span class="co">#&gt; 4  World Africa    Northern Africa        Morocco                           &lt;NA&gt; 11.02</span></span>
<span><span class="co">#&gt; 5  World Africa    Northern Africa          Sudan                           &lt;NA&gt; 61.64</span></span>
<span><span class="co">#&gt; 6  World Africa    Northern Africa        Tunisia                           &lt;NA&gt; 12.47</span></span>
<span><span class="co">#&gt; 7  World Africa    Northern Africa Western Sahara                           &lt;NA&gt;    NA</span></span>
<span><span class="co">#&gt; 8  World Africa Sub-Saharan Africa Eastern Africa British Indian Ocean Territory    NA</span></span>
<span><span class="co">#&gt; 9  World Africa Sub-Saharan Africa Eastern Africa                        Burundi 89.22</span></span>
<span><span class="co">#&gt; 10 World Africa Sub-Saharan Africa Eastern Africa                        Comoros 41.92</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## drop logical NA's and melt to data.frame</span></span>
<span><span class="fu"><a href="../reference/rrapply.html">rrapply</a></span><span class="op">(</span></span>
<span>  <span class="va">renewable_energy_by_country</span>,</span>
<span>  classes <span class="op">=</span> <span class="st">"numeric"</span>,</span>
<span>  how <span class="op">=</span> <span class="st">"melt"</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt;       L1     L2                 L3             L4       L5 value</span></span>
<span><span class="co">#&gt; 1  World Africa    Northern Africa        Algeria     &lt;NA&gt;  0.08</span></span>
<span><span class="co">#&gt; 2  World Africa    Northern Africa          Egypt     &lt;NA&gt;  5.69</span></span>
<span><span class="co">#&gt; 3  World Africa    Northern Africa          Libya     &lt;NA&gt;  1.64</span></span>
<span><span class="co">#&gt; 4  World Africa    Northern Africa        Morocco     &lt;NA&gt; 11.02</span></span>
<span><span class="co">#&gt; 5  World Africa    Northern Africa          Sudan     &lt;NA&gt; 61.64</span></span>
<span><span class="co">#&gt; 6  World Africa    Northern Africa        Tunisia     &lt;NA&gt; 12.47</span></span>
<span><span class="co">#&gt; 7  World Africa Sub-Saharan Africa Eastern Africa  Burundi 89.22</span></span>
<span><span class="co">#&gt; 8  World Africa Sub-Saharan Africa Eastern Africa  Comoros 41.92</span></span>
<span><span class="co">#&gt; 9  World Africa Sub-Saharan Africa Eastern Africa Djibouti 28.50</span></span>
<span><span class="co">#&gt; 10 World Africa Sub-Saharan Africa Eastern Africa  Eritrea 80.14</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## apply condition and melt to data.frame</span></span>
<span><span class="fu"><a href="../reference/rrapply.html">rrapply</a></span><span class="op">(</span></span>
<span>  <span class="va">renewable_energy_by_country</span>,</span>
<span>  condition <span class="op">=</span> \<span class="op">(</span><span class="va">x</span>, <span class="va">.xparents</span><span class="op">)</span> <span class="st">"Western Europe"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">.xparents</span>,</span>
<span>  how <span class="op">=</span> <span class="st">"melt"</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt;      L1     L2             L3            L4 value</span></span>
<span><span class="co">#&gt; 1 World Europe Western Europe       Austria 34.67</span></span>
<span><span class="co">#&gt; 2 World Europe Western Europe       Belgium  9.14</span></span>
<span><span class="co">#&gt; 3 World Europe Western Europe        France 14.74</span></span>
<span><span class="co">#&gt; 4 World Europe Western Europe       Germany 14.17</span></span>
<span><span class="co">#&gt; 5 World Europe Western Europe Liechtenstein 62.93</span></span>
<span><span class="co">#&gt; 6 World Europe Western Europe    Luxembourg 13.54</span></span>
<span><span class="co">#&gt; 7 World Europe Western Europe        Monaco    NA</span></span>
<span><span class="co">#&gt; 8 World Europe Western Europe   Netherlands  5.78</span></span>
<span><span class="co">#&gt; 9 World Europe Western Europe   Switzerland 25.49</span></span></code></pre></div>
<p>As shown in the above examples, in comparison to
<code><a href="https://rdrr.io/pkg/reshape2/man/melt.html" class="external-link">reshape2::melt()</a></code>, <code><a href="../reference/rrapply.html">rrapply()</a></code> allows to filter
or transform list elements before melting the nested list through the
<code>f</code>, <code>classes</code> and <code>condition</code>
arguments<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;Note that &lt;code&gt;&lt;a href="../reference/rrapply.html"&gt;rrapply()&lt;/a&gt;&lt;/code&gt; imposes a different
column order than &lt;code&gt;&lt;a href="https://rdrr.io/pkg/reshape2/man/melt.html" class="external-link"&gt;reshape2::melt()&lt;/a&gt;&lt;/code&gt; and the
&lt;code&gt;"value"&lt;/code&gt; column may follow slightly different coercion
rules, but other than that the melted data.frames are the same.&lt;/p&gt;'><sup>2</sup></a>. More importantly, <code><a href="../reference/rrapply.html">rrapply()</a></code>
is optimized specifically for handling nested lists, whereas
<code><a href="https://rdrr.io/pkg/reshape2/man/melt.html" class="external-link">reshape2::melt()</a></code> was aimed primarily at melting data.frames
before being superseded by <code><a href="https://tidyr.tidyverse.org/reference/gather.html" class="external-link">tidyr::gather()</a></code> and more
recently <code><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">tidyr::pivot_longer()</a></code>. For this reason,
<code><a href="https://rdrr.io/pkg/reshape2/man/melt.html" class="external-link">reshape2::melt()</a></code> can be quite slow when applied to large
nested lists:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## melt to long data.frame (reshape2)</span></span>
<span><span class="fu">reshape2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html" class="external-link">melt</a></span><span class="op">(</span><span class="va">renewable_energy_by_country</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt;    value             L4                             L5                 L3     L2    L1</span></span>
<span><span class="co">#&gt; 1   0.08        Algeria                           &lt;NA&gt;    Northern Africa Africa World</span></span>
<span><span class="co">#&gt; 2   5.69          Egypt                           &lt;NA&gt;    Northern Africa Africa World</span></span>
<span><span class="co">#&gt; 3   1.64          Libya                           &lt;NA&gt;    Northern Africa Africa World</span></span>
<span><span class="co">#&gt; 4  11.02        Morocco                           &lt;NA&gt;    Northern Africa Africa World</span></span>
<span><span class="co">#&gt; 5  61.64          Sudan                           &lt;NA&gt;    Northern Africa Africa World</span></span>
<span><span class="co">#&gt; 6  12.47        Tunisia                           &lt;NA&gt;    Northern Africa Africa World</span></span>
<span><span class="co">#&gt; 7     NA Western Sahara                           &lt;NA&gt;    Northern Africa Africa World</span></span>
<span><span class="co">#&gt; 8     NA Eastern Africa British Indian Ocean Territory Sub-Saharan Africa Africa World</span></span>
<span><span class="co">#&gt; 9  89.22 Eastern Africa                        Burundi Sub-Saharan Africa Africa World</span></span>
<span><span class="co">#&gt; 10 41.92 Eastern Africa                        Comoros Sub-Saharan Africa Africa World</span></span>
<span></span>
<span><span class="co">## computation times</span></span>
<span><span class="fu">bench</span><span class="fu">::</span><span class="fu"><a href="http://bench.r-lib.org/reference/mark.html" class="external-link">mark</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="../reference/rrapply.html">rrapply</a></span><span class="op">(</span><span class="va">renewable_energy_by_country</span><span class="op">)</span>,</span>
<span>  <span class="fu">reshape2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html" class="external-link">melt</a></span><span class="op">(</span><span class="va">renewable_energy_by_country</span><span class="op">)</span>,</span>
<span>  check <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Some expressions had a GC in every iteration; so filtering is disabled.</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 6</span></span></span>
<span><span class="co">#&gt;   expression                                       min   median `itr/sec` mem_alloc `gc/sec`</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;bch:expr&gt;</span>                                  <span style="color: #949494; font-style: italic;">&lt;bch:tm&gt;</span> <span style="color: #949494; font-style: italic;">&lt;bch:tm&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;bch:byt&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> rrapply(renewable_energy_by_country)          12.8µs   15.6µs   <span style="text-decoration: underline;">47</span>083.         0B     28.3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> reshape2::melt(renewable_energy_by_country)   56.3ms     66ms      15.2    73.1KB     15.2</span></span></code></pre></div>
<p>For a medium-sized list as used in this example, the computation time
of <code><a href="https://rdrr.io/pkg/reshape2/man/melt.html" class="external-link">reshape2::melt()</a></code> is not a bottleneck for practical
usage. However, the computational effort quickly increases when melting
larger or more deeply nested lists:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## helper function to generate large nested list</span></span>
<span><span class="va">new_list</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span>, <span class="va">d</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">v</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">vector</a></span><span class="op">(</span>mode <span class="op">=</span> <span class="st">"list"</span>, length <span class="op">=</span> <span class="va">n</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="../reference/rrapply.html">rrapply</a></span><span class="op">(</span></span>
<span>    object <span class="op">=</span> <span class="va">v</span>,</span>
<span>    classes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"list"</span>, <span class="st">"NULL"</span><span class="op">)</span>,</span>
<span>    condition <span class="op">=</span> \<span class="op">(</span><span class="va">x</span>, <span class="va">.xpos</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">.xpos</span><span class="op">)</span> <span class="op">&lt;=</span> <span class="va">d</span>,</span>
<span>    f <span class="op">=</span> \<span class="op">(</span><span class="va">x</span>, <span class="va">.xpos</span><span class="op">)</span> <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">.xpos</span><span class="op">)</span> <span class="op">&lt;</span> <span class="va">d</span><span class="op">)</span> <span class="va">v</span> <span class="kw">else</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>    how <span class="op">=</span> <span class="st">"recurse"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">## random seed</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## generate large shallow list (10^6 elements)</span></span>
<span><span class="va">shallow_list</span> <span class="op">&lt;-</span> <span class="fu">new_list</span><span class="op">(</span>n <span class="op">=</span> <span class="fl">100</span>, d <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">shallow_list</span>, list.len <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 100</span></span>
<span><span class="co">#&gt;  $ :List of 100</span></span>
<span><span class="co">#&gt;   ..$ :List of 100</span></span>
<span><span class="co">#&gt;   .. ..$ : num 0.266</span></span>
<span><span class="co">#&gt;   .. ..$ : num 0.372</span></span>
<span><span class="co">#&gt;   .. .. [list output truncated]</span></span>
<span><span class="co">#&gt;   ..$ :List of 100</span></span>
<span><span class="co">#&gt;   .. ..$ : num 0.655</span></span>
<span><span class="co">#&gt;   .. ..$ : num 0.353</span></span>
<span><span class="co">#&gt;   .. .. [list output truncated]</span></span>
<span><span class="co">#&gt;   .. [list output truncated]</span></span>
<span><span class="co">#&gt;  $ :List of 100</span></span>
<span><span class="co">#&gt;   ..$ :List of 100</span></span>
<span><span class="co">#&gt;   .. ..$ : num 0.0647</span></span>
<span><span class="co">#&gt;   .. ..$ : num 0.677</span></span>
<span><span class="co">#&gt;   .. .. [list output truncated]</span></span>
<span><span class="co">#&gt;   ..$ :List of 100</span></span>
<span><span class="co">#&gt;   .. ..$ : num 0.266</span></span>
<span><span class="co">#&gt;   .. ..$ : num 0.66</span></span>
<span><span class="co">#&gt;   .. .. [list output truncated]</span></span>
<span><span class="co">#&gt;   .. [list output truncated]</span></span>
<span><span class="co">#&gt;   [list output truncated]</span></span>
<span></span>
<span><span class="co">## benchmark timing with rrapply</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="va">shallow_melt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rrapply.html">rrapply</a></span><span class="op">(</span><span class="va">shallow_list</span>, how <span class="op">=</span> <span class="st">"melt"</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="co">#&gt;    user  system elapsed </span></span>
<span><span class="co">#&gt;   1.054   0.036   1.090</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">shallow_melt</span><span class="op">)</span></span>
<span><span class="co">#&gt;   L1 L2 L3     value</span></span>
<span><span class="co">#&gt; 1  1  1  1 0.2655087</span></span>
<span><span class="co">#&gt; 2  1  1  2 0.3721239</span></span>
<span><span class="co">#&gt; 3  1  1  3 0.5728534</span></span>
<span><span class="co">#&gt; 4  1  1  4 0.9082078</span></span>
<span><span class="co">#&gt; 5  1  1  5 0.2016819</span></span>
<span><span class="co">#&gt; 6  1  1  6 0.8983897</span></span>
<span></span>
<span><span class="co">## benchmark timing with reshape2::melt</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="va">shallow_melt_reshape2</span> <span class="op">&lt;-</span> <span class="fu">reshape2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html" class="external-link">melt</a></span><span class="op">(</span><span class="va">shallow_list</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;    user  system elapsed </span></span>
<span><span class="co">#&gt; 174.058   0.043 174.139</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">shallow_melt_reshape2</span><span class="op">)</span></span>
<span><span class="co">#&gt;       value L3 L2 L1</span></span>
<span><span class="co">#&gt; 1 0.2655087  1  1  1</span></span>
<span><span class="co">#&gt; 2 0.3721239  2  1  1</span></span>
<span><span class="co">#&gt; 3 0.5728534  3  1  1</span></span>
<span><span class="co">#&gt; 4 0.9082078  4  1  1</span></span>
<span><span class="co">#&gt; 5 0.2016819  5  1  1</span></span>
<span><span class="co">#&gt; 6 0.8983897  6  1  1</span></span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## generate large deeply nested list (2^18 elements)</span></span>
<span><span class="va">deep_list</span> <span class="op">&lt;-</span> <span class="fu">new_list</span><span class="op">(</span>n <span class="op">=</span> <span class="fl">2</span>, d <span class="op">=</span> <span class="fl">18</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## benchmark timing with rrapply</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="va">deep_melt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rrapply.html">rrapply</a></span><span class="op">(</span><span class="va">deep_list</span>, how <span class="op">=</span> <span class="st">"melt"</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="co">#&gt;    user  system elapsed </span></span>
<span><span class="co">#&gt;   0.747   0.016   0.763</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">deep_melt</span><span class="op">)</span></span>
<span><span class="co">#&gt;   L1 L2 L3 L4 L5 L6 L7 L8 L9 L10 L11 L12 L13 L14 L15 L16 L17 L18      value</span></span>
<span><span class="co">#&gt; 1  1  1  1  1  1  1  1  1  1   1   1   1   1   1   1   1   1   1 0.14011775</span></span>
<span><span class="co">#&gt; 2  1  1  1  1  1  1  1  1  1   1   1   1   1   1   1   1   1   2 0.69562066</span></span>
<span><span class="co">#&gt; 3  1  1  1  1  1  1  1  1  1   1   1   1   1   1   1   1   2   1 0.72888445</span></span>
<span><span class="co">#&gt; 4  1  1  1  1  1  1  1  1  1   1   1   1   1   1   1   1   2   2 0.09164734</span></span>
<span><span class="co">#&gt; 5  1  1  1  1  1  1  1  1  1   1   1   1   1   1   1   2   1   1 0.06661200</span></span>
<span><span class="co">#&gt; 6  1  1  1  1  1  1  1  1  1   1   1   1   1   1   1   2   1   2 0.61285721</span></span>
<span></span>
<span><span class="co">## benchmark timing with reshape2::melt</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="va">deep_melt_reshape2</span> <span class="op">&lt;-</span> <span class="fu">reshape2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html" class="external-link">melt</a></span><span class="op">(</span><span class="va">deep_list</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;    user  system elapsed </span></span>
<span><span class="co">#&gt; 143.591   0.044 143.655</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">deep_melt_reshape2</span><span class="op">)</span></span>
<span><span class="co">#&gt;        value L18 L17 L16 L15 L14 L13 L12 L11 L10 L9 L8 L7 L6 L5 L4 L3 L2 L1</span></span>
<span><span class="co">#&gt; 1 0.14011775   1   1   1   1   1   1   1   1   1  1  1  1  1  1  1  1  1  1</span></span>
<span><span class="co">#&gt; 2 0.69562066   2   1   1   1   1   1   1   1   1  1  1  1  1  1  1  1  1  1</span></span>
<span><span class="co">#&gt; 3 0.72888445   1   2   1   1   1   1   1   1   1  1  1  1  1  1  1  1  1  1</span></span>
<span><span class="co">#&gt; 4 0.09164734   2   2   1   1   1   1   1   1   1  1  1  1  1  1  1  1  1  1</span></span>
<span><span class="co">#&gt; 5 0.06661200   1   1   2   1   1   1   1   1   1  1  1  1  1  1  1  1  1  1</span></span>
<span><span class="co">#&gt; 6 0.61285721   2   1   2   1   1   1   1   1   1  1  1  1  1  1  1  1  1  1</span></span></code></pre></div>
<p>Although unlikely to encounter such large or deeply nested lists in
practice, these artificial examples serve to illustrate that
<code><a href="https://rdrr.io/pkg/reshape2/man/melt.html" class="external-link">reshape2::melt()</a></code> is not particularly efficient in unnesting
large nested lists to data.frames.</p>
</div>
<div class="section level3">
<h3 id="bind-to-wide-data-frame">Bind to wide data.frame<a class="anchor" aria-label="anchor" href="#bind-to-wide-data-frame"></a>
</h3>
<p>The option <code>how = "bind"</code> unnests a nested list to a
<em>wide</em> data.frame and is used to unnest nested lists containing
repeated entries of the same variables. To illustrate, we consider the
<code>pokedex</code> dataset included in the
<code>rrapply</code>-package, a nested list containing various property
values for each of the 151 original Pokémon available (in .json) from <a href="https://github.com/Biuni/PokemonGO-Pokedex" class="external-link uri">https://github.com/Biuni/PokemonGO-Pokedex</a>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## all 151 Pokemon</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">pokedex</span>, list.len <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 1</span></span>
<span><span class="co">#&gt;  $ pokemon:List of 151</span></span>
<span><span class="co">#&gt;   ..$ :List of 16</span></span>
<span><span class="co">#&gt;   .. ..$ id            : int 1</span></span>
<span><span class="co">#&gt;   .. ..$ num           : chr "001"</span></span>
<span><span class="co">#&gt;   .. ..$ name          : chr "Bulbasaur"</span></span>
<span><span class="co">#&gt;   .. .. [list output truncated]</span></span>
<span><span class="co">#&gt;   ..$ :List of 17</span></span>
<span><span class="co">#&gt;   .. ..$ id            : int 2</span></span>
<span><span class="co">#&gt;   .. ..$ num           : chr "002"</span></span>
<span><span class="co">#&gt;   .. ..$ name          : chr "Ivysaur"</span></span>
<span><span class="co">#&gt;   .. .. [list output truncated]</span></span>
<span><span class="co">#&gt;   ..$ :List of 15</span></span>
<span><span class="co">#&gt;   .. ..$ id            : int 3</span></span>
<span><span class="co">#&gt;   .. ..$ num           : chr "003"</span></span>
<span><span class="co">#&gt;   .. ..$ name          : chr "Venusaur"</span></span>
<span><span class="co">#&gt;   .. .. [list output truncated]</span></span>
<span><span class="co">#&gt;   .. [list output truncated]</span></span>
<span></span>
<span><span class="co">## single Pokemon entry</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">pokedex</span><span class="op">[[</span><span class="st">"pokemon"</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 16</span></span>
<span><span class="co">#&gt;  $ id            : int 1</span></span>
<span><span class="co">#&gt;  $ num           : chr "001"</span></span>
<span><span class="co">#&gt;  $ name          : chr "Bulbasaur"</span></span>
<span><span class="co">#&gt;  $ img           : chr "http://www.serebii.net/pokemongo/pokemon/001.png"</span></span>
<span><span class="co">#&gt;  $ type          : chr [1:2] "Grass" "Poison"</span></span>
<span><span class="co">#&gt;  $ height        : chr "0.71 m"</span></span>
<span><span class="co">#&gt;  $ weight        : chr "6.9 kg"</span></span>
<span><span class="co">#&gt;  $ candy         : chr "Bulbasaur Candy"</span></span>
<span><span class="co">#&gt;  $ candy_count   : int 25</span></span>
<span><span class="co">#&gt;  $ egg           : chr "2 km"</span></span>
<span><span class="co">#&gt;  $ spawn_chance  : num 0.69</span></span>
<span><span class="co">#&gt;  $ avg_spawns    : int 69</span></span>
<span><span class="co">#&gt;  $ spawn_time    : chr "20:00"</span></span>
<span><span class="co">#&gt;  $ multipliers   : num 1.58</span></span>
<span><span class="co">#&gt;  $ weaknesses    : chr [1:4] "Fire" "Ice" "Flying" "Psychic"</span></span>
<span><span class="co">#&gt;  $ next_evolution:List of 2</span></span>
<span><span class="co">#&gt;   ..$ :List of 2</span></span>
<span><span class="co">#&gt;   .. ..$ num : chr "002"</span></span>
<span><span class="co">#&gt;   .. ..$ name: chr "Ivysaur"</span></span>
<span><span class="co">#&gt;   ..$ :List of 2</span></span>
<span><span class="co">#&gt;   .. ..$ num : chr "003"</span></span>
<span><span class="co">#&gt;   .. ..$ name: chr "Venusaur"</span></span></code></pre></div>
<p>Calling <code><a href="../reference/rrapply.html">rrapply()</a></code> with <code>how = "bind</code> expands
each Pokémon sublist as a single row in a wide data.frame. The 151 rows
are stacked and aligned by matching variable names, with missing entries
replaced by <code>NA</code>’s (similar to
<code>data.table::rbindlist(..., fill = TRUE)</code>). Note that any
nested variables, such as <code>next_evolution</code> and
<code>prev_evolution</code>, are unnested as wide as possible into
individual data.frame columns similar to repeated application of
<code><a href="https://tidyr.tidyverse.org/reference/unnest_wider.html" class="external-link">tidyr::unnest_wider()</a></code> to a data.frame with nested
list-columns.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/rrapply.html">rrapply</a></span><span class="op">(</span><span class="va">pokedex</span>, how <span class="op">=</span> <span class="st">"bind"</span><span class="op">)</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">9</span><span class="op">]</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;   id num       name                                              img          type height   weight            candy candy_count</span></span>
<span><span class="co">#&gt; 1  1 001  Bulbasaur http://www.serebii.net/pokemongo/pokemon/001.png Grass, Poison 0.71 m   6.9 kg  Bulbasaur Candy          25</span></span>
<span><span class="co">#&gt; 2  2 002    Ivysaur http://www.serebii.net/pokemongo/pokemon/002.png Grass, Poison 0.99 m  13.0 kg  Bulbasaur Candy         100</span></span>
<span><span class="co">#&gt; 3  3 003   Venusaur http://www.serebii.net/pokemongo/pokemon/003.png Grass, Poison 2.01 m 100.0 kg  Bulbasaur Candy          NA</span></span>
<span><span class="co">#&gt; 4  4 004 Charmander http://www.serebii.net/pokemongo/pokemon/004.png          Fire 0.61 m   8.5 kg Charmander Candy          25</span></span>
<span><span class="co">#&gt; 5  5 005 Charmeleon http://www.serebii.net/pokemongo/pokemon/005.png          Fire 1.09 m  19.0 kg Charmander Candy         100</span></span>
<span><span class="co">#&gt; 6  6 006  Charizard http://www.serebii.net/pokemongo/pokemon/006.png  Fire, Flying 1.70 m  90.5 kg Charmander Candy          NA</span></span></code></pre></div>
<p>By default, the list layer containing the repeated observations is
identified by the minimal depth detected across leaf elements. This
option can be overridden by the <code>coldepth</code> parameter in the
<code>options</code> argument, which can be useful to unnest nested
sublists, such as <code>next_evolution</code> or
<code>prev_evolution</code>. In addition, setting
<code>namecols = TRUE</code> in the <code>options</code> argument
includes the parent list names associated to each row in the wide
data.frame as individual columns <code>L1</code>, <code>L2</code>,
etc.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## bind prev/next evolution columns</span></span>
<span><span class="fu"><a href="../reference/rrapply.html">rrapply</a></span><span class="op">(</span></span>
<span>  <span class="va">pokedex</span>, </span>
<span>  how <span class="op">=</span> <span class="st">"bind"</span>,</span>
<span>  options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>coldepth <span class="op">=</span> <span class="fl">5</span>, namecols <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt;         L1 L2             L3 L4 num       name</span></span>
<span><span class="co">#&gt; 1  pokemon  1 next_evolution  1 002    Ivysaur</span></span>
<span><span class="co">#&gt; 2  pokemon  1 next_evolution  2 003   Venusaur</span></span>
<span><span class="co">#&gt; 3  pokemon  2 prev_evolution  1 001  Bulbasaur</span></span>
<span><span class="co">#&gt; 4  pokemon  2 next_evolution  1 003   Venusaur</span></span>
<span><span class="co">#&gt; 5  pokemon  3 prev_evolution  1 001  Bulbasaur</span></span>
<span><span class="co">#&gt; 6  pokemon  3 prev_evolution  2 002    Ivysaur</span></span>
<span><span class="co">#&gt; 7  pokemon  4 next_evolution  1 005 Charmeleon</span></span>
<span><span class="co">#&gt; 8  pokemon  4 next_evolution  2 006  Charizard</span></span>
<span><span class="co">#&gt; 9  pokemon  5 prev_evolution  1 004 Charmander</span></span>
<span><span class="co">#&gt; 10 pokemon  5 next_evolution  1 006  Charizard</span></span></code></pre></div>
<div class="section level4">
<h4 id="common-alternatives">Common alternatives<a class="anchor" aria-label="anchor" href="#common-alternatives"></a>
</h4>
<p>Several common alternatives used to unnest lists containing repeated
entries include <code><a href="https://rdatatable.gitlab.io/data.table/reference/rbindlist.html" class="external-link">data.table::rbindlist()</a></code>,
<code><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">dplyr::bind_rows()</a></code>, and <code>tidyr</code>’s dedicated
rectangling functions <code><a href="https://tidyr.tidyverse.org/reference/unnest_longer.html" class="external-link">unnest_longer()</a></code>,
<code><a href="https://tidyr.tidyverse.org/reference/unnest_wider.html" class="external-link">unnest_wider()</a></code> and <code><a href="https://tidyr.tidyverse.org/reference/hoist.html" class="external-link">hoist()</a></code>.</p>
<p>The first two functions are primarily aimed at binding lists of
data.frames or lists of lists, but are not meant for nested lists
containing multiple levels of nesting, such as <code>pokedex</code>:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co">## simple list of lists</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">pokedex</span><span class="op">[[</span><span class="st">"pokemon"</span><span class="op">]</span><span class="op">]</span>, <span class="va">`[`</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 4</span></span></span>
<span><span class="co">#&gt;      id num   name       img                                             </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>     1 001   Bulbasaur  http://www.serebii.net/pokemongo/pokemon/001.png</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>     2 002   Ivysaur    http://www.serebii.net/pokemongo/pokemon/002.png</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>     3 003   Venusaur   http://www.serebii.net/pokemongo/pokemon/003.png</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>     4 004   Charmander http://www.serebii.net/pokemongo/pokemon/004.png</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>     5 005   Charmeleon http://www.serebii.net/pokemongo/pokemon/005.png</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>     6 006   Charizard  http://www.serebii.net/pokemongo/pokemon/006.png</span></span>
<span></span>
<span><span class="co">## complex nested list (error)</span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">pokedex</span><span class="op">[[</span><span class="st">"pokemon"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00; font-weight: bold;">Error</span><span style="font-weight: bold;"> in `vctrs::data_frame()`:</span></span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> Can't recycle `id` (size 2) to match `weaknesses` (size 4).</span></span>
<span></span>
<span><span class="co">## simple list of lists</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">pokedex</span><span class="op">[[</span><span class="st">"pokemon"</span><span class="op">]</span><span class="op">]</span>, <span class="va">`[`</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/rbindlist.html" class="external-link">rbindlist</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;       id    num       name                                              img</span></span>
<span><span class="co">#&gt;    &lt;int&gt; &lt;char&gt;     &lt;char&gt;                                           &lt;char&gt;</span></span>
<span><span class="co">#&gt; 1:     1    001  Bulbasaur http://www.serebii.net/pokemongo/pokemon/001.png</span></span>
<span><span class="co">#&gt; 2:     2    002    Ivysaur http://www.serebii.net/pokemongo/pokemon/002.png</span></span>
<span><span class="co">#&gt; 3:     3    003   Venusaur http://www.serebii.net/pokemongo/pokemon/003.png</span></span>
<span><span class="co">#&gt; 4:     4    004 Charmander http://www.serebii.net/pokemongo/pokemon/004.png</span></span>
<span><span class="co">#&gt; 5:     5    005 Charmeleon http://www.serebii.net/pokemongo/pokemon/005.png</span></span>
<span><span class="co">#&gt; 6:     6    006  Charizard http://www.serebii.net/pokemongo/pokemon/006.png</span></span>
<span></span>
<span><span class="co">## complex nested list (error)</span></span>
<span><span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/rbindlist.html" class="external-link">rbindlist</a></span><span class="op">(</span><span class="va">pokedex</span><span class="op">[[</span><span class="st">"pokemon"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in data.table::rbindlist(pokedex[["pokemon"]]): Column 5 of item 1 is length 2 inconsistent with column 15 which is length 4. Only length-1 columns are recycled.</span></span></code></pre></div>
<p>The rectangling functions in the <code>tidyr</code>-package offer a
lot more flexibility. A similar data.frame as returned by
<code>rrapply(pokedex, how = "bind")</code> can be obtained by repeated
application of <code><a href="https://tidyr.tidyverse.org/reference/unnest_wider.html" class="external-link">tidyr::unnest_wider()</a></code>:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tibble.tidyverse.org/" class="external-link">tibble</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="va">pokedex</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest_wider.html" class="external-link">unnest_wider</a></span><span class="op">(</span><span class="va">pokemon</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest_wider.html" class="external-link">unnest_wider</a></span><span class="op">(</span><span class="va">next_evolution</span>, names_sep <span class="op">=</span> <span class="st">"."</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest_wider.html" class="external-link">unnest_wider</a></span><span class="op">(</span><span class="va">prev_evolution</span>, names_sep <span class="op">=</span> <span class="st">"."</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest_wider.html" class="external-link">unnest_wider</a></span><span class="op">(</span><span class="va">next_evolution.1</span>, names_sep <span class="op">=</span> <span class="st">"."</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest_wider.html" class="external-link">unnest_wider</a></span><span class="op">(</span><span class="va">next_evolution.2</span>, names_sep <span class="op">=</span> <span class="st">"."</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest_wider.html" class="external-link">unnest_wider</a></span><span class="op">(</span><span class="va">next_evolution.3</span>, names_sep <span class="op">=</span> <span class="st">"."</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest_wider.html" class="external-link">unnest_wider</a></span><span class="op">(</span><span class="va">prev_evolution.1</span>, names_sep <span class="op">=</span> <span class="st">"."</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest_wider.html" class="external-link">unnest_wider</a></span><span class="op">(</span><span class="va">prev_evolution.2</span>, names_sep <span class="op">=</span> <span class="st">"."</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 25</span></span></span>
<span><span class="co">#&gt;      id num   name    img   type  height weight candy candy_count egg   spawn_chance avg_spawns spawn_time multipliers weaknesses next_evolution.1.num</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lis&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>               </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>     1 001   Bulbas… http… <span style="color: #949494;">&lt;chr&gt;</span> 0.71 m 6.9 kg Bulb…          25 2 km        0.69        69    20:00      <span style="color: #949494;">&lt;dbl [1]&gt;</span>   <span style="color: #949494;">&lt;chr [4]&gt;</span>  002                 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>     2 002   Ivysaur http… <span style="color: #949494;">&lt;chr&gt;</span> 0.99 m 13.0 … Bulb…         100 Not …       0.042        4.2  07:00      <span style="color: #949494;">&lt;dbl [2]&gt;</span>   <span style="color: #949494;">&lt;chr [4]&gt;</span>  003                 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>     3 003   Venusa… http… <span style="color: #949494;">&lt;chr&gt;</span> 2.01 m 100.0… Bulb…          <span style="color: #BB0000;">NA</span> Not …       0.017        1.7  11:30      <span style="color: #949494;">&lt;dbl [1]&gt;</span>   <span style="color: #949494;">&lt;chr [4]&gt;</span>  <span style="color: #BB0000;">NA</span>                  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>     4 004   Charma… http… <span style="color: #949494;">&lt;chr&gt;</span> 0.61 m 8.5 kg Char…          25 2 km        0.253       25.3  08:45      <span style="color: #949494;">&lt;dbl [1]&gt;</span>   <span style="color: #949494;">&lt;chr [3]&gt;</span>  005                 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>     5 005   Charme… http… <span style="color: #949494;">&lt;chr&gt;</span> 1.09 m 19.0 … Char…         100 Not …       0.012        1.2  19:00      <span style="color: #949494;">&lt;dbl [1]&gt;</span>   <span style="color: #949494;">&lt;chr [3]&gt;</span>  006                 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>     6 006   Chariz… http… <span style="color: #949494;">&lt;chr&gt;</span> 1.70 m 90.5 … Char…          <span style="color: #BB0000;">NA</span> Not …       0.003<span style="text-decoration: underline;">1</span>       0.31 13:34      <span style="color: #949494;">&lt;dbl [1]&gt;</span>   <span style="color: #949494;">&lt;chr [3]&gt;</span>  <span style="color: #BB0000;">NA</span>                  </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 9 more variables: next_evolution.1.name &lt;chr&gt;, next_evolution.2.num &lt;chr&gt;, next_evolution.2.name &lt;chr&gt;, next_evolution.3.num &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   next_evolution.3.name &lt;chr&gt;, prev_evolution.1.num &lt;chr&gt;, prev_evolution.1.name &lt;chr&gt;, prev_evolution.2.num &lt;chr&gt;, prev_evolution.2.name &lt;chr&gt;</span></span></span></code></pre></div>
<p>The option <code>how = "bind"</code> in <code><a href="../reference/rrapply.html">rrapply()</a></code> is
less flexible as it always expands the nested list to a data.frame that
is <em>as wide as possible</em>. On the other hand, the flexibility and
interpretability in <code>tidyr</code>’s rectangling functions come at
the cost of increased computational effort, which can become a
bottleneck when unnesting large nested lists:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## large replicated pokedex list </span></span>
<span><span class="va">pokedex_large</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>pokemon <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">c</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">replicate</a></span><span class="op">(</span><span class="fl">1500</span>, <span class="va">pokedex</span><span class="op">[[</span><span class="st">"pokemon"</span><span class="op">]</span><span class="op">]</span>, simplify <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/rrapply.html">rrapply</a></span><span class="op">(</span><span class="va">pokedex_large</span>, how <span class="op">=</span> <span class="st">"bind"</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="co">#&gt;    user  system elapsed </span></span>
<span><span class="co">#&gt;   2.339   0.032   2.371</span></span>
<span></span>
<span><span class="co">## unnest first layers prev_evolution and next_evolution</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="va">pokedex_large</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest_wider.html" class="external-link">unnest_wider</a></span><span class="op">(</span><span class="va">pokemon</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest_wider.html" class="external-link">unnest_wider</a></span><span class="op">(</span><span class="va">next_evolution</span>, names_sep <span class="op">=</span> <span class="st">"."</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest_wider.html" class="external-link">unnest_wider</a></span><span class="op">(</span><span class="va">prev_evolution</span>, names_sep <span class="op">=</span> <span class="st">"."</span><span class="op">)</span> </span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="co">#&gt;    user  system elapsed </span></span>
<span><span class="co">#&gt;  46.781   0.376  47.160</span></span></code></pre></div>
<p><strong>Remark</strong>: in the chained calls to
<code><a href="https://tidyr.tidyverse.org/reference/unnest_wider.html" class="external-link">unnest_wider()</a></code> above, we only unnest the first layer of the
<code>next_evolution</code> and <code>prev_evolution</code>
list-columns, and not any of the resulting children list-columns, which
would only further increase computation time.</p>
<p>To extract and unnest sublists at deeper levels of nesting in the
list, such as <code>next_evolution</code>, we manually set the
<code>coldepth</code> parameter in the <code>options</code> argument, as
also demonstrated above:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="va">ev1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rrapply.html">rrapply</a></span><span class="op">(</span></span>
<span>    <span class="va">pokedex_large</span>, </span>
<span>    condition <span class="op">=</span> \<span class="op">(</span><span class="va">x</span>, <span class="va">.xparents</span><span class="op">)</span> <span class="st">"next_evolution"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">.xparents</span>,</span>
<span>    how <span class="op">=</span> <span class="st">"bind"</span>,</span>
<span>    options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>namecols <span class="op">=</span> <span class="cn">TRUE</span>, coldepth <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="co">#&gt;    user  system elapsed </span></span>
<span><span class="co">#&gt;   1.645   0.000   1.645</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">ev1</span><span class="op">)</span></span>
<span><span class="co">#&gt;        L1 L2             L3 L4 num       name</span></span>
<span><span class="co">#&gt; 1 pokemon  1 next_evolution  1 002    Ivysaur</span></span>
<span><span class="co">#&gt; 2 pokemon  1 next_evolution  2 003   Venusaur</span></span>
<span><span class="co">#&gt; 3 pokemon  2 next_evolution  1 003   Venusaur</span></span>
<span><span class="co">#&gt; 4 pokemon  4 next_evolution  1 005 Charmeleon</span></span>
<span><span class="co">#&gt; 5 pokemon  4 next_evolution  2 006  Charizard</span></span>
<span><span class="co">#&gt; 6 pokemon  5 next_evolution  1 006  Charizard</span></span></code></pre></div>
<p>The same unnested version of the <code>next_evolution</code> sublists
can be obtained by mixing several calls to <code><a href="https://tidyr.tidyverse.org/reference/unnest_wider.html" class="external-link">unnest_wider()</a></code>
and <code><a href="https://tidyr.tidyverse.org/reference/unnest_longer.html" class="external-link">unnest_longer()</a></code>:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="va">ev2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="va">pokedex_large</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest_wider.html" class="external-link">unnest_wider</a></span><span class="op">(</span><span class="va">pokemon</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest_longer.html" class="external-link">unnest_longer</a></span><span class="op">(</span><span class="va">next_evolution</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest_wider.html" class="external-link">unnest_wider</a></span><span class="op">(</span><span class="va">next_evolution</span>, names_sep <span class="op">=</span> <span class="st">"_"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">next_evolution_num</span>, <span class="va">next_evolution_name</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="co">#&gt;    user  system elapsed </span></span>
<span><span class="co">#&gt;  33.067   0.076  33.145</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">ev2</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 3</span></span></span>
<span><span class="co">#&gt;      id next_evolution_num next_evolution_name</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>     1 002                Ivysaur            </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>     1 003                Venusaur           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>     2 003                Venusaur           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>     4 005                Charmeleon         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>     4 006                Charizard          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>     5 006                Charizard</span></span></code></pre></div>
<p>In the context of the current example, a more efficient approach is
to combine <code><a href="https://tidyr.tidyverse.org/reference/unnest_wider.html" class="external-link">unnest_wider()</a></code> with <code><a href="https://tidyr.tidyverse.org/reference/hoist.html" class="external-link">hoist()</a></code>. The
disadvantage is that we need to manually specify the exact locations of
the elements that we wish to hoist from the nested list:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="va">ev3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="va">pokedex_large</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest_wider.html" class="external-link">unnest_wider</a></span><span class="op">(</span><span class="va">pokemon</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://tidyr.tidyverse.org/reference/hoist.html" class="external-link">hoist</a></span><span class="op">(</span><span class="va">next_evolution</span>, </span>
<span>          name.1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fl">1</span>, <span class="st">"name"</span><span class="op">)</span>,</span>
<span>          name.2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fl">2</span>, <span class="st">"name"</span><span class="op">)</span>,</span>
<span>          name.3 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fl">3</span>, <span class="st">"name"</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">name.1</span>, <span class="va">name.2</span>, <span class="va">name.3</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="co">#&gt;    user  system elapsed </span></span>
<span><span class="co">#&gt;  41.292   0.088  41.382</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">ev3</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 4</span></span></span>
<span><span class="co">#&gt;      id name.1     name.2    name.3</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>     1 Ivysaur    Venusaur  <span style="color: #BB0000;">NA</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>     2 Venusaur   <span style="color: #BB0000;">NA</span>        <span style="color: #BB0000;">NA</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>     3 <span style="color: #BB0000;">NA</span>         <span style="color: #BB0000;">NA</span>        <span style="color: #BB0000;">NA</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>     4 Charmeleon Charizard <span style="color: #BB0000;">NA</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>     5 Charizard  <span style="color: #BB0000;">NA</span>        <span style="color: #BB0000;">NA</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>     6 <span style="color: #BB0000;">NA</span>         <span style="color: #BB0000;">NA</span>        <span style="color: #BB0000;">NA</span></span></span></code></pre></div>
<p>Using <code><a href="../reference/rrapply.html">rrapply()</a></code>, the same result can be obtained by
adding a call to <code><a href="https://rdrr.io/r/stats/reshape.html" class="external-link">reshape()</a></code> (or alternatively
e.g. <code><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">tidyr::pivot_wider()</a></code> or
<code><a href="https://rdatatable.gitlab.io/data.table/reference/dcast.data.table.html" class="external-link">data.table::dcast()</a></code>) by converting from a long to a wide
data.frame:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="va">ev4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rrapply.html">rrapply</a></span><span class="op">(</span></span>
<span>    <span class="va">pokedex_large</span>, </span>
<span>    condition <span class="op">=</span> \<span class="op">(</span><span class="va">x</span>, <span class="va">.xparents</span><span class="op">)</span> <span class="st">"next_evolution"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">.xparents</span>,</span>
<span>    how <span class="op">=</span> <span class="st">"bind"</span>, </span>
<span>    options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>namecols <span class="op">=</span> <span class="cn">TRUE</span>, coldepth <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span>  <span class="op">)</span> </span>
<span>  <span class="va">ev5</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/reshape.html" class="external-link">reshape</a></span><span class="op">(</span></span>
<span>    <span class="va">ev4</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"L2"</span>, <span class="st">"L4"</span>, <span class="st">"name"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>    idvar <span class="op">=</span> <span class="st">"L2"</span>,</span>
<span>    timevar <span class="op">=</span> <span class="st">"L4"</span>,</span>
<span>    v.names <span class="op">=</span> <span class="st">"name"</span>,</span>
<span>    direction <span class="op">=</span> <span class="st">"wide"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="co">#&gt;    user  system elapsed </span></span>
<span><span class="co">#&gt;   2.431   0.000   2.432</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">ev5</span><span class="op">)</span></span>
<span><span class="co">#&gt;   L2     name.1    name.2 name.3</span></span>
<span><span class="co">#&gt; 1  1    Ivysaur  Venusaur   &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 3  2   Venusaur      &lt;NA&gt;   &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 4  4 Charmeleon Charizard   &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 6  5  Charizard      &lt;NA&gt;   &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 7  7  Wartortle Blastoise   &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 9  8  Blastoise      &lt;NA&gt;   &lt;NA&gt;</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="additional-examples">Additional examples<a class="anchor" aria-label="anchor" href="#additional-examples"></a>
</h4>
<p>We conclude this section by replicating some of the data rectangling
examples presented in the <code>tidyr</code> vignette: <a href="https://tidyr.tidyverse.org/articles/rectangle.html" class="external-link uri">https://tidyr.tidyverse.org/articles/rectangle.html</a>. The
example nested lists are all conveniently included in the <a href="https://CRAN.R-project.org/package=repurrrsive" class="external-link">repurrrsive</a>-package.</p>
<div class="section level5">
<h5 id="github-users">GitHub Users<a class="anchor" aria-label="anchor" href="#github-users"></a>
</h5>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://jennybc.github.io/repurrrsive/" class="external-link">repurrrsive</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co">## nested data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">gh_users</span>, list.len <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 6</span></span>
<span><span class="co">#&gt;  $ :List of 30</span></span>
<span><span class="co">#&gt;   ..$ login              : chr "gaborcsardi"</span></span>
<span><span class="co">#&gt;   ..$ id                 : int 660288</span></span>
<span><span class="co">#&gt;   ..$ avatar_url         : chr "https://avatars.githubusercontent.com/u/660288?v=3"</span></span>
<span><span class="co">#&gt;   .. [list output truncated]</span></span>
<span><span class="co">#&gt;  $ :List of 30</span></span>
<span><span class="co">#&gt;   ..$ login              : chr "jennybc"</span></span>
<span><span class="co">#&gt;   ..$ id                 : int 599454</span></span>
<span><span class="co">#&gt;   ..$ avatar_url         : chr "https://avatars.githubusercontent.com/u/599454?v=3"</span></span>
<span><span class="co">#&gt;   .. [list output truncated]</span></span>
<span><span class="co">#&gt;  $ :List of 30</span></span>
<span><span class="co">#&gt;   ..$ login              : chr "jtleek"</span></span>
<span><span class="co">#&gt;   ..$ id                 : int 1571674</span></span>
<span><span class="co">#&gt;   ..$ avatar_url         : chr "https://avatars.githubusercontent.com/u/1571674?v=3"</span></span>
<span><span class="co">#&gt;   .. [list output truncated]</span></span>
<span><span class="co">#&gt;   [list output truncated]</span></span>
<span></span>
<span><span class="co">## unnested version</span></span>
<span><span class="fu"><a href="../reference/rrapply.html">rrapply</a></span><span class="op">(</span><span class="va">gh_users</span>, how <span class="op">=</span> <span class="st">"bind"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 30</span></span></span>
<span><span class="co">#&gt;   login       id avatar_url gravatar_id url   html_url followers_url following_url gists_url starred_url subscriptions_url organizations_url repos_url</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> gaborc… 6.60<span style="color: #949494;">e</span>5 https://a… <span style="color: #949494;">""</span>          http… https:/… https://api.… https://api.… https://… https://ap… https://api.gith… https://api.gith… https://…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> jennybc 5.99<span style="color: #949494;">e</span>5 https://a… <span style="color: #949494;">""</span>          http… https:/… https://api.… https://api.… https://… https://ap… https://api.gith… https://api.gith… https://…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> jtleek  1.57<span style="color: #949494;">e</span>6 https://a… <span style="color: #949494;">""</span>          http… https:/… https://api.… https://api.… https://… https://ap… https://api.gith… https://api.gith… https://…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> julias… 1.25<span style="color: #949494;">e</span>7 https://a… <span style="color: #949494;">""</span>          http… https:/… https://api.… https://api.… https://… https://ap… https://api.gith… https://api.gith… https://…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> leeper  3.51<span style="color: #949494;">e</span>6 https://a… <span style="color: #949494;">""</span>          http… https:/… https://api.… https://api.… https://… https://ap… https://api.gith… https://api.gith… https://…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> masalm… 8.36<span style="color: #949494;">e</span>6 https://a… <span style="color: #949494;">""</span>          http… https:/… https://api.… https://api.… https://… https://ap… https://api.gith… https://api.gith… https://…</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 17 more variables: events_url &lt;chr&gt;, received_events_url &lt;chr&gt;, type &lt;chr&gt;, site_admin &lt;lgl&gt;, name &lt;chr&gt;, company &lt;list&gt;, blog &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   location &lt;chr&gt;, email &lt;list&gt;, hireable &lt;list&gt;, bio &lt;list&gt;, public_repos &lt;int&gt;, public_gists &lt;int&gt;, followers &lt;int&gt;, following &lt;int&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   created_at &lt;chr&gt;, updated_at &lt;chr&gt;</span></span></span></code></pre></div>
</div>
<div class="section level5">
<h5 id="github-repos">GitHub repos<a class="anchor" aria-label="anchor" href="#github-repos"></a>
</h5>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## nested data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">gh_repos</span>, list.len <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 6</span></span>
<span><span class="co">#&gt;  $ :List of 30</span></span>
<span><span class="co">#&gt;   ..$ :List of 68</span></span>
<span><span class="co">#&gt;   .. ..$ id               : int 61160198</span></span>
<span><span class="co">#&gt;   .. ..$ name             : chr "after"</span></span>
<span><span class="co">#&gt;   .. .. [list output truncated]</span></span>
<span><span class="co">#&gt;   ..$ :List of 68</span></span>
<span><span class="co">#&gt;   .. ..$ id               : int 40500181</span></span>
<span><span class="co">#&gt;   .. ..$ name             : chr "argufy"</span></span>
<span><span class="co">#&gt;   .. .. [list output truncated]</span></span>
<span><span class="co">#&gt;   .. [list output truncated]</span></span>
<span><span class="co">#&gt;  $ :List of 30</span></span>
<span><span class="co">#&gt;   ..$ :List of 68</span></span>
<span><span class="co">#&gt;   .. ..$ id               : int 14756210</span></span>
<span><span class="co">#&gt;   .. ..$ name             : chr "2013-11_sfu"</span></span>
<span><span class="co">#&gt;   .. .. [list output truncated]</span></span>
<span><span class="co">#&gt;   ..$ :List of 68</span></span>
<span><span class="co">#&gt;   .. ..$ id               : int 14152301</span></span>
<span><span class="co">#&gt;   .. ..$ name             : chr "2014-01-27-miami"</span></span>
<span><span class="co">#&gt;   .. .. [list output truncated]</span></span>
<span><span class="co">#&gt;   .. [list output truncated]</span></span>
<span><span class="co">#&gt;   [list output truncated]</span></span>
<span></span>
<span><span class="co">## unnested version</span></span>
<span><span class="fu"><a href="../reference/rrapply.html">rrapply</a></span><span class="op">(</span><span class="va">gh_repos</span>, how <span class="op">=</span> <span class="st">"bind"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 176 × 84</span></span></span>
<span><span class="co">#&gt;          id name    full_name owner.login owner.id owner.avatar_url owner.gravatar_id owner.url owner.html_url owner.followers_url owner.following_url</span></span>
<span><span class="co">#&gt;       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>               <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 61<span style="text-decoration: underline;">160</span>198 after   gaborcsa… gaborcsardi   <span style="text-decoration: underline;">660</span>288 https://avatars… <span style="color: #949494;">""</span>                https://… https://githu… https://api.github… https://api.github…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 40<span style="text-decoration: underline;">500</span>181 argufy  gaborcsa… gaborcsardi   <span style="text-decoration: underline;">660</span>288 https://avatars… <span style="color: #949494;">""</span>                https://… https://githu… https://api.github… https://api.github…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 36<span style="text-decoration: underline;">442</span>442 ask     gaborcsa… gaborcsardi   <span style="text-decoration: underline;">660</span>288 https://avatars… <span style="color: #949494;">""</span>                https://… https://githu… https://api.github… https://api.github…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 34<span style="text-decoration: underline;">924</span>886 baseim… gaborcsa… gaborcsardi   <span style="text-decoration: underline;">660</span>288 https://avatars… <span style="color: #949494;">""</span>                https://… https://githu… https://api.github… https://api.github…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 61<span style="text-decoration: underline;">620</span>661 citest  gaborcsa… gaborcsardi   <span style="text-decoration: underline;">660</span>288 https://avatars… <span style="color: #949494;">""</span>                https://… https://githu… https://api.github… https://api.github…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 33<span style="text-decoration: underline;">907</span>457 clisym… gaborcsa… gaborcsardi   <span style="text-decoration: underline;">660</span>288 https://avatars… <span style="color: #949494;">""</span>                https://… https://githu… https://api.github… https://api.github…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 37<span style="text-decoration: underline;">236</span>467 cmaker  gaborcsa… gaborcsardi   <span style="text-decoration: underline;">660</span>288 https://avatars… <span style="color: #949494;">""</span>                https://… https://githu… https://api.github… https://api.github…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 67<span style="text-decoration: underline;">959</span>624 cmark   gaborcsa… gaborcsardi   <span style="text-decoration: underline;">660</span>288 https://avatars… <span style="color: #949494;">""</span>                https://… https://githu… https://api.github… https://api.github…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 63<span style="text-decoration: underline;">152</span>619 condit… gaborcsa… gaborcsardi   <span style="text-decoration: underline;">660</span>288 https://avatars… <span style="color: #949494;">""</span>                https://… https://githu… https://api.github… https://api.github…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 24<span style="text-decoration: underline;">343</span>686 crayon  gaborcsa… gaborcsardi   <span style="text-decoration: underline;">660</span>288 https://avatars… <span style="color: #949494;">""</span>                https://… https://githu… https://api.github… https://api.github…</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 166 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 73 more variables: owner.gists_url &lt;chr&gt;, owner.starred_url &lt;chr&gt;, owner.subscriptions_url &lt;chr&gt;, owner.organizations_url &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   owner.repos_url &lt;chr&gt;, owner.events_url &lt;chr&gt;, owner.received_events_url &lt;chr&gt;, owner.type &lt;chr&gt;, owner.site_admin &lt;lgl&gt;, private &lt;lgl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   html_url &lt;chr&gt;, description &lt;list&gt;, fork &lt;lgl&gt;, url &lt;chr&gt;, forks_url &lt;chr&gt;, keys_url &lt;chr&gt;, collaborators_url &lt;chr&gt;, teams_url &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   hooks_url &lt;chr&gt;, issue_events_url &lt;chr&gt;, events_url &lt;chr&gt;, assignees_url &lt;chr&gt;, branches_url &lt;chr&gt;, tags_url &lt;chr&gt;, blobs_url &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   git_tags_url &lt;chr&gt;, git_refs_url &lt;chr&gt;, trees_url &lt;chr&gt;, statuses_url &lt;chr&gt;, languages_url &lt;chr&gt;, stargazers_url &lt;chr&gt;, contributors_url &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   subscribers_url &lt;chr&gt;, subscription_url &lt;chr&gt;, commits_url &lt;chr&gt;, git_commits_url &lt;chr&gt;, comments_url &lt;chr&gt;, issue_comment_url &lt;chr&gt;, …</span></span></span></code></pre></div>
</div>
<div class="section level5">
<h5 id="game-of-thrones-characters">Game of Thrones characters<a class="anchor" aria-label="anchor" href="#game-of-thrones-characters"></a>
</h5>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## nested data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">got_chars</span>, list.len <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 30</span></span>
<span><span class="co">#&gt;  $ :List of 18</span></span>
<span><span class="co">#&gt;   ..$ url        : chr "https://www.anapioficeandfire.com/api/characters/1022"</span></span>
<span><span class="co">#&gt;   ..$ id         : int 1022</span></span>
<span><span class="co">#&gt;   ..$ name       : chr "Theon Greyjoy"</span></span>
<span><span class="co">#&gt;   .. [list output truncated]</span></span>
<span><span class="co">#&gt;  $ :List of 18</span></span>
<span><span class="co">#&gt;   ..$ url        : chr "https://www.anapioficeandfire.com/api/characters/1052"</span></span>
<span><span class="co">#&gt;   ..$ id         : int 1052</span></span>
<span><span class="co">#&gt;   ..$ name       : chr "Tyrion Lannister"</span></span>
<span><span class="co">#&gt;   .. [list output truncated]</span></span>
<span><span class="co">#&gt;  $ :List of 18</span></span>
<span><span class="co">#&gt;   ..$ url        : chr "https://www.anapioficeandfire.com/api/characters/1074"</span></span>
<span><span class="co">#&gt;   ..$ id         : int 1074</span></span>
<span><span class="co">#&gt;   ..$ name       : chr "Victarion Greyjoy"</span></span>
<span><span class="co">#&gt;   .. [list output truncated]</span></span>
<span><span class="co">#&gt;   [list output truncated]</span></span>
<span></span>
<span><span class="co">## unnested version</span></span>
<span><span class="fu"><a href="../reference/rrapply.html">rrapply</a></span><span class="op">(</span><span class="va">got_chars</span>, how <span class="op">=</span> <span class="st">"bind"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 30 × 18</span></span></span>
<span><span class="co">#&gt;    url                      id name  gender culture born  died  alive titles aliases father mother spouse allegiances books povBooks tvSeries playedBy</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                 <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;list&gt;</span> <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;lis&gt;</span> <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> https://www.anapiofi…  <span style="text-decoration: underline;">1</span>022 Theo… Male   <span style="color: #949494;">"</span>Ironb… <span style="color: #949494;">"</span>In … <span style="color: #949494;">""</span>    TRUE  <span style="color: #949494;">&lt;chr&gt;</span>  <span style="color: #949494;">&lt;chr&gt;</span>   <span style="color: #949494;">""</span>     <span style="color: #949494;">""</span>     <span style="color: #949494;">""</span>     <span style="color: #949494;">&lt;chr [1]&gt;</span>   <span style="color: #949494;">&lt;chr&gt;</span> <span style="color: #949494;">&lt;chr&gt;</span>    <span style="color: #949494;">&lt;chr&gt;</span>    <span style="color: #949494;">&lt;chr&gt;</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> https://www.anapiofi…  <span style="text-decoration: underline;">1</span>052 Tyri… Male   <span style="color: #949494;">""</span>      <span style="color: #949494;">"</span>In … <span style="color: #949494;">""</span>    TRUE  <span style="color: #949494;">&lt;chr&gt;</span>  <span style="color: #949494;">&lt;chr&gt;</span>   <span style="color: #949494;">""</span>     <span style="color: #949494;">""</span>     <span style="color: #949494;">"</span>http… <span style="color: #949494;">&lt;chr [1]&gt;</span>   <span style="color: #949494;">&lt;chr&gt;</span> <span style="color: #949494;">&lt;chr&gt;</span>    <span style="color: #949494;">&lt;chr&gt;</span>    <span style="color: #949494;">&lt;chr&gt;</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> https://www.anapiofi…  <span style="text-decoration: underline;">1</span>074 Vict… Male   <span style="color: #949494;">"</span>Ironb… <span style="color: #949494;">"</span>In … <span style="color: #949494;">""</span>    TRUE  <span style="color: #949494;">&lt;chr&gt;</span>  <span style="color: #949494;">&lt;chr&gt;</span>   <span style="color: #949494;">""</span>     <span style="color: #949494;">""</span>     <span style="color: #949494;">""</span>     <span style="color: #949494;">&lt;chr [1]&gt;</span>   <span style="color: #949494;">&lt;chr&gt;</span> <span style="color: #949494;">&lt;chr&gt;</span>    <span style="color: #949494;">&lt;chr&gt;</span>    <span style="color: #949494;">&lt;chr&gt;</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> https://www.anapiofi…  <span style="text-decoration: underline;">1</span>109 Will  Male   <span style="color: #949494;">""</span>      <span style="color: #949494;">""</span>    <span style="color: #949494;">"</span>In … FALSE <span style="color: #949494;">&lt;chr&gt;</span>  <span style="color: #949494;">&lt;chr&gt;</span>   <span style="color: #949494;">""</span>     <span style="color: #949494;">""</span>     <span style="color: #949494;">""</span>     <span style="color: #949494;">&lt;lgl [1]&gt;</span>   <span style="color: #949494;">&lt;chr&gt;</span> <span style="color: #949494;">&lt;chr&gt;</span>    <span style="color: #949494;">&lt;chr&gt;</span>    <span style="color: #949494;">&lt;chr&gt;</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> https://www.anapiofi…  <span style="text-decoration: underline;">1</span>166 Areo… Male   <span style="color: #949494;">"</span>Norvo… <span style="color: #949494;">"</span>In … <span style="color: #949494;">""</span>    TRUE  <span style="color: #949494;">&lt;chr&gt;</span>  <span style="color: #949494;">&lt;chr&gt;</span>   <span style="color: #949494;">""</span>     <span style="color: #949494;">""</span>     <span style="color: #949494;">""</span>     <span style="color: #949494;">&lt;chr [1]&gt;</span>   <span style="color: #949494;">&lt;chr&gt;</span> <span style="color: #949494;">&lt;chr&gt;</span>    <span style="color: #949494;">&lt;chr&gt;</span>    <span style="color: #949494;">&lt;chr&gt;</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> https://www.anapiofi…  <span style="text-decoration: underline;">1</span>267 Chett Male   <span style="color: #949494;">""</span>      <span style="color: #949494;">"</span>At … <span style="color: #949494;">"</span>In … FALSE <span style="color: #949494;">&lt;chr&gt;</span>  <span style="color: #949494;">&lt;chr&gt;</span>   <span style="color: #949494;">""</span>     <span style="color: #949494;">""</span>     <span style="color: #949494;">""</span>     <span style="color: #949494;">&lt;lgl [1]&gt;</span>   <span style="color: #949494;">&lt;chr&gt;</span> <span style="color: #949494;">&lt;chr&gt;</span>    <span style="color: #949494;">&lt;chr&gt;</span>    <span style="color: #949494;">&lt;chr&gt;</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> https://www.anapiofi…  <span style="text-decoration: underline;">1</span>295 Cres… Male   <span style="color: #949494;">""</span>      <span style="color: #949494;">"</span>In … <span style="color: #949494;">"</span>In … FALSE <span style="color: #949494;">&lt;chr&gt;</span>  <span style="color: #949494;">&lt;chr&gt;</span>   <span style="color: #949494;">""</span>     <span style="color: #949494;">""</span>     <span style="color: #949494;">""</span>     <span style="color: #949494;">&lt;lgl [1]&gt;</span>   <span style="color: #949494;">&lt;chr&gt;</span> <span style="color: #949494;">&lt;chr&gt;</span>    <span style="color: #949494;">&lt;chr&gt;</span>    <span style="color: #949494;">&lt;chr&gt;</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> https://www.anapiofi…   130 Aria… Female <span style="color: #949494;">"</span>Dorni… <span style="color: #949494;">"</span>In … <span style="color: #949494;">""</span>    TRUE  <span style="color: #949494;">&lt;chr&gt;</span>  <span style="color: #949494;">&lt;chr&gt;</span>   <span style="color: #949494;">""</span>     <span style="color: #949494;">""</span>     <span style="color: #949494;">""</span>     <span style="color: #949494;">&lt;chr [1]&gt;</span>   <span style="color: #949494;">&lt;chr&gt;</span> <span style="color: #949494;">&lt;chr&gt;</span>    <span style="color: #949494;">&lt;chr&gt;</span>    <span style="color: #949494;">&lt;chr&gt;</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> https://www.anapiofi…  <span style="text-decoration: underline;">1</span>303 Daen… Female <span style="color: #949494;">"</span>Valyr… <span style="color: #949494;">"</span>In … <span style="color: #949494;">""</span>    TRUE  <span style="color: #949494;">&lt;chr&gt;</span>  <span style="color: #949494;">&lt;chr&gt;</span>   <span style="color: #949494;">""</span>     <span style="color: #949494;">""</span>     <span style="color: #949494;">"</span>http… <span style="color: #949494;">&lt;chr [1]&gt;</span>   <span style="color: #949494;">&lt;chr&gt;</span> <span style="color: #949494;">&lt;chr&gt;</span>    <span style="color: #949494;">&lt;chr&gt;</span>    <span style="color: #949494;">&lt;chr&gt;</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> https://www.anapiofi…  <span style="text-decoration: underline;">1</span>319 Davo… Male   <span style="color: #949494;">"</span>Weste… <span style="color: #949494;">"</span>In … <span style="color: #949494;">""</span>    TRUE  <span style="color: #949494;">&lt;chr&gt;</span>  <span style="color: #949494;">&lt;chr&gt;</span>   <span style="color: #949494;">""</span>     <span style="color: #949494;">""</span>     <span style="color: #949494;">"</span>http… <span style="color: #949494;">&lt;chr [2]&gt;</span>   <span style="color: #949494;">&lt;chr&gt;</span> <span style="color: #949494;">&lt;chr&gt;</span>    <span style="color: #949494;">&lt;chr&gt;</span>    <span style="color: #949494;">&lt;chr&gt;</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 20 more rows</span></span></span></code></pre></div>
</div>
<div class="section level5">
<h5 id="sharla-gelfands-discography">Sharla Gelfand’s discography<a class="anchor" aria-label="anchor" href="#sharla-gelfands-discography"></a>
</h5>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## nested data (first element)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">discog</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, list.len <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 1</span></span>
<span><span class="co">#&gt;  $ :List of 5</span></span>
<span><span class="co">#&gt;   ..$ instance_id      : int 354823933</span></span>
<span><span class="co">#&gt;   ..$ date_added       : chr "2019-02-16T17:48:59-08:00"</span></span>
<span><span class="co">#&gt;   ..$ basic_information:List of 11</span></span>
<span><span class="co">#&gt;   .. ..$ labels      :List of 1</span></span>
<span><span class="co">#&gt;   .. .. ..$ :List of 6</span></span>
<span><span class="co">#&gt;   .. .. .. ..$ name            : chr "Tobi Records (2)"</span></span>
<span><span class="co">#&gt;   .. .. .. ..$ entity_type     : chr "1"</span></span>
<span><span class="co">#&gt;   .. .. .. ..$ catno           : chr "TOB-013"</span></span>
<span><span class="co">#&gt;   .. .. .. .. [list output truncated]</span></span>
<span><span class="co">#&gt;   .. ..$ year        : int 2015</span></span>
<span><span class="co">#&gt;   .. ..$ master_url  : NULL</span></span>
<span><span class="co">#&gt;   .. .. [list output truncated]</span></span>
<span><span class="co">#&gt;   .. [list output truncated]</span></span>
<span></span>
<span><span class="co">## unnested version (excluding deeply nested sublists)</span></span>
<span><span class="va">discs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rrapply.html">rrapply</a></span><span class="op">(</span></span>
<span>  <span class="va">discog</span>,</span>
<span>  condition <span class="op">=</span> \<span class="op">(</span><span class="va">x</span>, <span class="va">.xpos</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">.xpos</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">5</span>,</span>
<span>  f <span class="op">=</span> \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, <span class="cn">NA</span>, <span class="va">x</span><span class="op">)</span>,  <span class="co">## replace NULLs</span></span>
<span>  how <span class="op">=</span> <span class="st">"bind"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="va">discs</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 155 × 12</span></span></span>
<span><span class="co">#&gt;    instance_id date_added             basic_information.year basic_information.ma…¹ basic_information.id basic_information.th…² basic_information.ti…³</span></span>
<span><span class="co">#&gt;          <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                 <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>   354<span style="text-decoration: underline;">823</span>933 2019-02-16T17:48:59-0…                   <span style="text-decoration: underline;">2</span>015 <span style="color: #BB0000;">NA</span>                                  7<span style="text-decoration: underline;">496</span>378 <span style="color: #949494;">"</span>https://img.discogs.… Demo                  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>   354<span style="text-decoration: underline;">092</span>601 2019-02-13T14:13:11-0…                   <span style="text-decoration: underline;">2</span>013 https://api.discogs.c…              4<span style="text-decoration: underline;">490</span>852 <span style="color: #949494;">"</span>https://img.discogs.… Observant Com El Mon …</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>   354<span style="text-decoration: underline;">091</span>476 2019-02-13T14:07:23-0…                   <span style="text-decoration: underline;">2</span>017 https://api.discogs.c…              9<span style="text-decoration: underline;">827</span>276 <span style="color: #949494;">"</span>https://img.discogs.… I                     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>   351<span style="text-decoration: underline;">244</span>906 2019-02-02T11:39:58-0…                   <span style="text-decoration: underline;">2</span>017 https://api.discogs.c…              9<span style="text-decoration: underline;">769</span>203 <span style="color: #949494;">"</span>https://img.discogs.… Oído Absoluto         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>   351<span style="text-decoration: underline;">244</span>801 2019-02-02T11:39:37-0…                   <span style="text-decoration: underline;">2</span>015 https://api.discogs.c…              7<span style="text-decoration: underline;">237</span>138 <span style="color: #949494;">"</span>https://img.discogs.… A Cat's Cause, No Dog…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>   351<span style="text-decoration: underline;">052</span>065 2019-02-01T20:40:53-0…                   <span style="text-decoration: underline;">2</span>019 https://api.discogs.c…             13<span style="text-decoration: underline;">117</span>042 <span style="color: #949494;">"</span>https://img.discogs.… Tashme                </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>   350<span style="text-decoration: underline;">315</span>345 2019-01-29T15:48:37-0…                   <span style="text-decoration: underline;">2</span>014 https://api.discogs.c…              7<span style="text-decoration: underline;">113</span>575 <span style="color: #949494;">"</span>https://img.discogs.… Demo                  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>   350<span style="text-decoration: underline;">315</span>103 2019-01-29T15:47:22-0…                   <span style="text-decoration: underline;">2</span>015 https://api.discogs.c…             10<span style="text-decoration: underline;">540</span>713 <span style="color: #949494;">"</span>https://img.discogs.… Let The Miracles Begin</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>   350<span style="text-decoration: underline;">314</span>507 2019-01-29T15:44:08-0…                   <span style="text-decoration: underline;">2</span>017 https://api.discogs.c…             11<span style="text-decoration: underline;">260</span>950 <span style="color: #949494;">""</span>                     Sub Space             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>   350<span style="text-decoration: underline;">314</span>047 2019-01-29T15:41:35-0…                   <span style="text-decoration: underline;">2</span>017 <span style="color: #BB0000;">NA</span>                                 11<span style="text-decoration: underline;">726</span>853 <span style="color: #949494;">"</span>https://img.discogs.… Demo                  </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 145 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ abbreviated names: ¹​basic_information.master_url, ²​basic_information.thumb, ³​basic_information.title</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 5 more variables: basic_information.cover_image &lt;chr&gt;, basic_information.resource_url &lt;chr&gt;, basic_information.master_id &lt;int&gt;, id &lt;int&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   rating &lt;int&gt;</span></span></span>
<span></span>
<span><span class="co">## unnest labels sublists </span></span>
<span><span class="va">labels</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rrapply.html">rrapply</a></span><span class="op">(</span></span>
<span>  <span class="va">discog</span>,</span>
<span>  condition <span class="op">=</span> \<span class="op">(</span><span class="va">x</span>, <span class="va">.xparents</span><span class="op">)</span> <span class="st">"labels"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">.xparents</span>,</span>
<span>  how <span class="op">=</span> <span class="st">"bind"</span>,</span>
<span>  options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>coldepth <span class="op">=</span> <span class="fl">5</span>, namecols <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="va">labels</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 182 × 10</span></span></span>
<span><span class="co">#&gt;    L1    L2                L3     L4    name                                      entity_type catno   resource_url                 id entity_type_name</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 1     basic_information labels 1     Tobi Records (2)                          1           TOB-013 https://api.discogs.com… <span style="text-decoration: underline;">633</span>407 Label           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 2     basic_information labels 1     La Vida Es Un Mus                         1           Mus70   https://api.discogs.com…  <span style="text-decoration: underline;">38</span>322 Label           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 3     basic_information labels 1     La Vida Es Un Mus                         1           MUS118  https://api.discogs.com…  <span style="text-decoration: underline;">38</span>322 Label           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 4     basic_information labels 1     La Vida Es Un Mus                         1           MUS132  https://api.discogs.com…  <span style="text-decoration: underline;">38</span>322 Label           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 4     basic_information labels 2     Beat Generation                           1           BEAT64  https://api.discogs.com…  <span style="text-decoration: underline;">88</span>198 Label           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 4     basic_information labels 3     Beat Generation                           1           BEAT 64 https://api.discogs.com…  <span style="text-decoration: underline;">88</span>198 Label           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 5     basic_information labels 1     Katorga Works                             1           KW-043  https://api.discogs.com… <span style="text-decoration: underline;">205</span>895 Label           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 6     basic_information labels 1     High Fashion Industries                   1           HFI017  https://api.discogs.com… <span style="text-decoration: underline;">637</span>837 Label           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 7     basic_information labels 1     Mind Control Records (6)                  1           none    https://api.discogs.com… <span style="text-decoration: underline;">763</span>103 Label           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 8     basic_information labels 1     Not On Label (Phantom Head Self-released) 1           none    https://api.discogs.com… <span style="text-decoration: underline;">879</span>916 Label           </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 172 more rows</span></span></span>
<span></span>
<span><span class="co">## merge disc id's with labels</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>L1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">discs</span><span class="op">)</span>, disc_id <span class="op">=</span> <span class="va">discs</span><span class="op">[</span>, <span class="st">"id"</span><span class="op">]</span><span class="op">)</span>,</span>
<span>  y <span class="op">=</span> <span class="va">labels</span>, </span>
<span>  by <span class="op">=</span> <span class="st">"L1"</span>, </span>
<span>  sort <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 182 × 11</span></span></span>
<span><span class="co">#&gt;    L1     disc_id L2                L3     L4    name                                      entity_type catno   resource_url        id entity_type_name</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 1      7<span style="text-decoration: underline;">496</span>378 basic_information labels 1     Tobi Records (2)                          1           TOB-013 https://api.di… <span style="text-decoration: underline;">633</span>407 Label           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 2      4<span style="text-decoration: underline;">490</span>852 basic_information labels 1     La Vida Es Un Mus                         1           Mus70   https://api.di…  <span style="text-decoration: underline;">38</span>322 Label           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 3      9<span style="text-decoration: underline;">827</span>276 basic_information labels 1     La Vida Es Un Mus                         1           MUS118  https://api.di…  <span style="text-decoration: underline;">38</span>322 Label           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 4      9<span style="text-decoration: underline;">769</span>203 basic_information labels 1     La Vida Es Un Mus                         1           MUS132  https://api.di…  <span style="text-decoration: underline;">38</span>322 Label           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 4      9<span style="text-decoration: underline;">769</span>203 basic_information labels 2     Beat Generation                           1           BEAT64  https://api.di…  <span style="text-decoration: underline;">88</span>198 Label           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 4      9<span style="text-decoration: underline;">769</span>203 basic_information labels 3     Beat Generation                           1           BEAT 64 https://api.di…  <span style="text-decoration: underline;">88</span>198 Label           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 5      7<span style="text-decoration: underline;">237</span>138 basic_information labels 1     Katorga Works                             1           KW-043  https://api.di… <span style="text-decoration: underline;">205</span>895 Label           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 6     13<span style="text-decoration: underline;">117</span>042 basic_information labels 1     High Fashion Industries                   1           HFI017  https://api.di… <span style="text-decoration: underline;">637</span>837 Label           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 7      7<span style="text-decoration: underline;">113</span>575 basic_information labels 1     Mind Control Records (6)                  1           none    https://api.di… <span style="text-decoration: underline;">763</span>103 Label           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 8     10<span style="text-decoration: underline;">540</span>713 basic_information labels 1     Not On Label (Phantom Head Self-released) 1           none    https://api.di… <span style="text-decoration: underline;">879</span>916 Label           </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 172 more rows</span></span></span></code></pre></div>
</div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="data-frame-to-nested-list">Data.frame to nested list<a class="anchor" aria-label="anchor" href="#data-frame-to-nested-list"></a>
</h2>
<p>As a demonstrating example, we reconsider the long data.frame from
the first section obtained after melting the renewable energy shares of
all Western European countries:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">renewable_energy_melt_west_eu</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rrapply.html">rrapply</a></span><span class="op">(</span></span>
<span>  <span class="va">renewable_energy_by_country</span>,</span>
<span>  condition <span class="op">=</span> \<span class="op">(</span><span class="va">x</span>, <span class="va">.xparents</span><span class="op">)</span> <span class="st">"Western Europe"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">.xparents</span>,</span>
<span>  how <span class="op">=</span> <span class="st">"melt"</span></span>
<span><span class="op">)</span> </span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">renewable_energy_melt_west_eu</span>, n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt;      L1     L2             L3            L4 value</span></span>
<span><span class="co">#&gt; 1 World Europe Western Europe       Austria 34.67</span></span>
<span><span class="co">#&gt; 2 World Europe Western Europe       Belgium  9.14</span></span>
<span><span class="co">#&gt; 3 World Europe Western Europe        France 14.74</span></span>
<span><span class="co">#&gt; 4 World Europe Western Europe       Germany 14.17</span></span>
<span><span class="co">#&gt; 5 World Europe Western Europe Liechtenstein 62.93</span></span>
<span><span class="co">#&gt; 6 World Europe Western Europe    Luxembourg 13.54</span></span>
<span><span class="co">#&gt; 7 World Europe Western Europe        Monaco    NA</span></span>
<span><span class="co">#&gt; 8 World Europe Western Europe   Netherlands  5.78</span></span>
<span><span class="co">#&gt; 9 World Europe Western Europe   Switzerland 25.49</span></span></code></pre></div>
<p>For certain tasks, it may be necessary to convert this data.frame
back to a nested list object, e.g. to write the data to a JSON- or
XML-object or for some tree visualization purpose. Writing a recursive
function to reconstruct the nested list can prove to be quite
time-consuming and error-prone.</p>
<p>In this context, the <code><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist()</a></code> function has an inverse
counterpart <code><a href="https://rdrr.io/r/utils/relist.html" class="external-link">relist()</a></code> that reconstructs a nested list from
the unlisted vector. The <code><a href="https://rdrr.io/r/utils/relist.html" class="external-link">relist()</a></code> function always requires
a <code>skeleton</code> nested list to repopulate, which can make it
difficult to use in practice, as such a <code>skeleton</code> object is
for instance unavailable for the current example. In particular, the
melted data.frame contains only a subset of the original list elements,
so we can not use the original list as a template object without
filtering nodes from the original list as well.</p>
<div class="section level3">
<h3 id="unmelt-to-nested-list">Unmelt to nested list<a class="anchor" aria-label="anchor" href="#unmelt-to-nested-list"></a>
</h3>
<p>To address this difficulty, <code><a href="../reference/rrapply.html">rrapply()</a></code> includes the
dedicated option <code>how = "unmelt"</code> that performs the inverse
operation of <code>how = "melt"</code>. No skeleton object is needed in
this case, only a plain data.frame in the format returned by
<code>how = "melt"</code>. To illustrate, we can convert the melted
data.frame above to a nested list as follows:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/rrapply.html">rrapply</a></span><span class="op">(</span></span>
<span>  <span class="va">renewable_energy_melt_west_eu</span>, </span>
<span>  how <span class="op">=</span> <span class="st">"unmelt"</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span>give.attr <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 1</span></span>
<span><span class="co">#&gt;  $ World:List of 1</span></span>
<span><span class="co">#&gt;   ..$ Europe:List of 1</span></span>
<span><span class="co">#&gt;   .. ..$ Western Europe:List of 9</span></span>
<span><span class="co">#&gt;   .. .. ..$ Austria      : num 34.7</span></span>
<span><span class="co">#&gt;   .. .. ..$ Belgium      : num 9.14</span></span>
<span><span class="co">#&gt;   .. .. ..$ France       : num 14.7</span></span>
<span><span class="co">#&gt;   .. .. ..$ Germany      : num 14.2</span></span>
<span><span class="co">#&gt;   .. .. ..$ Liechtenstein: num 62.9</span></span>
<span><span class="co">#&gt;   .. .. ..$ Luxembourg   : num 13.5</span></span>
<span><span class="co">#&gt;   .. .. ..$ Monaco       : num NA</span></span>
<span><span class="co">#&gt;   .. .. ..$ Netherlands  : num 5.78</span></span>
<span><span class="co">#&gt;   .. .. ..$ Switzerland  : num 25.5</span></span></code></pre></div>
<p><strong>Remark 1:</strong> <code>how = "unmelt"</code> is based on a
<em>greedy</em> approach parsing data.frame rows as list elements
starting from the top of the data.frame. That is, <code><a href="../reference/rrapply.html">rrapply()</a></code>
continues collecting children nodes as long as the parent node name
remains unchanged. If, for instance, the goal is to create two separate
nodes (on the same level) with the name <code>"Western Europe"</code>,
these nodes should not be listed directly after one another in the
melted data.frame as <code><a href="../reference/rrapply.html">rrapply()</a></code> will group all children
under a single <code>"Western Europe"</code> list element.</p>
<p><strong>Remark 2:</strong> Internally, <code>how = "unmelt"</code>
reconstructs a nested list from the melted data.frame and subsequently
follows the same conceptual framework as <code>how = "replace"</code>.
Any other function arguments, such as <code>f</code> and
<code>condition</code> can be used in exactly the same way as when
applying <code>how = "replace"</code> to a nested list object.</p>
<p><strong>Remark 3:</strong> <code>how = "unmelt"</code> does
(currently) not restore the attributes of intermediate list nodes and is
therefore not an exact inverse of <code>how = "melt"</code>. The other
way around always produces the same result:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">renewable_energy_unmelt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rrapply.html">rrapply</a></span><span class="op">(</span><span class="va">renewable_energy_melt_west_eu</span>, how <span class="op">=</span> <span class="st">"unmelt"</span><span class="op">)</span></span>
<span><span class="va">renewable_energy_remelt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rrapply.html">rrapply</a></span><span class="op">(</span><span class="va">renewable_energy_unmelt</span>, how <span class="op">=</span> <span class="st">"melt"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/identical.html" class="external-link">identical</a></span><span class="op">(</span><span class="va">renewable_energy_melt_west_eu</span>, <span class="va">renewable_energy_remelt</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p>In terms of computational effort, <code><a href="../reference/rrapply.html">rrapply()</a></code>’s
<code>how = "unmelt"</code> can be equally or more efficient than
<code><a href="https://rdrr.io/r/utils/relist.html" class="external-link">relist()</a></code> even though there is no template list object that
can be repopulated. This is highlighted using the large list objects
generated previously:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## large deeply nested list (2^18 elements)</span></span>
<span><span class="co">##  benchmark timing with rrapply</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="va">deep_unmelt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rrapply.html">rrapply</a></span><span class="op">(</span><span class="va">deep_melt</span>, how <span class="op">=</span> <span class="st">"unmelt"</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="co">#&gt;    user  system elapsed </span></span>
<span><span class="co">#&gt;   0.161   0.004   0.166</span></span>
<span></span>
<span><span class="co">## benchmark timing with relist</span></span>
<span><span class="va">deep_unlist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/relist.html" class="external-link">as.relistable</a></span><span class="op">(</span><span class="va">deep_list</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="va">deep_relist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/relist.html" class="external-link">relist</a></span><span class="op">(</span><span class="va">deep_unlist</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;    user  system elapsed </span></span>
<span><span class="co">#&gt;   3.645   0.000   3.645</span></span></code></pre></div>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## large shallow list (10^6 elements)</span></span>
<span><span class="co">## benchmark timing with rrapply </span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="va">shallow_unmelt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rrapply.html">rrapply</a></span><span class="op">(</span><span class="va">shallow_melt</span>, how <span class="op">=</span> <span class="st">"unmelt"</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="co">#&gt;    user  system elapsed </span></span>
<span><span class="co">#&gt;   0.095   0.000   0.095</span></span>
<span></span>
<span><span class="co">## benchmark timing with relist</span></span>
<span><span class="va">shallow_unlist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/relist.html" class="external-link">as.relistable</a></span><span class="op">(</span><span class="va">shallow_list</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="va">shallow_relist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/relist.html" class="external-link">relist</a></span><span class="op">(</span><span class="va">shallow_unlist</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;    user  system elapsed </span></span>
<span><span class="co">#&gt;   6.129   0.000   6.131</span></span></code></pre></div>
<p><strong>Note</strong>: the unmelted lists are not exactly identical
to the original nested lists, since <code>how = "unmelt"</code> uses the
placeholder names <code>1</code>, <code>2</code>, <code>3</code>, etc.
in the melted data.frames to name the nodes in the newly constructed
lists, whereas the name attributes in the original lists are all empty.
By removing all names from the unmelted lists, they become identical to
their original counterparts:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## remove all list names</span></span>
<span><span class="va">deep_unmelt_unnamed</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rrapply.html">rrapply</a></span><span class="op">(</span></span>
<span>  <span class="va">deep_unmelt</span>,</span>
<span>  f <span class="op">=</span> <span class="va">unname</span>,</span>
<span>  classes <span class="op">=</span> <span class="st">"list"</span>,</span>
<span>  how <span class="op">=</span> <span class="st">"recurse"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">## check if identical</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/identical.html" class="external-link">identical</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unname.html" class="external-link">unname</a></span><span class="op">(</span><span class="va">deep_unmelt_unnamed</span><span class="op">)</span>, <span class="va">deep_list</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## remove all list names</span></span>
<span><span class="va">shallow_unmelt_unnamed</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rrapply.html">rrapply</a></span><span class="op">(</span></span>
<span>  <span class="va">shallow_unmelt</span>,</span>
<span>  f <span class="op">=</span> <span class="va">unname</span>,</span>
<span>  classes <span class="op">=</span> <span class="st">"list"</span>,</span>
<span>  how <span class="op">=</span> <span class="st">"recurse"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">## check if identical</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/identical.html" class="external-link">identical</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unname.html" class="external-link">unname</a></span><span class="op">(</span><span class="va">shallow_unmelt_unnamed</span><span class="op">)</span>, <span class="va">shallow_list</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
</div>
</div>

  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Joris Chau.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>

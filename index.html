<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Revisiting Base Rapply • rrapply</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><link href="extra.css" rel="stylesheet">
<meta property="og:title" content="Revisiting Base Rapply">
<meta property="og:description" content="The rrapply-package contains a single function rrapply(), providing an extended implementation of R-base rapply() by allowing to recursively apply a function to elements of a nested list based on a general condition function and including the possibility to prune or aggregate nested list elements from the result. In addition, special arguments can be supplied to access the name, location, parents and siblings in the nested list of the element under evaluation. The rrapply() function is implemented in R's C interface and requires no other package dependencies.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">rrapply</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="articles/articles/1-when-to-use-rrapply.html">Efficient list recursion with rrapply</a>
    </li>
    <li>
      <a href="articles/articles/2-efficient-melting-unmelting.html">Efficient list melting and unmelting with rrapply</a>
    </li>
    <li>
      <a href="articles/articles/3-calls-and-expressions.html">Recursive apply for call and expression objects</a>
    </li>
  </ul>
</li>
<li>
  <a href="news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/JorisChau/rrapply/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">
<div id="rrapply-revisiting-r-base-rapply" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#rrapply-revisiting-r-base-rapply" class="anchor"></a>rrapply: revisiting R-base rapply</h1></div>
<!-- badges: start -->

<p>The rrapply-package contains a single function <code><a href="reference/rrapply.html">rrapply()</a></code>, providing an extended implementation of R-base’s <code><a href="https://rdrr.io/r/base/rapply.html">rapply()</a></code> function, which applies a function <code>f</code> to all elements of a nested list recursively and provides control in structuring the returned result. <code><a href="reference/rrapply.html">rrapply()</a></code> is implemented using R’s native C API and for this reason requires no external R-package dependencies.</p>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<div class="sourceCode" id="cb1"><pre class="r"><span class="co"># Install latest release from CRAN:</span>
<span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span>(<span class="st">"rrapply"</span>)

<span class="co"># Install the development version from GitHub:</span>
<span class="co"># install.packages("devtools")</span>
<span class="kw pkg">devtools</span><span class="kw ns">::</span><span class="fu"><a href="https://devtools.r-lib.org//reference/remote-reexports.html">install_github</a></span>(<span class="st">"JorisChau/rrapply"</span>)</pre></div>
</div>
<div id="example-usage" class="section level2">
<h2 class="hasAnchor">
<a href="#example-usage" class="anchor"></a>Example usage</h2>
<div id="list-pruning-and-unnesting" class="section level3">
<h3 class="hasAnchor">
<a href="#list-pruning-and-unnesting" class="anchor"></a>List pruning and unnesting</h3>
<p>With base <code><a href="https://rdrr.io/r/base/rapply.html">rapply()</a></code>, there is no convenient way to prune or filter list elements from the input list. The <code><a href="reference/rrapply.html">rrapply()</a></code> function adds an option <code>how = "prune"</code> to prune all list elements not subject to application of <code>f</code> from a nested list,</p>
<div class="sourceCode" id="cb2"><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">rrapply</span>)
<span class="co">## Nested list of renewable energy as a percentage of total energy consumption per country in 2016</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="st">"renewable_energy_by_country"</span>)

<span class="co">## Subset values for countries and areas in Oceania</span>
<span class="no">renewable_oceania</span> <span class="kw">&lt;-</span> <span class="no">renewable_energy_by_country</span><span class="kw">[[</span><span class="st">"World"</span>]][<span class="st">"Oceania"</span>]
<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="no">renewable_oceania</span>, <span class="kw">list.len</span> <span class="kw">=</span> <span class="fl">3</span>, <span class="kw">give.attr</span> <span class="kw">=</span> <span class="fl">FALSE</span>)
<span class="co">#&gt; List of 1</span>
<span class="co">#&gt;  $ Oceania:List of 4</span>
<span class="co">#&gt;   ..$ Australia and New Zealand:List of 6</span>
<span class="co">#&gt;   .. ..$ Australia                        : num 9.32</span>
<span class="co">#&gt;   .. ..$ Christmas Island                 : logi NA</span>
<span class="co">#&gt;   .. ..$ Cocos (Keeling) Islands          : logi NA</span>
<span class="co">#&gt;   .. .. [list output truncated]</span>
<span class="co">#&gt;   ..$ Melanesia                :List of 5</span>
<span class="co">#&gt;   .. ..$ Fiji            : num 24.4</span>
<span class="co">#&gt;   .. ..$ New Caledonia   : num 4.03</span>
<span class="co">#&gt;   .. ..$ Papua New Guinea: num 50.3</span>
<span class="co">#&gt;   .. .. [list output truncated]</span>
<span class="co">#&gt;   ..$ Micronesia               :List of 8</span>
<span class="co">#&gt;   .. ..$ Guam                                : num 3.03</span>
<span class="co">#&gt;   .. ..$ Kiribati                            : num 45.4</span>
<span class="co">#&gt;   .. ..$ Marshall Islands                    : num 11.8</span>
<span class="co">#&gt;   .. .. [list output truncated]</span>
<span class="co">#&gt;   .. [list output truncated]</span>

<span class="co">## Drop all logical NA's while preserving list structure </span>
<span class="no">na_drop_oceania</span> <span class="kw">&lt;-</span> <span class="fu"><a href="reference/rrapply.html">rrapply</a></span>(
  <span class="no">renewable_oceania</span>,
  <span class="kw">f</span> <span class="kw">=</span> <span class="no">identity</span>,
  <span class="kw">classes</span> <span class="kw">=</span> <span class="st">"numeric"</span>,
  <span class="kw">how</span> <span class="kw">=</span> <span class="st">"prune"</span>
)
<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="no">na_drop_oceania</span>, <span class="kw">list.len</span> <span class="kw">=</span> <span class="fl">3</span>, <span class="kw">give.attr</span> <span class="kw">=</span> <span class="fl">FALSE</span>)
<span class="co">#&gt; List of 1</span>
<span class="co">#&gt;  $ Oceania:List of 4</span>
<span class="co">#&gt;   ..$ Australia and New Zealand:List of 2</span>
<span class="co">#&gt;   .. ..$ Australia  : num 9.32</span>
<span class="co">#&gt;   .. ..$ New Zealand: num 32.8</span>
<span class="co">#&gt;   ..$ Melanesia                :List of 5</span>
<span class="co">#&gt;   .. ..$ Fiji            : num 24.4</span>
<span class="co">#&gt;   .. ..$ New Caledonia   : num 4.03</span>
<span class="co">#&gt;   .. ..$ Papua New Guinea: num 50.3</span>
<span class="co">#&gt;   .. .. [list output truncated]</span>
<span class="co">#&gt;   ..$ Micronesia               :List of 7</span>
<span class="co">#&gt;   .. ..$ Guam                            : num 3.03</span>
<span class="co">#&gt;   .. ..$ Kiribati                        : num 45.4</span>
<span class="co">#&gt;   .. ..$ Marshall Islands                : num 11.8</span>
<span class="co">#&gt;   .. .. [list output truncated]</span>
<span class="co">#&gt;   .. [list output truncated]</span></pre></div>
<p>Instead, use <code>how = "flatten"</code> to return a flattened unnested version of the pruned list,</p>
<div class="sourceCode" id="cb3"><pre class="r"><span class="co">## Drop all logical NA's and return unnested list</span>
<span class="no">na_drop_oceania2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="reference/rrapply.html">rrapply</a></span>(
  <span class="no">renewable_oceania</span>,
  <span class="kw">f</span> <span class="kw">=</span> <span class="no">identity</span>,
  <span class="kw">classes</span> <span class="kw">=</span> <span class="st">"numeric"</span>,
  <span class="kw">how</span> <span class="kw">=</span> <span class="st">"flatten"</span>
)
<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="no">na_drop_oceania2</span>, <span class="kw">list.len</span> <span class="kw">=</span> <span class="fl">10</span>, <span class="kw">give.attr</span> <span class="kw">=</span> <span class="fl">FALSE</span>)
<span class="co">#&gt; List of 22</span>
<span class="co">#&gt;  $ Australia                       : num 9.32</span>
<span class="co">#&gt;  $ New Zealand                     : num 32.8</span>
<span class="co">#&gt;  $ Fiji                            : num 24.4</span>
<span class="co">#&gt;  $ New Caledonia                   : num 4.03</span>
<span class="co">#&gt;  $ Papua New Guinea                : num 50.3</span>
<span class="co">#&gt;  $ Solomon Islands                 : num 65.7</span>
<span class="co">#&gt;  $ Vanuatu                         : num 33.7</span>
<span class="co">#&gt;  $ Guam                            : num 3.03</span>
<span class="co">#&gt;  $ Kiribati                        : num 45.4</span>
<span class="co">#&gt;  $ Marshall Islands                : num 11.8</span>
<span class="co">#&gt;   [list output truncated]</span></pre></div>
<p>Or, use <code>how = "melt"</code> to return a melted data.frame of the pruned list similar in format to <code><a href="https://rdrr.io/pkg/reshape2/man/melt.html">reshape2::melt()</a></code> applied to a nested list.</p>
<div class="sourceCode" id="cb4"><pre class="r"><span class="co">## Drop all logical NA's and return melted data.frame</span>
<span class="no">na_drop_oceania3</span> <span class="kw">&lt;-</span> <span class="fu"><a href="reference/rrapply.html">rrapply</a></span>(
  <span class="no">renewable_oceania</span>,
  <span class="kw">f</span> <span class="kw">=</span> <span class="no">identity</span>,
  <span class="kw">classes</span> <span class="kw">=</span> <span class="st">"numeric"</span>,
  <span class="kw">how</span> <span class="kw">=</span> <span class="st">"melt"</span>
)
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">na_drop_oceania3</span>)
<span class="co">#&gt;        L1                        L2               L3 value</span>
<span class="co">#&gt; 1 Oceania Australia and New Zealand        Australia  9.32</span>
<span class="co">#&gt; 2 Oceania Australia and New Zealand      New Zealand 32.76</span>
<span class="co">#&gt; 3 Oceania                 Melanesia             Fiji 24.36</span>
<span class="co">#&gt; 4 Oceania                 Melanesia    New Caledonia  4.03</span>
<span class="co">#&gt; 5 Oceania                 Melanesia Papua New Guinea 50.34</span>
<span class="co">#&gt; 6 Oceania                 Melanesia  Solomon Islands 65.73</span></pre></div>
<p>A melted data.frame can be used to reconstruct a nested list with <code>how = "unmelt"</code>,</p>
<div class="sourceCode" id="cb5"><pre class="r"><span class="co">## Reconstruct nested list from melted data.frame</span>
<span class="no">na_drop_oceania4</span> <span class="kw">&lt;-</span> <span class="fu"><a href="reference/rrapply.html">rrapply</a></span>(
  <span class="no">na_drop_oceania3</span>,
  <span class="kw">how</span> <span class="kw">=</span> <span class="st">"unmelt"</span>
)
<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="no">na_drop_oceania4</span>, <span class="kw">list.len</span> <span class="kw">=</span> <span class="fl">3</span>, <span class="kw">give.attr</span> <span class="kw">=</span> <span class="fl">FALSE</span>)
<span class="co">#&gt; List of 1</span>
<span class="co">#&gt;  $ Oceania:List of 4</span>
<span class="co">#&gt;   ..$ Australia and New Zealand:List of 2</span>
<span class="co">#&gt;   .. ..$ Australia  : num 9.32</span>
<span class="co">#&gt;   .. ..$ New Zealand: num 32.8</span>
<span class="co">#&gt;   ..$ Melanesia                :List of 5</span>
<span class="co">#&gt;   .. ..$ Fiji            : num 24.4</span>
<span class="co">#&gt;   .. ..$ New Caledonia   : num 4.03</span>
<span class="co">#&gt;   .. ..$ Papua New Guinea: num 50.3</span>
<span class="co">#&gt;   .. .. [list output truncated]</span>
<span class="co">#&gt;   ..$ Micronesia               :List of 7</span>
<span class="co">#&gt;   .. ..$ Guam                            : num 3.03</span>
<span class="co">#&gt;   .. ..$ Kiribati                        : num 45.4</span>
<span class="co">#&gt;   .. ..$ Marshall Islands                : num 11.8</span>
<span class="co">#&gt;   .. .. [list output truncated]</span>
<span class="co">#&gt;   .. [list output truncated]</span></pre></div>
</div>
<div id="condition-function" class="section level3">
<h3 class="hasAnchor">
<a href="#condition-function" class="anchor"></a>Condition function</h3>
<p>Base <code><a href="https://rdrr.io/r/base/rapply.html">rapply()</a></code> allows to apply a function <code>f</code> to list elements of certain types or classes via the <code>classes</code> argument. <code><a href="reference/rrapply.html">rrapply()</a></code> generalizes this option via an additional <code>condition</code> argument, which accepts any function to use as a condition or predicate to apply <code>f</code> to a subset of list elements.</p>
<div class="sourceCode" id="cb6"><pre class="r"><span class="co">## Drop all NA elements using condition function</span>
<span class="no">na_drop_oceania3</span> <span class="kw">&lt;-</span> <span class="fu"><a href="reference/rrapply.html">rrapply</a></span>(
  <span class="no">renewable_oceania</span>,
  <span class="kw">condition</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/funprog.html">Negate</a></span>(<span class="no">is.na</span>),
  <span class="kw">f</span> <span class="kw">=</span> <span class="kw">function</span>(<span class="no">x</span>) <span class="no">x</span>,
  <span class="kw">how</span> <span class="kw">=</span> <span class="st">"prune"</span>
)
<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="no">na_drop_oceania3</span>, <span class="kw">list.len</span> <span class="kw">=</span> <span class="fl">3</span>, <span class="kw">give.attr</span> <span class="kw">=</span> <span class="fl">FALSE</span>)
<span class="co">#&gt; List of 1</span>
<span class="co">#&gt;  $ Oceania:List of 4</span>
<span class="co">#&gt;   ..$ Australia and New Zealand:List of 2</span>
<span class="co">#&gt;   .. ..$ Australia  : num 9.32</span>
<span class="co">#&gt;   .. ..$ New Zealand: num 32.8</span>
<span class="co">#&gt;   ..$ Melanesia                :List of 5</span>
<span class="co">#&gt;   .. ..$ Fiji            : num 24.4</span>
<span class="co">#&gt;   .. ..$ New Caledonia   : num 4.03</span>
<span class="co">#&gt;   .. ..$ Papua New Guinea: num 50.3</span>
<span class="co">#&gt;   .. .. [list output truncated]</span>
<span class="co">#&gt;   ..$ Micronesia               :List of 7</span>
<span class="co">#&gt;   .. ..$ Guam                            : num 3.03</span>
<span class="co">#&gt;   .. ..$ Kiribati                        : num 45.4</span>
<span class="co">#&gt;   .. ..$ Marshall Islands                : num 11.8</span>
<span class="co">#&gt;   .. .. [list output truncated]</span>
<span class="co">#&gt;   .. [list output truncated]</span>

<span class="co">## Filter all countries with values above 85%</span>
<span class="no">renewable_energy_above_85</span> <span class="kw">&lt;-</span> <span class="fu"><a href="reference/rrapply.html">rrapply</a></span>(
  <span class="no">renewable_energy_by_country</span>,
  <span class="kw">condition</span> <span class="kw">=</span> <span class="kw">function</span>(<span class="no">x</span>) <span class="no">x</span> <span class="kw">&gt;</span> <span class="fl">85</span>,
  <span class="kw">how</span> <span class="kw">=</span> <span class="st">"prune"</span>
)
<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="no">renewable_energy_above_85</span>, <span class="kw">give.attr</span> <span class="kw">=</span> <span class="fl">FALSE</span>)
<span class="co">#&gt; List of 1</span>
<span class="co">#&gt;  $ World:List of 1</span>
<span class="co">#&gt;   ..$ Africa:List of 1</span>
<span class="co">#&gt;   .. ..$ Sub-Saharan Africa:List of 3</span>
<span class="co">#&gt;   .. .. ..$ Eastern Africa:List of 7</span>
<span class="co">#&gt;   .. .. .. ..$ Burundi                    : num 89.2</span>
<span class="co">#&gt;   .. .. .. ..$ Ethiopia                   : num 91.9</span>
<span class="co">#&gt;   .. .. .. ..$ Rwanda                     : num 86</span>
<span class="co">#&gt;   .. .. .. ..$ Somalia                    : num 94.7</span>
<span class="co">#&gt;   .. .. .. ..$ Uganda                     : num 88.6</span>
<span class="co">#&gt;   .. .. .. ..$ United Republic of Tanzania: num 86.1</span>
<span class="co">#&gt;   .. .. .. ..$ Zambia                     : num 88.5</span>
<span class="co">#&gt;   .. .. ..$ Middle Africa :List of 2</span>
<span class="co">#&gt;   .. .. .. ..$ Chad                            : num 85.3</span>
<span class="co">#&gt;   .. .. .. ..$ Democratic Republic of the Congo: num 97</span>
<span class="co">#&gt;   .. .. ..$ Western Africa:List of 1</span>
<span class="co">#&gt;   .. .. .. ..$ Guinea-Bissau: num 86.5</span></pre></div>
</div>
<div id="special-arguments-xname-xpos-xparents-and-xsiblings" class="section level3">
<h3 class="hasAnchor">
<a href="#special-arguments-xname-xpos-xparents-and-xsiblings" class="anchor"></a>Special arguments <code>.xname</code>, <code>.xpos</code>, <code>.xparents</code> and <code>.xsiblings</code>
</h3>
<p>In base <code><a href="https://rdrr.io/r/base/rapply.html">rapply()</a></code>, the <code>f</code> function only has access to the content of the list element under evaluation, and there is no convenient way to access its name or location in the nested list from inside the <code>f</code> function. <code><a href="reference/rrapply.html">rrapply()</a></code> allows the use of the special arguments <code>.xname</code>, <code>.xpos</code>,<code>.xparents</code> and <code>.xsiblings</code> inside the <code>f</code> and <code>condition</code> functions (in addition to the principal function argument). <code>.xname</code> evaluates to the name of the list element, <code>.xpos</code> evaluates to the position of the element in the nested list structured as an integer vector, <code>.xparents</code> evaluates to a vector of parent node names in the path to the current list element, and <code>.xsiblings</code> evaluates to the parent list containing the current list element and all of its direct siblings.</p>
<div class="sourceCode" id="cb7"><pre class="r"><span class="co">## Apply a function using the name of the node</span>
<span class="no">renewable_oceania4</span> <span class="kw">&lt;-</span> <span class="fu"><a href="reference/rrapply.html">rrapply</a></span>(
  <span class="no">renewable_oceania</span>,
  <span class="kw">f</span> <span class="kw">=</span> <span class="kw">function</span>(<span class="no">x</span>, <span class="no">.xname</span>) <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span>(<span class="st">"Renewable energy in %s: %.2f%%"</span>, <span class="no">.xname</span>, <span class="no">x</span>),
  <span class="kw">condition</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/funprog.html">Negate</a></span>(<span class="no">is.na</span>),
  <span class="kw">how</span> <span class="kw">=</span> <span class="st">"flatten"</span>
)
<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="no">renewable_oceania4</span>, <span class="kw">list.len</span> <span class="kw">=</span> <span class="fl">10</span>)
<span class="co">#&gt; List of 22</span>
<span class="co">#&gt;  $ Australia                       : chr "Renewable energy in Australia: 9.32%"</span>
<span class="co">#&gt;  $ New Zealand                     : chr "Renewable energy in New Zealand: 32.76%"</span>
<span class="co">#&gt;  $ Fiji                            : chr "Renewable energy in Fiji: 24.36%"</span>
<span class="co">#&gt;  $ New Caledonia                   : chr "Renewable energy in New Caledonia: 4.03%"</span>
<span class="co">#&gt;  $ Papua New Guinea                : chr "Renewable energy in Papua New Guinea: 50.34%"</span>
<span class="co">#&gt;  $ Solomon Islands                 : chr "Renewable energy in Solomon Islands: 65.73%"</span>
<span class="co">#&gt;  $ Vanuatu                         : chr "Renewable energy in Vanuatu: 33.67%"</span>
<span class="co">#&gt;  $ Guam                            : chr "Renewable energy in Guam: 3.03%"</span>
<span class="co">#&gt;  $ Kiribati                        : chr "Renewable energy in Kiribati: 45.43%"</span>
<span class="co">#&gt;  $ Marshall Islands                : chr "Renewable energy in Marshall Islands: 11.75%"</span>
<span class="co">#&gt;   [list output truncated]</span>

<span class="co">## Extract values based on country names</span>
<span class="no">renewable_benelux</span> <span class="kw">&lt;-</span> <span class="fu"><a href="reference/rrapply.html">rrapply</a></span>(
  <span class="no">renewable_energy_by_country</span>,
  <span class="kw">condition</span> <span class="kw">=</span> <span class="kw">function</span>(<span class="no">x</span>, <span class="no">.xname</span>) <span class="no">.xname</span> <span class="kw">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Belgium"</span>, <span class="st">"Netherlands"</span>, <span class="st">"Luxembourg"</span>),
  <span class="kw">how</span> <span class="kw">=</span> <span class="st">"prune"</span>
)
<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="no">renewable_benelux</span>, <span class="kw">give.attr</span> <span class="kw">=</span> <span class="fl">FALSE</span>)
<span class="co">#&gt; List of 1</span>
<span class="co">#&gt;  $ World:List of 1</span>
<span class="co">#&gt;   ..$ Europe:List of 1</span>
<span class="co">#&gt;   .. ..$ Western Europe:List of 3</span>
<span class="co">#&gt;   .. .. ..$ Belgium    : num 9.14</span>
<span class="co">#&gt;   .. .. ..$ Luxembourg : num 13.5</span>
<span class="co">#&gt;   .. .. ..$ Netherlands: num 5.78</span>

<span class="co">## Filter European countries &gt; 50% using .xpos</span>
<span class="no">renewable_europe_above_50</span> <span class="kw">&lt;-</span> <span class="fu"><a href="reference/rrapply.html">rrapply</a></span>(
  <span class="no">renewable_energy_by_country</span>,
  <span class="kw">condition</span> <span class="kw">=</span> <span class="kw">function</span>(<span class="no">x</span>, <span class="no">.xpos</span>) <span class="fu"><a href="https://rdrr.io/r/base/identical.html">identical</a></span>(<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">.xpos</span>, <span class="fl">2</span>), <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1L</span>, <span class="fl">5L</span>)) <span class="kw">&amp;</span> <span class="no">x</span> <span class="kw">&gt;</span> <span class="fl">50</span>,
  <span class="kw">how</span> <span class="kw">=</span> <span class="st">"prune"</span>
)
<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="no">renewable_europe_above_50</span>, <span class="kw">give.attr</span> <span class="kw">=</span> <span class="fl">FALSE</span>)
<span class="co">#&gt; List of 1</span>
<span class="co">#&gt;  $ World:List of 1</span>
<span class="co">#&gt;   ..$ Europe:List of 2</span>
<span class="co">#&gt;   .. ..$ Northern Europe:List of 3</span>
<span class="co">#&gt;   .. .. ..$ Iceland: num 78.1</span>
<span class="co">#&gt;   .. .. ..$ Norway : num 59.5</span>
<span class="co">#&gt;   .. .. ..$ Sweden : num 51.4</span>
<span class="co">#&gt;   .. ..$ Western Europe :List of 1</span>
<span class="co">#&gt;   .. .. ..$ Liechtenstein: num 62.9</span>

<span class="co">## Filter European countries &gt; 50% using .xparents</span>
<span class="no">renewbale_europe_above_50</span> <span class="kw">&lt;-</span> <span class="fu"><a href="reference/rrapply.html">rrapply</a></span>(
  <span class="no">renewable_energy_by_country</span>,
  <span class="kw">condition</span> <span class="kw">=</span> <span class="kw">function</span>(<span class="no">x</span>, <span class="no">.xparents</span>) <span class="st">"Europe"</span> <span class="kw">%in%</span> <span class="no">.xparents</span> <span class="kw">&amp;</span> <span class="no">x</span> <span class="kw">&gt;</span> <span class="fl">50</span>,
  <span class="kw">how</span> <span class="kw">=</span> <span class="st">"prune"</span>
)

<span class="co">## Return position of Sweden in list</span>
(<span class="no">xpos_sweden</span> <span class="kw">&lt;-</span> <span class="fu"><a href="reference/rrapply.html">rrapply</a></span>(
  <span class="no">renewable_energy_by_country</span>,
  <span class="kw">condition</span> <span class="kw">=</span> <span class="kw">function</span>(<span class="no">x</span>, <span class="no">.xname</span>) <span class="fu"><a href="https://rdrr.io/r/base/identical.html">identical</a></span>(<span class="no">.xname</span>, <span class="st">"Sweden"</span>),
  <span class="kw">f</span> <span class="kw">=</span> <span class="kw">function</span>(<span class="no">x</span>, <span class="no">.xpos</span>) <span class="no">.xpos</span>,
  <span class="kw">how</span> <span class="kw">=</span> <span class="st">"flatten"</span>
))
<span class="co">#&gt; $Sweden</span>
<span class="co">#&gt; [1]  1  5  2 14</span>
<span class="no">renewable_energy_by_country</span><span class="kw">[[</span><span class="no">xpos_sweden</span>$<span class="no">Sweden</span>]]
<span class="co">#&gt; [1] 51.35</span>
<span class="co">#&gt; attr(,"M49-code")</span>
<span class="co">#&gt; [1] "752"</span>

<span class="co">## Return siblings of Sweden in list</span>
<span class="no">siblings_sweden</span> <span class="kw">&lt;-</span> <span class="fu"><a href="reference/rrapply.html">rrapply</a></span>(
  <span class="no">renewable_energy_by_country</span>,
  <span class="kw">condition</span> <span class="kw">=</span> <span class="kw">function</span>(<span class="no">x</span>, <span class="no">.xsiblings</span>) <span class="st">"Sweden"</span> <span class="kw">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="no">.xsiblings</span>),
  <span class="kw">how</span> <span class="kw">=</span> <span class="st">"flatten"</span>
)
<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="no">siblings_sweden</span>, <span class="kw">list.len</span> <span class="kw">=</span> <span class="fl">10</span>, <span class="kw">give.attr</span> <span class="kw">=</span> <span class="fl">FALSE</span>)
<span class="co">#&gt; List of 14</span>
<span class="co">#&gt;  $ Aland Islands                                       : logi NA</span>
<span class="co">#&gt;  $ Denmark                                             : num 33.1</span>
<span class="co">#&gt;  $ Estonia                                             : num 26.6</span>
<span class="co">#&gt;  $ Faroe Islands                                       : num 4.24</span>
<span class="co">#&gt;  $ Finland                                             : num 42</span>
<span class="co">#&gt;  $ Iceland                                             : num 78.1</span>
<span class="co">#&gt;  $ Ireland                                             : num 8.65</span>
<span class="co">#&gt;  $ Isle of Man                                         : num 4.3</span>
<span class="co">#&gt;  $ Latvia                                              : num 38.5</span>
<span class="co">#&gt;  $ Lithuania                                           : num 31.4</span>
<span class="co">#&gt;   [list output truncated]</span></pre></div>
</div>
<div id="list-node-aggregation" class="section level3">
<h3 class="hasAnchor">
<a href="#list-node-aggregation" class="anchor"></a>List node aggregation</h3>
<p>By default, both base <code><a href="https://rdrr.io/r/base/rapply.html">rapply()</a></code> and <code><a href="reference/rrapply.html">rrapply()</a></code> recurse into any list-like element. Use <code>feverywhere = "break"</code> to override this behavior and apply <code>f</code> to any list element (e.g. a sublist) that satisfies the <code>condition</code> and <code>classes</code> arguments. This is useful to collapse sublists or calculate summary statistics of sublists of a nested list. Together with the <code>.xname</code> and <code>.xpos</code> arguments, we have a flexible way in deciding which sublists to summarize through the <code>condition</code> function.</p>
<div class="sourceCode" id="cb8"><pre class="r"><span class="co">## Calculate mean value of Europe</span>
<span class="fu"><a href="reference/rrapply.html">rrapply</a></span>(
  <span class="no">renewable_energy_by_country</span>,
  <span class="kw">condition</span> <span class="kw">=</span> <span class="kw">function</span>(<span class="no">x</span>, <span class="no">.xname</span>) <span class="no">.xname</span> <span class="kw">==</span> <span class="st">"Europe"</span>,
  <span class="kw">f</span> <span class="kw">=</span> <span class="kw">function</span>(<span class="no">x</span>) <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span>(<span class="no">x</span>), <span class="kw">na.rm</span> <span class="kw">=</span> <span class="fl">TRUE</span>),
  <span class="kw">how</span> <span class="kw">=</span> <span class="st">"flatten"</span>,
  <span class="kw">feverywhere</span> <span class="kw">=</span> <span class="st">"break"</span>
)
<span class="co">#&gt; $Europe</span>
<span class="co">#&gt; [1] 22.36565</span>

<span class="co">## Calculate mean value for each continent</span>
<span class="no">renewable_continent_summary</span> <span class="kw">&lt;-</span> <span class="fu"><a href="reference/rrapply.html">rrapply</a></span>(
  <span class="no">renewable_energy_by_country</span>,
  <span class="kw">condition</span> <span class="kw">=</span> <span class="kw">function</span>(<span class="no">x</span>, <span class="no">.xpos</span>) <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">.xpos</span>) <span class="kw">==</span> <span class="fl">2</span>,
  <span class="kw">f</span> <span class="kw">=</span> <span class="kw">function</span>(<span class="no">x</span>) <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span>(<span class="no">x</span>), <span class="kw">na.rm</span> <span class="kw">=</span> <span class="fl">TRUE</span>),
  <span class="kw">feverywhere</span> <span class="kw">=</span> <span class="st">"break"</span>
)

<span class="co">## Antarctica's value is missing</span>
<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="no">renewable_continent_summary</span>, <span class="kw">give.attr</span> <span class="kw">=</span> <span class="fl">FALSE</span>)
<span class="co">#&gt; List of 1</span>
<span class="co">#&gt;  $ World:List of 6</span>
<span class="co">#&gt;   ..$ Africa    : num 54.3</span>
<span class="co">#&gt;   ..$ Americas  : num 18.2</span>
<span class="co">#&gt;   ..$ Antarctica: num NaN</span>
<span class="co">#&gt;   ..$ Asia      : num 17.9</span>
<span class="co">#&gt;   ..$ Europe    : num 22.4</span>
<span class="co">#&gt;   ..$ Oceania   : num 17.8</span></pre></div>
</div>
<div id="list-node-updating" class="section level3">
<h3 class="hasAnchor">
<a href="#list-node-updating" class="anchor"></a>List node updating</h3>
<p>If <code>feverywhere = "recurse"</code>, <code><a href="reference/rrapply.html">rrapply()</a></code> applies the <code>f</code> function to any element (e.g. a sublist) that satisfies the <code>condition</code> and <code>classes</code> arguments similar to <code>feverywhere = "break"</code>, but recurses further into any <em>updated</em> list-like element after application of the <code>f</code> function. Using <code>feverywhere = "recurse"</code>, we can for instance recursively update all node names in a nested list:</p>
<div class="sourceCode" id="cb9"><pre class="r"><span class="co">## Replace country names by M-49 attributes</span>
<span class="no">renewable_M49</span> <span class="kw">&lt;-</span> <span class="fu"><a href="reference/rrapply.html">rrapply</a></span>(
  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="no">renewable_energy_by_country</span>),
  <span class="kw">condition</span> <span class="kw">=</span> <span class="no">is.list</span>,
  <span class="kw">f</span> <span class="kw">=</span> <span class="kw">function</span>(<span class="no">x</span>) {
    <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="no">x</span>) <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">vapply</a></span>(<span class="no">x</span>, <span class="no">attr</span>, <span class="fu"><a href="https://rdrr.io/r/base/character.html">character</a></span>(<span class="fl">1L</span>), <span class="kw">which</span> <span class="kw">=</span> <span class="st">"M49-code"</span>)
    <span class="fu"><a href="https://rdrr.io/r/base/function.html">return</a></span>(<span class="no">x</span>)
  },
  <span class="kw">feverywhere</span> <span class="kw">=</span> <span class="st">"recurse"</span>
)

<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="no">renewable_M49</span><span class="kw">[[</span><span class="fl">1</span>]], <span class="kw">max.level</span> <span class="kw">=</span> <span class="fl">3</span>, <span class="kw">list.len</span> <span class="kw">=</span> <span class="fl">3</span>, <span class="kw">give.attr</span> <span class="kw">=</span> <span class="fl">FALSE</span>)
<span class="co">#&gt; List of 1</span>
<span class="co">#&gt;  $ 001:List of 6</span>
<span class="co">#&gt;   ..$ 002:List of 2</span>
<span class="co">#&gt;   .. ..$ 015:List of 7</span>
<span class="co">#&gt;   .. ..$ 202:List of 4</span>
<span class="co">#&gt;   ..$ 019:List of 2</span>
<span class="co">#&gt;   .. ..$ 419:List of 3</span>
<span class="co">#&gt;   .. ..$ 021:List of 5</span>
<span class="co">#&gt;   ..$ 010: logi NA</span>
<span class="co">#&gt;   .. [list output truncated]</span></pre></div>
</div>
<div id="using-rrapply-on-dataframes" class="section level3">
<h3 class="hasAnchor">
<a href="#using-rrapply-on-dataframes" class="anchor"></a>Using <code>rrapply()</code> on data.frames</h3>
<p>Since base <code><a href="https://rdrr.io/r/base/rapply.html">rapply()</a></code> recurses into all list-like objects, and data.frames are list-like objects, <code><a href="https://rdrr.io/r/base/rapply.html">rapply()</a></code> always descends into the individual columns of a data.frame. For convenience, <code><a href="reference/rrapply.html">rrapply()</a></code> includes an additional <code>dfaslist</code> argument, which if <code>FALSE</code> does not treat a data.frame as a list and applies the <code>f</code> function to the data.frame as a whole instead of its individual columns.</p>
<p>However, it can also be useful to exploit the property that a data.frame is a list-like object and use base <code><a href="https://rdrr.io/r/base/rapply.html">rapply()</a></code> to apply a function <code>f</code> to data.frame columns of certain classes via the <code>classes</code> argument. Using the <code>condition</code> argument in <code><a href="reference/rrapply.html">rrapply()</a></code>, we can apply a function <code>f</code> to a subset of data.frame columns using a general predicate function,</p>
<div class="sourceCode" id="cb10"><pre class="r"><span class="co">## Scale only Sepal columns in iris dataset</span>
<span class="no">iris_standard_sepal</span> <span class="kw">&lt;-</span> <span class="fu"><a href="reference/rrapply.html">rrapply</a></span>(
  <span class="no">iris</span>,
  <span class="kw">condition</span> <span class="kw">=</span> <span class="kw">function</span>(<span class="no">x</span>, <span class="no">.xname</span>) <span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span>(<span class="st">"Sepal"</span>, <span class="no">.xname</span>),
  <span class="kw">f</span> <span class="kw">=</span> <span class="no">scale</span>
)
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">iris_standard_sepal</span>)
<span class="co">#&gt;   Sepal.Length Sepal.Width Petal.Length Petal.Width Species</span>
<span class="co">#&gt; 1   -0.8976739  1.01560199          1.4         0.2  setosa</span>
<span class="co">#&gt; 2   -1.1392005 -0.13153881          1.4         0.2  setosa</span>
<span class="co">#&gt; 3   -1.3807271  0.32731751          1.3         0.2  setosa</span>
<span class="co">#&gt; 4   -1.5014904  0.09788935          1.5         0.2  setosa</span>
<span class="co">#&gt; 5   -1.0184372  1.24503015          1.4         0.2  setosa</span>
<span class="co">#&gt; 6   -0.5353840  1.93331463          1.7         0.4  setosa</span>

<span class="co">## Scale and keep only numeric columns</span>
<span class="no">iris_standard_transmute</span> <span class="kw">&lt;-</span> <span class="fu"><a href="reference/rrapply.html">rrapply</a></span>(
  <span class="no">iris</span>,
  <span class="kw">f</span> <span class="kw">=</span> <span class="no">scale</span>,
  <span class="kw">classes</span> <span class="kw">=</span> <span class="st">"numeric"</span>,
  <span class="kw">how</span> <span class="kw">=</span> <span class="st">"prune"</span>
)
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">iris_standard_transmute</span>)
<span class="co">#&gt;   Sepal.Length Sepal.Width Petal.Length Petal.Width</span>
<span class="co">#&gt; 1   -0.8976739  1.01560199    -1.335752   -1.311052</span>
<span class="co">#&gt; 2   -1.1392005 -0.13153881    -1.335752   -1.311052</span>
<span class="co">#&gt; 3   -1.3807271  0.32731751    -1.392399   -1.311052</span>
<span class="co">#&gt; 4   -1.5014904  0.09788935    -1.279104   -1.311052</span>
<span class="co">#&gt; 5   -1.0184372  1.24503015    -1.335752   -1.311052</span>
<span class="co">#&gt; 6   -0.5353840  1.93331463    -1.165809   -1.048667</span>

<span class="co">## Summarize only numeric columns with how = "flatten"</span>
<span class="no">iris_standard_summarize</span> <span class="kw">&lt;-</span> <span class="fu"><a href="reference/rrapply.html">rrapply</a></span>(
  <span class="no">iris</span>,
  <span class="kw">f</span> <span class="kw">=</span> <span class="no">summary</span>,
  <span class="kw">classes</span> <span class="kw">=</span> <span class="st">"numeric"</span>,
  <span class="kw">how</span> <span class="kw">=</span> <span class="st">"flatten"</span>
)
<span class="no">iris_standard_summarize</span>
<span class="co">#&gt; $Sepal.Length</span>
<span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span>
<span class="co">#&gt;   4.300   5.100   5.800   5.843   6.400   7.900 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $Sepal.Width</span>
<span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span>
<span class="co">#&gt;   2.000   2.800   3.000   3.057   3.300   4.400 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $Petal.Length</span>
<span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span>
<span class="co">#&gt;   1.000   1.600   4.350   3.758   5.100   6.900 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $Petal.Width</span>
<span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span>
<span class="co">#&gt;   0.100   0.300   1.300   1.199   1.800   2.500</span></pre></div>
</div>
<div id="using-rrapply-on-expressions" class="section level3">
<h3 class="hasAnchor">
<a href="#using-rrapply-on-expressions" class="anchor"></a>Using <code>rrapply()</code> on expressions</h3>
<p>In contrast to base <code><a href="https://rdrr.io/r/base/rapply.html">rapply()</a></code>, <code><a href="reference/rrapply.html">rrapply()</a></code> also supports recursion of call objects and expression vectors, which are treated as nested lists based on their internal abstract syntax trees. As such, all functionality that applies to nested lists extends directly to call objects and expression vectors.</p>
<p>To update the abstract syntax tree of a call object, use <code>how = "replace"</code>:</p>
<div class="sourceCode" id="cb11"><pre class="r"><span class="no">call_old</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/substitute.html">quote</a></span>(<span class="no">y</span> <span class="kw">&lt;-</span> <span class="no">x</span> <span class="kw">&lt;-</span> <span class="fl">1</span> + <span class="fl">TRUE</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="no">call_old</span>)
<span class="co">#&gt;  language y &lt;- x &lt;- 1 + TRUE</span>

<span class="co">## Replace logicals by integers </span>
<span class="no">call_new</span> <span class="kw">&lt;-</span> <span class="fu"><a href="reference/rrapply.html">rrapply</a></span>(<span class="no">call_old</span>, <span class="kw">classes</span> <span class="kw">=</span> <span class="st">"logical"</span>, <span class="kw">f</span> <span class="kw">=</span> <span class="no">as.numeric</span>, <span class="kw">how</span> <span class="kw">=</span> <span class="st">"replace"</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="no">call_new</span>)
<span class="co">#&gt;  language y &lt;- x &lt;- 1 + 1</span></pre></div>
<p>To update the abstract syntax tree and return it as a nested list, use <code>how = "list"</code>:</p>
<div class="sourceCode" id="cb12"><pre class="r"><span class="co">## Update and decompose call object</span>
<span class="no">call_ast</span> <span class="kw">&lt;-</span> <span class="fu"><a href="reference/rrapply.html">rrapply</a></span>(<span class="no">call_old</span>, <span class="kw">f</span> <span class="kw">=</span> <span class="kw">function</span>(<span class="no">x</span>) <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/logical.html">is.logical</a></span>(<span class="no">x</span>), <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span>(<span class="no">x</span>), <span class="no">x</span>), <span class="kw">how</span> <span class="kw">=</span> <span class="st">"list"</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="no">call_ast</span>)
<span class="co">#&gt; List of 3</span>
<span class="co">#&gt;  $ : symbol &lt;-</span>
<span class="co">#&gt;  $ : symbol y</span>
<span class="co">#&gt;  $ :List of 3</span>
<span class="co">#&gt;   ..$ : symbol &lt;-</span>
<span class="co">#&gt;   ..$ : symbol x</span>
<span class="co">#&gt;   ..$ :List of 3</span>
<span class="co">#&gt;   .. ..$ : symbol +</span>
<span class="co">#&gt;   .. ..$ : num 1</span>
<span class="co">#&gt;   .. ..$ : num 1</span></pre></div>
<p>The choices <code>how = "prune"</code>, <code>how = "flatten"</code> and <code>how = "melt"</code> return the pruned abstract syntax tree as: a nested list, a flattened list and a melted data.frame respectively. This is identical to application of <code><a href="reference/rrapply.html">rrapply()</a></code> to the abstract syntax tree formatted as a nested list. To illustrate, we return all names (i.e. symbols) in the abstract syntax tree that are not part of base R:</p>
<div class="sourceCode" id="cb13"><pre class="r"><span class="no">expr</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span>(<span class="no">y</span> <span class="kw">&lt;-</span> <span class="no">x</span> <span class="kw">&lt;-</span> <span class="fl">1</span>, <span class="fu">f</span>(<span class="fu">g</span>(<span class="fl">2</span> * <span class="no">pi</span>)))
<span class="no">is_new_name</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">x</span>) !<span class="fu"><a href="https://rdrr.io/r/base/exists.html">exists</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span>(<span class="no">x</span>), <span class="kw">envir</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/environment.html">baseenv</a></span>())

<span class="co">## Prune and decompose expression</span>
<span class="no">expr_prune</span> <span class="kw">&lt;-</span> <span class="fu"><a href="reference/rrapply.html">rrapply</a></span>(<span class="no">expr</span>, <span class="kw">classes</span> <span class="kw">=</span> <span class="st">"name"</span>, <span class="kw">condition</span> <span class="kw">=</span> <span class="no">is_new_name</span>, <span class="kw">how</span> <span class="kw">=</span> <span class="st">"prune"</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="no">expr_prune</span>)
<span class="co">#&gt; List of 2</span>
<span class="co">#&gt;  $ :List of 2</span>
<span class="co">#&gt;   ..$ : symbol y</span>
<span class="co">#&gt;   ..$ :List of 1</span>
<span class="co">#&gt;   .. ..$ : symbol x</span>
<span class="co">#&gt;  $ :List of 2</span>
<span class="co">#&gt;   ..$ : symbol f</span>
<span class="co">#&gt;   ..$ :List of 1</span>
<span class="co">#&gt;   .. ..$ : symbol g</span>

<span class="co">## Prune and flatten expression</span>
<span class="no">expr_flatten</span> <span class="kw">&lt;-</span> <span class="fu"><a href="reference/rrapply.html">rrapply</a></span>(<span class="no">expr</span>, <span class="kw">classes</span> <span class="kw">=</span> <span class="st">"name"</span>, <span class="kw">condition</span> <span class="kw">=</span> <span class="no">is_new_name</span>, <span class="kw">how</span> <span class="kw">=</span> <span class="st">"flatten"</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="no">expr_flatten</span>)
<span class="co">#&gt; List of 4</span>
<span class="co">#&gt;  $ : symbol y</span>
<span class="co">#&gt;  $ : symbol x</span>
<span class="co">#&gt;  $ : symbol f</span>
<span class="co">#&gt;  $ : symbol g</span>

<span class="co">## Prune and melt expression</span>
<span class="no">expr_melt</span> <span class="kw">&lt;-</span> <span class="fu"><a href="reference/rrapply.html">rrapply</a></span>(<span class="no">expr</span>, <span class="kw">classes</span> <span class="kw">=</span> <span class="st">"name"</span>, <span class="kw">condition</span> <span class="kw">=</span> <span class="no">is_new_name</span>, <span class="kw">how</span> <span class="kw">=</span> <span class="st">"melt"</span>)
<span class="no">expr_melt</span>
<span class="co">#&gt;    L1  L2   L3 value</span>
<span class="co">#&gt; 1 ..1 ..2 &lt;NA&gt;     y</span>
<span class="co">#&gt; 2 ..1 ..3  ..2     x</span>
<span class="co">#&gt; 3 ..2 ..1 &lt;NA&gt;     f</span>
<span class="co">#&gt; 4 ..2 ..2  ..1     g</span></pre></div>
<p>Additional demonstrating examples from <a href="https://jorischau.github.io/rrapply/articles/articles/3-calls-and-expressions.html" class="uri">https://jorischau.github.io/rrapply/articles/articles/3-calls-and-expressions.html</a> include replacing any logical abbreviations in an expression by their non-abbreviated counterparts:</p>
<div class="sourceCode" id="cb14"><pre class="r"><span class="co">## Expand logical abbreviation</span>
<span class="no">logical_abbr_expand</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">x</span>) {
  <span class="kw">if</span>(<span class="fu"><a href="https://rdrr.io/r/base/identical.html">identical</a></span>(<span class="no">x</span>, <span class="fu"><a href="https://rdrr.io/r/base/substitute.html">quote</a></span>(<span class="no">T</span>))) {
    <span class="fl">TRUE</span>
  } <span class="kw">else</span> <span class="kw">if</span>(<span class="fu"><a href="https://rdrr.io/r/base/identical.html">identical</a></span>(<span class="no">x</span>, <span class="fu"><a href="https://rdrr.io/r/base/substitute.html">quote</a></span>(<span class="no">F</span>))) {
    <span class="fl">FALSE</span>
  } <span class="kw">else</span> {
    <span class="no">x</span>
  }
}

<span class="fu"><a href="reference/rrapply.html">rrapply</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span>(<span class="fu">f</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">T</span>, <span class="no">F</span>)), <span class="fu"><a href="https://rdrr.io/r/base/any.html">any</a></span>(<span class="no">T</span>, <span class="fl">FALSE</span>)), <span class="kw">f</span> <span class="kw">=</span> <span class="no">logical_abbr_expand</span>, <span class="kw">how</span> <span class="kw">=</span> <span class="st">"replace"</span>)
<span class="co">#&gt; expression(f(x = c(TRUE, FALSE)), any(TRUE, FALSE))</span></pre></div>
<p>Or, collecting all names created by assignment and returning them as a character vector:</p>
<div class="sourceCode" id="cb15"><pre class="r"><span class="co">## Check if variable is created by assignment</span>
<span class="no">is_assign</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">x</span>, <span class="no">.xpos</span>, <span class="no">.xsiblings</span>) {
    <span class="fu"><a href="https://rdrr.io/r/base/identical.html">identical</a></span>(<span class="no">.xpos</span>[<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">.xpos</span>)], <span class="fl">2L</span>) <span class="kw">&amp;&amp;</span>
    <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span>(<span class="no">.xsiblings</span><span class="kw">[[</span><span class="fl">1</span>]]) <span class="kw">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"&lt;-"</span>, <span class="st">"="</span>, <span class="st">"for"</span>, <span class="st">"assign"</span>, <span class="st">"delayedAssign"</span>)
}

<span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="fu"><a href="reference/rrapply.html">rrapply</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/body.html">body</a></span>(<span class="no">lm</span>), <span class="kw">condition</span> <span class="kw">=</span> <span class="no">is_assign</span>, <span class="kw">f</span> <span class="kw">=</span> <span class="no">as.character</span>, <span class="kw">how</span> <span class="kw">=</span> <span class="st">"unlist"</span>))
<span class="co">#&gt;  [1] "ret.x"  "ret.y"  "cl"     "mf"     "m"      "mt"     "y"      "w"     </span>
<span class="co">#&gt;  [9] "offset" "mlm"    "ny"     "x"      "z"</span></pre></div>
<p>For more details and examples on how to use the <code><a href="reference/rrapply.html">rrapply()</a></code> function see the accompanying package vignette in the vignettes folder or the ‘Articles’ section at <a href="https://jorischau.github.io/rrapply/" class="uri">https://jorischau.github.io/rrapply/</a>.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2>Links</h2>
<ul class="list-unstyled">
<li>Download from CRAN at <br><a href="https://cloud.r-project.org/package=rrapply">https://​cloud.r-project.org/​package=rrapply</a>
</li>
<li>Browse source code at <br><a href="https://github.com/JorisChau/rrapply/">https://​github.com/​JorisChau/​rrapply/​</a>
</li>
<li>Report a bug at <br><a href="https://github.com/JorisChau/rrapply/issues">https://​github.com/​JorisChau/​rrapply/​issues</a>
</li>
</ul>
</div>
<div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>Joris Chau <br><small class="roles"> Author, maintainer </small>  </li>
</ul>
</div>

  <div class="dev-status">
<h2>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://cran.r-project.org/package=rrapply"><img src="http://www.r-pkg.org/badges/version/rrapply" alt="CRAN version"></a></li>
<li><a href="https://travis-ci.org/JorisChau/rrapply"><img src="https://travis-ci.org/JorisChau/rrapply.svg?branch=master" alt="Build Status"></a></li>
</ul>
</div>
</div>
</div>


      <footer><div class="copyright">
  <p>Developed by Joris Chau.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
